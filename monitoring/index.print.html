<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 9.0.3"><meta name=description content="By default, CCM verifies resource health using the resourceâ€™s native state. For example, if a service should be running and systemd reports it as running, CCM considers it healthy.
For deeper validation, all resources support custom health checks. These checks run after a resource is managed and can verify that the resource is functioning correctly, not just present.
Health Check Properties Property Description Default command Command to execute (required) - name Name for logging and metrics Command base name tries Number of attempts before failing 1 try_sleep Duration to wait between retry attempts 1s timeout Maximum time for command execution No timeout format Output format interpretation nagios Nagios Format Health checks use Nagios plugin conventions for exit codes:"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Monitoring :: Choria Configuration Manager"><meta name=twitter:description content="By default, CCM verifies resource health using the resourceâ€™s native state. For example, if a service should be running and systemd reports it as running, CCM considers it healthy.
For deeper validation, all resources support custom health checks. These checks run after a resource is managed and can verify that the resource is functioning correctly, not just present.
Health Check Properties Property Description Default command Command to execute (required) - name Name for logging and metrics Command base name tries Number of attempts before failing 1 try_sleep Duration to wait between retry attempts 1s timeout Maximum time for command execution No timeout format Output format interpretation nagios Nagios Format Health checks use Nagios plugin conventions for exit codes:"><meta property="og:url" content="https://choria-cm.dev/monitoring/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Monitoring :: Choria Configuration Manager"><meta property="og:description" content="By default, CCM verifies resource health using the resourceâ€™s native state. For example, if a service should be running and systemd reports it as running, CCM considers it healthy.
For deeper validation, all resources support custom health checks. These checks run after a resource is managed and can verify that the resource is functioning correctly, not just present.
Health Check Properties Property Description Default command Command to execute (required) - name Name for logging and metrics Command base name tries Number of attempts before failing 1 try_sleep Duration to wait between retry attempts 1s timeout Maximum time for command execution No timeout format Output format interpretation nagios Nagios Format Health checks use Nagios plugin conventions for exit codes:"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Monitoring :: Choria Configuration Manager"><meta itemprop=description content="By default, CCM verifies resource health using the resourceâ€™s native state. For example, if a service should be running and systemd reports it as running, CCM considers it healthy.
For deeper validation, all resources support custom health checks. These checks run after a resource is managed and can verify that the resource is functioning correctly, not just present.
Health Check Properties Property Description Default command Command to execute (required) - name Name for logging and metrics Command base name tries Number of attempts before failing 1 try_sleep Duration to wait between retry attempts 1s timeout Maximum time for command execution No timeout format Output format interpretation nagios Nagios Format Health checks use Nagios plugin conventions for exit codes:"><meta itemprop=wordCount content="272"><title>Monitoring :: Choria Configuration Manager</title><link href=https://choria-cm.dev/monitoring/index.html rel=canonical type=text/html title="Monitoring :: Choria Configuration Manager"><link href=/monitoring/index.xml rel=alternate type=application/rss+xml title="Monitoring :: Choria Configuration Manager"><link href=/monitoring/index.md rel=alternate type=text/markdown title="Monitoring :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770241829 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770241829 defer></script><script src=/js/search-lunr.min.js?1770241829 defer></script><script src=/js/search.min.js?1770241829 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770241829"</script><script src=/js/lunr/lunr.min.js?1770241829 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770241829 defer></script><script src=/js/lunr/lunr.multi.min.js?1770241829 defer></script><script src=/js/lunr/lunr.en.min.js?1770241829 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770241829 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770241829 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770241829 rel=stylesheet><link href=/css/theme.min.css?1770241829 rel=stylesheet><link href=/css/format-print.min.css?1770241829 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/monitoring/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/monitoring/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#health-check-properties>Health Check Properties</a></li><li><a href=#nagios-format>Nagios Format</a></li><li><a href=#example>Example</a></li><li><a href=#agent-integration>Agent Integration</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Monitoring</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/monitoring/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/monitoring/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/agent/index.html title="Agent (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/index.html title="Design Documents (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable monitoring" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=monitoring>Monitoring</h1><p>By default, CCM verifies resource health using the resource&rsquo;s native state. For example, if a service should be running and <code>systemd</code> reports it as running, CCM considers it healthy.</p><p>For deeper validation, all resources support custom health checks. These checks run after a resource is managed and can verify that the resource is functioning correctly, not just present.</p><h2 id=health-check-properties>Health Check Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>command</code></td><td>Command to execute (required)</td><td>-</td></tr><tr><td><code>name</code></td><td>Name for logging and metrics</td><td>Command base name</td></tr><tr><td><code>tries</code></td><td>Number of attempts before failing</td><td>1</td></tr><tr><td><code>try_sleep</code></td><td>Duration to wait between retry attempts</td><td>1s</td></tr><tr><td><code>timeout</code></td><td>Maximum time for command execution</td><td>No timeout</td></tr><tr><td><code>format</code></td><td>Output format interpretation</td><td><code>nagios</code></td></tr></tbody></table><h2 id=nagios-format>Nagios Format<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Health checks use Nagios plugin conventions for exit codes:</p><table><thead><tr><th>Exit Code</th><th>Status</th><th>Description</th></tr></thead><tbody><tr><td>0</td><td>OK</td><td>Check passed</td></tr><tr><td>1</td><td>WARNING</td><td>Check passed with warnings (non-critical)</td></tr><tr><td>2</td><td>CRITICAL</td><td>Check failed</td></tr><tr><td>3+</td><td>UNKNOWN</td><td>Check could not determine status</td></tr></tbody></table><h2 id=example>Example<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class=tab-panel data-tab-group=R-tabs-5f7a7e05873aae855cdd2c3f76f54732><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-807a9183f70074405b0ddbfe77f1dac7 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-5f7a7e05873aae855cdd2c3f76f54732","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-61e85d027899aa4f522029ac25e7f6b3 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-5f7a7e05873aae855cdd2c3f76f54732","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span></button></div><div class=tab-content-container><div id=R-tab-id-807a9183f70074405b0ddbfe77f1dac7 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>httpd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>health_checks</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>check_http</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>              /usr/lib64/nagios/plugins/check_http -H localhost -p 80 --expect &#34;Acme Inc&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>tries</span>: <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>try_sleep</span>: <span style=color:#ae81ff>1s</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>10s</span></span></span></code></pre></div></div></div><div id=R-tab-id-61e85d027899aa4f522029ac25e7f6b3 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure service httpd running \
    --check &#39;/usr/lib64/nagios/plugins/check_http -H localhost -p 80&#39; \
    --check-tries 5 \
    --check-sleep 1s</code></pre></div><p>The CLI supports a single health check per resource. For multiple health checks, use a manifest.</p></div></div></div></div><p>This example verifies that the web server responds with content containing &ldquo;Acme Inc&rdquo;. If the check fails, it retries up to 5 times with 1 second between attempts.</p><h2 id=agent-integration>Agent Integration<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When running the <a href=/agent/index.html>Agent</a> with <code>health_check_interval</code> configured, health checks run independently of full manifest applies. If any health check returns a CRITICAL status, the agent triggers a remediation apply for that manifest.</p><footer class=footline></footer></article></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770241829 defer></script><script src=/js/theme.min.js?1770241829 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>