<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="This guide documents the process for adding a new resource type to CCM. It uses the archive type as a reference implementation.
Overview Adding a new resource type requires changes across several packages:
Model definitions - Properties, state, and metadata structs Resource type implementation - Core logic and provider interface Provider implementation - Platform-specific operations Integration points - Factory functions and registry CLI commands - User-facing command line interface JSON schemas - Validation for manifests and API requests Documentation - User and design documentation CCM Studio - Web-based manifest designer File Checklist File Action Purpose model/resource_<type>.go Create Properties, state, metadata structs model/resource_<type>_test.go Create Property validation tests model/resource.go Modify Add case to factory function resources/<type>/<type>.go Create Provider interface definition resources/<type>/type.go Create Resource type implementation resources/<type>/type_test.go Create Resource type tests resources/<type>/provider_mock_test.go Generate Mock provider for tests resources/<type>/<provider>/factory.go Create Provider factory resources/<type>/<provider>/<provider>.go Create Provider implementation resources/<type>/<provider>/<provider>_test.go Create Provider tests resources/resources.go Modify Add case to NewResourceFromProperties cmd/ensure_<type>.go Create CLI command handler cmd/ensure.go Modify Register CLI command internal/fs/schemas/manifest.json Modify Add resource schema definitions internal/fs/schemas/resource_ensure_request.json Modify Add API request schema docs/content/resources/<type>.md Create User documentation docs/content/design/<type>/_index.md Create Design documentation docs/content/design/<type>/<provider>.md Create Provider documentation Step 1: Model Definitions Create model/resource_<type>.go with the following components."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Adding a Type :: Choria Configuration Manager"><meta name=twitter:description content="This guide documents the process for adding a new resource type to CCM. It uses the archive type as a reference implementation.
Overview Adding a new resource type requires changes across several packages:
Model definitions - Properties, state, and metadata structs Resource type implementation - Core logic and provider interface Provider implementation - Platform-specific operations Integration points - Factory functions and registry CLI commands - User-facing command line interface JSON schemas - Validation for manifests and API requests Documentation - User and design documentation CCM Studio - Web-based manifest designer File Checklist File Action Purpose model/resource_<type>.go Create Properties, state, metadata structs model/resource_<type>_test.go Create Property validation tests model/resource.go Modify Add case to factory function resources/<type>/<type>.go Create Provider interface definition resources/<type>/type.go Create Resource type implementation resources/<type>/type_test.go Create Resource type tests resources/<type>/provider_mock_test.go Generate Mock provider for tests resources/<type>/<provider>/factory.go Create Provider factory resources/<type>/<provider>/<provider>.go Create Provider implementation resources/<type>/<provider>/<provider>_test.go Create Provider tests resources/resources.go Modify Add case to NewResourceFromProperties cmd/ensure_<type>.go Create CLI command handler cmd/ensure.go Modify Register CLI command internal/fs/schemas/manifest.json Modify Add resource schema definitions internal/fs/schemas/resource_ensure_request.json Modify Add API request schema docs/content/resources/<type>.md Create User documentation docs/content/design/<type>/_index.md Create Design documentation docs/content/design/<type>/<provider>.md Create Provider documentation Step 1: Model Definitions Create model/resource_<type>.go with the following components."><meta property="og:url" content="https://choria-cm.dev/design/new/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Adding a Type :: Choria Configuration Manager"><meta property="og:description" content="This guide documents the process for adding a new resource type to CCM. It uses the archive type as a reference implementation.
Overview Adding a new resource type requires changes across several packages:
Model definitions - Properties, state, and metadata structs Resource type implementation - Core logic and provider interface Provider implementation - Platform-specific operations Integration points - Factory functions and registry CLI commands - User-facing command line interface JSON schemas - Validation for manifests and API requests Documentation - User and design documentation CCM Studio - Web-based manifest designer File Checklist File Action Purpose model/resource_<type>.go Create Properties, state, metadata structs model/resource_<type>_test.go Create Property validation tests model/resource.go Modify Add case to factory function resources/<type>/<type>.go Create Provider interface definition resources/<type>/type.go Create Resource type implementation resources/<type>/type_test.go Create Resource type tests resources/<type>/provider_mock_test.go Generate Mock provider for tests resources/<type>/<provider>/factory.go Create Provider factory resources/<type>/<provider>/<provider>.go Create Provider implementation resources/<type>/<provider>/<provider>_test.go Create Provider tests resources/resources.go Modify Add case to NewResourceFromProperties cmd/ensure_<type>.go Create CLI command handler cmd/ensure.go Modify Register CLI command internal/fs/schemas/manifest.json Modify Add resource schema definitions internal/fs/schemas/resource_ensure_request.json Modify Add API request schema docs/content/resources/<type>.md Create User documentation docs/content/design/<type>/_index.md Create Design documentation docs/content/design/<type>/<provider>.md Create Provider documentation Step 1: Model Definitions Create model/resource_<type>.go with the following components."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Adding a Type :: Choria Configuration Manager"><meta itemprop=description content="This guide documents the process for adding a new resource type to CCM. It uses the archive type as a reference implementation.
Overview Adding a new resource type requires changes across several packages:
Model definitions - Properties, state, and metadata structs Resource type implementation - Core logic and provider interface Provider implementation - Platform-specific operations Integration points - Factory functions and registry CLI commands - User-facing command line interface JSON schemas - Validation for manifests and API requests Documentation - User and design documentation CCM Studio - Web-based manifest designer File Checklist File Action Purpose model/resource_<type>.go Create Properties, state, metadata structs model/resource_<type>_test.go Create Property validation tests model/resource.go Modify Add case to factory function resources/<type>/<type>.go Create Provider interface definition resources/<type>/type.go Create Resource type implementation resources/<type>/type_test.go Create Resource type tests resources/<type>/provider_mock_test.go Generate Mock provider for tests resources/<type>/<provider>/factory.go Create Provider factory resources/<type>/<provider>/<provider>.go Create Provider implementation resources/<type>/<provider>/<provider>_test.go Create Provider tests resources/resources.go Modify Add case to NewResourceFromProperties cmd/ensure_<type>.go Create CLI command handler cmd/ensure.go Modify Register CLI command internal/fs/schemas/manifest.json Modify Add resource schema definitions internal/fs/schemas/resource_ensure_request.json Modify Add API request schema docs/content/resources/<type>.md Create User documentation docs/content/design/<type>/_index.md Create Design documentation docs/content/design/<type>/<provider>.md Create Provider documentation Step 1: Model Definitions Create model/resource_<type>.go with the following components."><meta itemprop=wordCount content="1724"><title>Adding a Type :: Choria Configuration Manager</title><link href=https://choria-cm.dev/design/new/index.html rel=canonical type=text/html title="Adding a Type :: Choria Configuration Manager"><link href=/design/new/index.xml rel=alternate type=application/rss+xml title="Adding a Type :: Choria Configuration Manager"><link href=/design/new/index.md rel=alternate type=text/markdown title="Adding a Type :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1771940928 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1771940928 defer></script><script src=/js/search-lunr.min.js?1771940928 defer></script><script src=/js/search.min.js?1771940928 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1771940928"</script><script src=/js/lunr/lunr.min.js?1771940928 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1771940928 defer></script><script src=/js/lunr/lunr.multi.min.js?1771940928 defer></script><script src=/js/lunr/lunr.en.min.js?1771940928 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1771940928 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1771940928 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1771940928 rel=stylesheet><link href=/css/theme.min.css?1771940928 rel=stylesheet><link href=/css/format-print.min.css?1771940928 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/design/new/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/design/new/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#file-checklist>File Checklist</a></li><li><a href=#step-1-model-definitions>Step 1: Model Definitions</a><ul><li><a href=#constants>Constants</a></li><li><a href=#properties-struct>Properties Struct</a></li><li><a href=#state-struct>State Struct</a></li><li><a href=#factory-function>Factory Function</a></li></ul></li><li><a href=#step-2-resource-type-implementation>Step 2: Resource Type Implementation</a><ul><li><a href=#provider-interface-resourcestypetypego>Provider Interface (<code>resources/&lt;type>/&lt;type>.go</code>)</a></li><li><a href=#type-implementation-resourcestypetypego>Type Implementation (<code>resources/&lt;type>/type.go</code>)</a></li><li><a href=#applyresource-method>ApplyResource Method</a></li><li><a href=#provider-selection-methods>Provider Selection Methods</a></li></ul></li><li><a href=#step-3-provider-implementation>Step 3: Provider Implementation</a><ul><li><a href=#factory-resourcestypeproviderfactorygo>Factory (<code>resources/&lt;type>/&lt;provider>/factory.go</code>)</a></li><li><a href=#provider-implementation-resourcestypeproviderprovidergo>Provider Implementation (<code>resources/&lt;type>/&lt;provider>/&lt;provider>.go</code>)</a></li></ul></li><li><a href=#step-4-integration-points>Step 4: Integration Points</a><ul><li><a href=#update-resourcesresourcesgo>Update <code>resources/resources.go</code></a></li><li><a href=#update-modelresourcego>Update <code>model/resource.go</code></a></li></ul></li><li><a href=#step-5-cli-command>Step 5: CLI Command</a></li><li><a href=#step-6-json-schemas>Step 6: JSON Schemas</a><ul><li><a href=#update-internalfsschemasmanifestjson>Update <code>internal/fs/schemas/manifest.json</code></a></li><li><a href=#update-internalfsschemasresource_ensure_requestjson>Update <code>internal/fs/schemas/resource_ensure_request.json</code></a></li><li><a href=#copy-schemas-to-documentation-site>Copy Schemas to Documentation Site</a></li></ul></li><li><a href=#step-7-generate-mocks>Step 7: Generate Mocks</a></li><li><a href=#step-8-testing>Step 8: Testing</a><ul><li><a href=#model-tests-modelresource_type_testgo>Model Tests (<code>model/resource_&lt;type>_test.go</code>)</a></li><li><a href=#type-tests-resourcestypetype_testgo>Type Tests (<code>resources/&lt;type>/type_test.go</code>)</a></li></ul></li><li><a href=#key-patterns>Key Patterns</a><ul><li><a href=#state-checking>State Checking</a></li><li><a href=#noop-mode>Noop Mode</a></li><li><a href=#error-handling>Error Handling</a></li><li><a href=#template-resolution>Template Resolution</a></li><li><a href=#provider-selection>Provider Selection</a></li></ul></li><li><a href=#documentation>Documentation</a></li><li><a href=#ccm-studio>CCM Studio</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/index.html><span itemprop=name>Design Documents</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Adding a Type</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/new/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/new/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/service/systemd/index.html title="Systemd Provider (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle"><span><i class="fa-fw fas fa-chevron-right"></i></span></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable design" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=adding-a-type>Adding a Type</h1><p>This guide documents the process for adding a new resource type to CCM. It uses the <code>archive</code> type as a reference implementation.</p><h2 id=overview>Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Adding a new resource type requires changes across several packages:</p><ol><li><strong>Model definitions</strong> - Properties, state, and metadata structs</li><li><strong>Resource type implementation</strong> - Core logic and provider interface</li><li><strong>Provider implementation</strong> - Platform-specific operations</li><li><strong>Integration points</strong> - Factory functions and registry</li><li><strong>CLI commands</strong> - User-facing command line interface</li><li><strong>JSON schemas</strong> - Validation for manifests and API requests</li><li><strong>Documentation</strong> - User and design documentation</li><li><strong>CCM Studio</strong> - Web-based manifest designer</li></ol><h2 id=file-checklist>File Checklist<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>File</th><th>Action</th><th>Purpose</th></tr></thead><tbody><tr><td><code>model/resource_&lt;type>.go</code></td><td>Create</td><td>Properties, state, metadata structs</td></tr><tr><td><code>model/resource_&lt;type>_test.go</code></td><td>Create</td><td>Property validation tests</td></tr><tr><td><code>model/resource.go</code></td><td>Modify</td><td>Add case to factory function</td></tr><tr><td><code>resources/&lt;type>/&lt;type>.go</code></td><td>Create</td><td>Provider interface definition</td></tr><tr><td><code>resources/&lt;type>/type.go</code></td><td>Create</td><td>Resource type implementation</td></tr><tr><td><code>resources/&lt;type>/type_test.go</code></td><td>Create</td><td>Resource type tests</td></tr><tr><td><code>resources/&lt;type>/provider_mock_test.go</code></td><td>Generate</td><td>Mock provider for tests</td></tr><tr><td><code>resources/&lt;type>/&lt;provider>/factory.go</code></td><td>Create</td><td>Provider factory</td></tr><tr><td><code>resources/&lt;type>/&lt;provider>/&lt;provider>.go</code></td><td>Create</td><td>Provider implementation</td></tr><tr><td><code>resources/&lt;type>/&lt;provider>/&lt;provider>_test.go</code></td><td>Create</td><td>Provider tests</td></tr><tr><td><code>resources/resources.go</code></td><td>Modify</td><td>Add case to <code>NewResourceFromProperties</code></td></tr><tr><td><code>cmd/ensure_&lt;type>.go</code></td><td>Create</td><td>CLI command handler</td></tr><tr><td><code>cmd/ensure.go</code></td><td>Modify</td><td>Register CLI command</td></tr><tr><td><code>internal/fs/schemas/manifest.json</code></td><td>Modify</td><td>Add resource schema definitions</td></tr><tr><td><code>internal/fs/schemas/resource_ensure_request.json</code></td><td>Modify</td><td>Add API request schema</td></tr><tr><td><code>docs/content/resources/&lt;type>.md</code></td><td>Create</td><td>User documentation</td></tr><tr><td><code>docs/content/design/&lt;type>/_index.md</code></td><td>Create</td><td>Design documentation</td></tr><tr><td><code>docs/content/design/&lt;type>/&lt;provider>.md</code></td><td>Create</td><td>Provider documentation</td></tr></tbody></table><h2 id=step-1-model-definitions>Step 1: Model Definitions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Create <code>model/resource_&lt;type>.go</code> with the following components.</p><h3 id=constants>Constants<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>const</span> (
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ResourceStatus&lt;Type&gt;Protocol is the protocol identifier for &lt;type&gt; resource state</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ResourceStatus</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Protocol</span> = <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.&lt;type&gt;.state&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// &lt;Type&gt;TypeName is the type name for &lt;type&gt; resources</span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>TypeName</span> = <span style=color:#e6db74>&#34;&lt;type&gt;&#34;</span>
</span></span><span style=display:flex><span>)</span></span></code></pre></div><h3 id=properties-struct>Properties Struct<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The properties struct must satisfy <code>model.ResourceProperties</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ResourceProperties</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonProperties</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>CommonResourceProperties</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Validate</span>() <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ResolveTemplates</span>(<span style=color:#f92672>*</span><span style=color:#a6e22e>templates</span>.<span style=color:#a6e22e>Env</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ToYamlManifest</span>() (<span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>RawMessage</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Structure:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonResourceProperties</span> <span style=color:#e6db74>`yaml:&#34;,inline&#34;`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add type-specific fields here</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Url</span>      <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;url&#34; yaml:&#34;url&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Checksum</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;checksum,omitempty&#34; yaml:&#34;checksum,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Key points:</p><ul><li>Embed <code>CommonResourceProperties</code> with <code>yaml:",inline"</code> tag</li><li>Use JSON and YAML struct tags for serialization</li><li>In <code>Validate()</code>, call <code>p.CommonResourceProperties.Validate()</code> first, then add type-specific validation</li><li>In <code>ResolveTemplates()</code>, call <code>p.CommonResourceProperties.ResolveTemplates(env)</code> first, then resolve type-specific fields</li></ul><h3 id=state-struct>State Struct<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The state struct must satisfy <code>model.ResourceState</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ResourceState</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonState</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>CommonResourceState</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Structure:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Metadata</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>     <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;name&#34; yaml:&#34;name&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>string</span> <span style=color:#e6db74>`json:&#34;provider,omitempty&#34; yaml:&#34;provider,omitempty&#34;`</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add fields describing current system state</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>State</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonResourceState</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>*</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Metadata</span> <span style=color:#e6db74>`json:&#34;metadata,omitempty&#34;`</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=factory-function>Factory Function<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Provide a factory function for YAML parsing:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourcePropertiesFromYaml</span>(<span style=color:#a6e22e>raw</span> <span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>RawMessage</span>) ([]<span style=color:#a6e22e>ResourceProperties</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>parseProperties</span>(<span style=color:#a6e22e>raw</span>, &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>TypeName</span>, <span style=color:#66d9ef>func</span>() <span style=color:#a6e22e>ResourceProperties</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>{}
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=step-2-resource-type-implementation>Step 2: Resource Type Implementation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=provider-interface-resourcestypetypego>Provider Interface (<code>resources/&lt;type>/&lt;type>.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Define a type-specific provider interface that embeds <code>model.Provider</code> and adds type-specific methods:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> &lt;<span style=color:#66d9ef>type</span>&gt;<span style=color:#a6e22e>resource</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/model&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/resources/&lt;type&gt;/&lt;provider&gt;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Factory</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ProviderFactory</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>    &lt;<span style=color:#a6e22e>provider</span>&gt;.<span style=color:#a6e22e>Register</span>()
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>properties</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>State</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add provider-specific methods (e.g., Download, Extract for archive)</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=type-implementation-resourcestypetypego>Type Implementation (<code>resources/&lt;type>/type.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The Type struct must satisfy both <code>model.Resource</code> and <code>base.EmbeddedResource</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// model.Resource interface</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Resource</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Type</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Provider</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Properties</span>() <span style=color:#a6e22e>ResourceProperties</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Apply</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>TransactionEvent</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#66d9ef>any</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Healthcheck</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>TransactionEvent</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// base.EmbeddedResource interface</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>EmbeddedResource</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>NewTransactionEvent</span>() <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>TransactionEvent</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ApplyResource</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) (<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ResourceState</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>SelectProvider</span>() (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Type</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Embedding <code>*base.Base</code> provides implementations for <code>Apply()</code>, <code>Healthcheck()</code>, <code>Type()</code>, <code>Name()</code>, <code>Properties()</code>, and <code>NewTransactionEvent()</code>. The type must implement:</p><ul><li><code>ApplyResource()</code> - core resource application logic</li><li><code>SelectProvider()</code> - provider selection</li><li><code>Provider()</code> - return current provider name</li><li><code>Info()</code> - return resource information</li></ul><p>Structure:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Type</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span><span style=color:#a6e22e>base</span>.<span style=color:#a6e22e>Base</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>prop</span>     <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mgr</span>      <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Manager</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>      <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>provider</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>facts</span>    <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>     <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>mu</span> <span style=color:#a6e22e>sync</span>.<span style=color:#a6e22e>Mutex</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Resource</span> = (<span style=color:#f92672>*</span><span style=color:#a6e22e>Type</span>)(<span style=color:#66d9ef>nil</span>)</span></span></code></pre></div><p>See <code>resources/archive/type.go</code> for a complete constructor example.</p><h3 id=applyresource-method>ApplyResource Method<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>ApplyResource</code> method (part of <code>base.EmbeddedResource</code>) contains the core logic. It should follow this pattern:</p><ol><li>Get initial state via <code>provider.Status()</code></li><li>Check if already in desired state (implement <code>isDesiredState()</code> helper)</li><li>If stable, call <code>t.FinalizeState()</code> and return early</li><li>Apply changes, respecting <code>t.mgr.NoopMode()</code></li><li>Get final state and verify desired state was achieved</li><li>Call <code>t.FinalizeState()</code> with appropriate flags</li></ol><p>See <code>resources/archive/type.go:ApplyResource()</code> for a complete example.</p><h3 id=provider-selection-methods>Provider Selection Methods<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>SelectProvider()</code> method should use <code>registry.FindSuitableProvider()</code> to select an appropriate provider. See <code>resources/archive/type.go</code> for the standard implementation pattern.</p><h2 id=step-3-provider-implementation>Step 3: Provider Implementation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=factory-resourcestypeproviderfactorygo>Factory (<code>resources/&lt;type>/&lt;provider>/factory.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The factory must satisfy <code>model.ProviderFactory</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ProviderFactory</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>TypeName</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>log</span> <span style=color:#a6e22e>Logger</span>, <span style=color:#a6e22e>runner</span> <span style=color:#a6e22e>CommandRunner</span>) (<span style=color:#a6e22e>Provider</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>IsManageable</span>(<span style=color:#a6e22e>facts</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span>, <span style=color:#a6e22e>properties</span> <span style=color:#a6e22e>ResourceProperties</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The <code>IsManageable</code> method returns:</p><ul><li><code>bool</code> - whether this provider can manage the resource</li><li><code>int</code> - priority (higher wins when multiple providers match)</li><li><code>error</code> - any error encountered</li></ul><p>Structure:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> &lt;<span style=color:#a6e22e>provider</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/internal/registry&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/model&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>ProviderName</span> = <span style=color:#e6db74>&#34;&lt;provider&gt;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Register</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>MustRegister</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>factory</span>{})
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>factory</span> <span style=color:#66d9ef>struct</span>{}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>factory</span>) <span style=color:#a6e22e>TypeName</span>() <span style=color:#66d9ef>string</span> { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>TypeName</span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>factory</span>) <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>     { <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ProviderName</span> }
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>factory</span>) <span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>log</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Logger</span>, <span style=color:#a6e22e>runner</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>CommandRunner</span>) (<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>New</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>(<span style=color:#a6e22e>log</span>, <span style=color:#a6e22e>runner</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>factory</span>) <span style=color:#a6e22e>IsManageable</span>(<span style=color:#a6e22e>facts</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span>, <span style=color:#a6e22e>prop</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ResourceProperties</span>) (<span style=color:#66d9ef>bool</span>, <span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Type assert and check if this provider can handle the resource</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>, <span style=color:#ae81ff>1</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>See <code>resources/archive/http/factory.go</code> for a complete example.</p><h3 id=provider-implementation-resourcestypeproviderprovidergo>Provider Implementation (<code>resources/&lt;type>/&lt;provider>/&lt;provider>.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The provider must satisfy the type-specific provider interface defined in Step 2 (which embeds <code>model.Provider</code>):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Structure:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> &lt;<span style=color:#a6e22e>provider</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/model&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> &lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Logger</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>runner</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>CommandRunner</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>New</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>(<span style=color:#a6e22e>log</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Logger</span>, <span style=color:#a6e22e>runner</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>CommandRunner</span>) (<span style=color:#f92672>*</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#f92672>&amp;</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>{<span style=color:#a6e22e>log</span>: <span style=color:#a6e22e>log</span>, <span style=color:#a6e22e>runner</span>: <span style=color:#a6e22e>runner</span>}, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>) <span style=color:#a6e22e>Name</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ProviderName</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span>&lt;<span style=color:#a6e22e>Provider</span>&gt;<span style=color:#a6e22e>Provider</span>) <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>properties</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>State</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>state</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>State</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CommonResourceState</span>: <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>NewCommonResourceState</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ResourceStatus</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Protocol</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>TypeName</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Name</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>EnsureAbsent</span>,
</span></span><span style=display:flex><span>        ),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Metadata</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Metadata</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Name</span>:     <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Name</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Provider</span>: <span style=color:#a6e22e>ProviderName</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Query system state and populate metadata</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>state</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Implement other type-specific provider methods...</span></span></span></code></pre></div><p>See <code>resources/archive/http/http.go</code> for a complete example.</p><h2 id=step-4-integration-points>Step 4: Integration Points<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=update-resourcesresourcesgo>Update <code>resources/resources.go</code><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Add the import and case statement:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#66d9ef>type</span>&gt;<span style=color:#a6e22e>resource</span> <span style=color:#e6db74>&#34;github.com/choria-io/ccm/resources/&lt;type&gt;&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewResourceFromProperties</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>mgr</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Manager</span>, <span style=color:#a6e22e>props</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ResourceProperties</span>) (<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Resource</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>rprop</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>props</span>.(<span style=color:#66d9ef>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... existing cases ...</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> &lt;<span style=color:#66d9ef>type</span>&gt;<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>mgr</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>rprop</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;unsupported resource property type %T&#34;</span>, <span style=color:#a6e22e>rprop</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=update-modelresourcego>Update <code>model/resource.go</code><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Add the case to <code>NewResourcePropertiesFromYaml</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>NewResourcePropertiesFromYaml</span>(<span style=color:#a6e22e>typeName</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>rawProperties</span> <span style=color:#a6e22e>yaml</span>.<span style=color:#a6e22e>RawMessage</span>, <span style=color:#a6e22e>env</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>templates</span>.<span style=color:#a6e22e>Env</span>) ([]<span style=color:#a6e22e>ResourceProperties</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>typeName</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... existing cases ...</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>case</span> &lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>TypeName</span>:
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>props</span>, <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>New</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourcePropertiesFromYaml</span>(<span style=color:#a6e22e>rawProperties</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>default</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;%w: %s %s&#34;</span>, <span style=color:#a6e22e>ErrResourceInvalid</span>, <span style=color:#a6e22e>ErrUnknownType</span>, <span style=color:#a6e22e>typeName</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=step-5-cli-command>Step 5: CLI Command<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Create <code>cmd/ensure_&lt;type>.go</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/ccm/model&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/choria-io/fisk&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ensure</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Command</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>name</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add command-specific fields for flags</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parent</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensureCommand</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>registerEnsure</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Command</span>(<span style=color:#a6e22e>ccm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>fisk</span>.<span style=color:#a6e22e>CmdClause</span>, <span style=color:#a6e22e>parent</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensureCommand</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cmd</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>ensure</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Command</span>{<span style=color:#a6e22e>parent</span>: <span style=color:#a6e22e>parent</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    &lt;<span style=color:#66d9ef>type</span>&gt; <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ccm</span>.<span style=color:#a6e22e>Command</span>(<span style=color:#e6db74>&#34;&lt;type&gt;&#34;</span>, <span style=color:#e6db74>&#34;&lt;Type&gt; management&#34;</span>).<span style=color:#a6e22e>Action</span>(<span style=color:#a6e22e>cmd</span>.&lt;<span style=color:#66d9ef>type</span>&gt;<span style=color:#a6e22e>Action</span>)
</span></span><span style=display:flex><span>    &lt;<span style=color:#66d9ef>type</span>&gt;.<span style=color:#a6e22e>Arg</span>(<span style=color:#e6db74>&#34;name&#34;</span>, <span style=color:#e6db74>&#34;Resource name&#34;</span>).<span style=color:#a6e22e>Required</span>().<span style=color:#a6e22e>StringVar</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>cmd</span>.<span style=color:#a6e22e>name</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add type-specific flags</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>parent</span>.<span style=color:#a6e22e>addCommonFlags</span>(&lt;<span style=color:#66d9ef>type</span>&gt;)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ensure</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Command</span>) &lt;<span style=color:#66d9ef>type</span>&gt;<span style=color:#a6e22e>Action</span>(<span style=color:#a6e22e>_</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>fisk</span>.<span style=color:#a6e22e>ParseContext</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>properties</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>CommonResourceProperties</span>: <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>CommonResourceProperties</span>{
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Name</span>:     <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>name</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Ensure</span>:   <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>EnsurePresent</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Provider</span>: <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>parent</span>.<span style=color:#a6e22e>provider</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Set type-specific properties from flags</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>parent</span>.<span style=color:#a6e22e>commonEnsureResource</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>properties</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Update <code>cmd/ensure.go</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>registerEnsureCommand</span>(<span style=color:#a6e22e>ccm</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>fisk</span>.<span style=color:#a6e22e>Application</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... existing code ...</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>registerEnsure</span>&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>Command</span>(<span style=color:#a6e22e>ens</span>, <span style=color:#a6e22e>cmd</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=step-6-json-schemas>Step 6: JSON Schemas<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=update-internalfsschemasmanifestjson>Update <code>internal/fs/schemas/manifest.json</code><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Add to the <code>$defs/resource</code> properties:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;&lt;type&gt;&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;oneOf&#34;</span>: [
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/&lt;type&gt;ResourceList&#34;</span> },
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/&lt;type&gt;ResourcePropertiesWithName&#34;</span> }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Add resource list definition:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;&lt;type&gt;ResourceList&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;array&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;List of &lt;type&gt; resources to manage (named format)&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;items&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;additionalProperties&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/&lt;type&gt;ResourceProperties&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;minProperties&#34;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;maxProperties&#34;</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Add properties definitions:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;&lt;type&gt;ResourcePropertiesWithName&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;allOf&#34;</span>: [
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/&lt;type&gt;ResourceProperties&#34;</span> },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;name&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Resource name&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;required&#34;</span>: [<span style=color:#e6db74>&#34;name&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}<span style=color:#960050;background-color:#1e0010>,</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&lt;type&gt;ResourceProperties&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;enum&#34;</span>: [<span style=color:#e6db74>&#34;present&#34;</span>, <span style=color:#e6db74>&#34;absent&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add type-specific properties
</span></span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=update-internalfsschemasresource_ensure_requestjson>Update <code>internal/fs/schemas/resource_ensure_request.json</code><span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Add to the <code>type</code> enum:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;enum&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> [<span style=color:#e6db74>&#34;package&#34;</span>, <span style=color:#e6db74>&#34;service&#34;</span>, <span style=color:#e6db74>&#34;file&#34;</span>, <span style=color:#e6db74>&#34;exec&#34;</span>, <span style=color:#e6db74>&#34;archive&#34;</span>, <span style=color:#e6db74>&#34;&lt;type&gt;&#34;</span>]</span></span></code></pre></div><p>Add to <code>properties.oneOf</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{ <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/&lt;type&gt;Properties&#34;</span> }</span></span></code></pre></div><p>Add properties definition under <code>$defs</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#e6db74>&#34;&lt;type&gt;Properties&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;allOf&#34;</span>: [
</span></span><span style=display:flex><span>    { <span style=color:#f92672>&#34;$ref&#34;</span>: <span style=color:#e6db74>&#34;#/$defs/commonProperties&#34;</span> },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;object&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;name&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;string&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;Resource name&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Add type-specific properties
</span></span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;required&#34;</span>: [<span style=color:#e6db74>&#34;name&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=copy-schemas-to-documentation-site>Copy Schemas to Documentation Site<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>After updating the schema files in <code>internal/fs/schemas/</code>, copy them to <code>docs/static/schemas/v1/</code> so they are available on the documentation website:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp internal/fs/schemas/manifest.json docs/static/schemas/v1/manifest.json
</span></span><span style=display:flex><span>cp internal/fs/schemas/resource_ensure_request.json docs/static/schemas/v1/resource_ensure_request.json</span></span></code></pre></div><h2 id=step-7-generate-mocks>Step 7: Generate Mocks<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Generate the provider mock for tests:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mockgen -write_generate_directive <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -source resources/&lt;type&gt;/&lt;type&gt;.go <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -destination resources/&lt;type&gt;/provider_mock_test.go <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -package &lt;type&gt;resource</span></span></code></pre></div><p>Or use the project command:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>abt gen mocks</span></span></code></pre></div><h2 id=step-8-testing>Step 8: Testing<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=model-tests-modelresource_type_testgo>Model Tests (<code>model/resource_&lt;type>_test.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Test property validation:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>Describe</span>(<span style=color:#e6db74>&#34;&lt;Type&gt;ResourceProperties&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Describe</span>(<span style=color:#e6db74>&#34;Validate&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>It</span>(<span style=color:#e6db74>&#34;should require name&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>{}
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Ensure</span> = <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>EnsurePresent</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Expect</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Validate</span>()).<span style=color:#a6e22e>To</span>(<span style=color:#a6e22e>MatchError</span>(<span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ErrResourceNameRequired</span>))
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>It</span>(<span style=color:#e6db74>&#34;should validate ensure values&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>model</span>.&lt;<span style=color:#a6e22e>Type</span>&gt;<span style=color:#a6e22e>ResourceProperties</span>{}
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;test&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Ensure</span> = <span style=color:#e6db74>&#34;invalid&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Expect</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Validate</span>()).<span style=color:#a6e22e>To</span>(<span style=color:#a6e22e>HaveOccurred</span>())
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>})</span></span></code></pre></div><h3 id=type-tests-resourcestypetype_testgo>Type Tests (<code>resources/&lt;type>/type_test.go</code>)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Use the mock manager helper:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>_</span> = <span style=color:#a6e22e>Describe</span>(<span style=color:#e6db74>&#34;&lt;Type&gt; Type&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>mockctl</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>gomock</span>.<span style=color:#a6e22e>Controller</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>BeforeEach</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>mockctl</span> = <span style=color:#a6e22e>gomock</span>.<span style=color:#a6e22e>NewController</span>(<span style=color:#a6e22e>GinkgoT</span>())
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>registry</span>.<span style=color:#a6e22e>Clear</span>()
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Register mock factory</span>
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>AfterEach</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>mockctl</span>.<span style=color:#a6e22e>Finish</span>()
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Describe</span>(<span style=color:#e6db74>&#34;Apply&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>It</span>(<span style=color:#e6db74>&#34;should handle present ensure state&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>mgr</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>modelmocks</span>.<span style=color:#a6e22e>NewManager</span>(<span style=color:#a6e22e>facts</span>, <span style=color:#a6e22e>data</span>, <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>mockctl</span>)
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Test implementation</span>
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>})</span></span></code></pre></div><h2 id=key-patterns>Key Patterns<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=state-checking>State Checking<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Always check current state before making changes:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>initialStatus</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>prop</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>isStable</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>isDesiredState</span>(<span style=color:#a6e22e>properties</span>, <span style=color:#a6e22e>initialStatus</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>isStable</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// No changes needed</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>FinalizeState</span>(<span style=color:#a6e22e>initialStatus</span>, <span style=color:#a6e22e>noop</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#66d9ef>false</span>, <span style=color:#66d9ef>true</span>, <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>initialStatus</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=noop-mode>Noop Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>All resources must respect noop mode:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>noop</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Make actual changes</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Applying changes&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>SomeAction</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>properties</span>)
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#e6db74>&#34;Skipping changes as noop&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>noopMessage</span> = <span style=color:#e6db74>&#34;Would have applied changes&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=error-handling>Error Handling<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Use sentinel errors from <code>model/errors.go</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>var</span> (
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrResourceInvalid</span>    = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;resource invalid&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrProviderNotFound</span>   = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;provider not found&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrNoSuitableProvider</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;no suitable provider&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ErrDesiredStateFailed</span> = <span style=color:#a6e22e>errors</span>.<span style=color:#a6e22e>New</span>(<span style=color:#e6db74>&#34;desired state not achieved&#34;</span>)
</span></span><span style=display:flex><span>)</span></span></code></pre></div><p>Wrap errors with context:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Remove</span>(<span style=color:#a6e22e>path</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;could not remove file: %w&#34;</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=template-resolution>Template Resolution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>ResolveTemplates</code> method (part of <code>model.ResourceProperties</code>) should resolve all user-facing string fields using <code>templates.ResolveTemplateString()</code>. Always call the embedded <code>CommonResourceProperties.ResolveTemplates(env)</code> first.</p><h3 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Providers declare manageability via <code>IsManageable</code> on the factory (see <code>model.ProviderFactory</code> in Step 3). Multiple providers can match; the one with highest priority is selected.</p><h2 id=documentation>Documentation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Create user documentation in <code>docs/content/resources/&lt;type>.md</code> covering:</p><ul><li>Overview and use cases</li><li>Ensure states table</li><li>Properties table with descriptions</li><li>Usage examples (manifest, CLI, API)</li></ul><p>Create design documentation in <code>docs/content/design/&lt;type>/_index.md</code> covering:</p><ul><li>Provider interface specification</li><li>State checking logic</li><li>Apply logic flowchart</li></ul><p>Create provider documentation in <code>docs/content/design/&lt;type>/&lt;provider>.md</code> covering:</p><ul><li>Provider selection criteria</li><li>Platform requirements</li><li>Implementation details</li></ul><h2 id=ccm-studio>CCM Studio<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>CCM Studio is a web-based manifest designer. After adding a new resource type, update CCM Studio to support it:</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>CCM Studio is a closed-source project. The maintainers will complete this step.</p></div></details><ul><li>Add the new resource type to the resource palette</li><li>Create property editors for type-specific fields</li><li>Add validation matching the JSON schema definitions</li><li>Update any resource type documentation or help text</li></ul><footer class=footline></footer></article></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1771940928 defer></script><script src=/js/theme.min.js?1771940928 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>