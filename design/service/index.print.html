<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="This document describes the design of the service resource type for managing system services.
Overview The service resource manages system services with two independent dimensions:
Running state: Whether the service is currently running or stopped Enabled state: Whether the service starts automatically at boot These are managed independently, allowing combinations like â€œrunning but disabledâ€ or â€œstopped but enabledâ€."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Service Type :: Choria Configuration Manager"><meta name=twitter:description content="This document describes the design of the service resource type for managing system services.
Overview The service resource manages system services with two independent dimensions:
Running state: Whether the service is currently running or stopped Enabled state: Whether the service starts automatically at boot These are managed independently, allowing combinations like â€œrunning but disabledâ€ or â€œstopped but enabledâ€."><meta property="og:url" content="https://choria-cm.dev/design/service/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Service Type :: Choria Configuration Manager"><meta property="og:description" content="This document describes the design of the service resource type for managing system services.
Overview The service resource manages system services with two independent dimensions:
Running state: Whether the service is currently running or stopped Enabled state: Whether the service starts automatically at boot These are managed independently, allowing combinations like â€œrunning but disabledâ€ or â€œstopped but enabledâ€."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Service Type :: Choria Configuration Manager"><meta itemprop=description content="This document describes the design of the service resource type for managing system services.
Overview The service resource manages system services with two independent dimensions:
Running state: Whether the service is currently running or stopped Enabled state: Whether the service starts automatically at boot These are managed independently, allowing combinations like â€œrunning but disabledâ€ or â€œstopped but enabledâ€."><meta itemprop=wordCount content="794"><title>Service Type :: Choria Configuration Manager</title><link href=https://choria-cm.dev/design/service/index.html rel=canonical type=text/html title="Service Type :: Choria Configuration Manager"><link href=/design/service/index.xml rel=alternate type=application/rss+xml title="Service Type :: Choria Configuration Manager"><link href=/design/service/index.md rel=alternate type=text/markdown title="Service Type :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770664564 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770664564 defer></script><script src=/js/search-lunr.min.js?1770664564 defer></script><script src=/js/search.min.js?1770664564 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770664564"</script><script src=/js/lunr/lunr.min.js?1770664564 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770664564 defer></script><script src=/js/lunr/lunr.multi.min.js?1770664564 defer></script><script src=/js/lunr/lunr.en.min.js?1770664564 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770664564 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770664564 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770664564 rel=stylesheet><link href=/css/theme.min.css?1770664564 rel=stylesheet><link href=/css/format-print.min.css?1770664564 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/design/service/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/design/service/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#provider-interface>Provider Interface</a><ul><li><a href=#method-responsibilities>Method Responsibilities</a></li><li><a href=#status-response>Status Response</a></li></ul></li><li><a href=#available-providers>Available Providers</a></li><li><a href=#ensure-states>Ensure States</a></li><li><a href=#enable-property>Enable Property</a></li><li><a href=#apply-logic>Apply Logic</a><ul><li><a href=#phase-1-running-state>Phase 1: Running State</a></li><li><a href=#phase-2-enabled-state>Phase 2: Enabled State</a></li></ul></li><li><a href=#subscribe-behavior>Subscribe Behavior</a></li><li><a href=#idempotency>Idempotency</a></li><li><a href=#desired-state-validation>Desired State Validation</a></li><li><a href=#service-name-validation>Service Name Validation</a></li><li><a href=#noop-mode>Noop Mode</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/index.html><span itemprop=name>Design Documents</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Service Type</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/service/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/service/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/package/dnf/index.html title="DNF Provider (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/service/systemd/index.html title="Systemd Provider (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable design" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=service-type>Service Type</h1><p>This document describes the design of the service resource type for managing system services.</p><h2 id=overview>Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The service resource manages system services with two independent dimensions:</p><ul><li><strong>Running state</strong>: Whether the service is currently running or stopped</li><li><strong>Enabled state</strong>: Whether the service starts automatically at boot</li></ul><p>These are managed independently, allowing combinations like &ldquo;running but disabled&rdquo; or &ldquo;stopped but enabled&rdquo;.</p><h2 id=provider-interface>Provider Interface<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Service providers must implement the <code>ServiceProvider</code> interface:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ServiceProvider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Enable</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Disable</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Start</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Stop</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Restart</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>service</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ServiceState</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=method-responsibilities>Method Responsibilities<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Method</th><th>Responsibility</th></tr></thead><tbody><tr><td><code>Status</code></td><td>Query current running and enabled state</td></tr><tr><td><code>Start</code></td><td>Start the service if not running</td></tr><tr><td><code>Stop</code></td><td>Stop the service if running</td></tr><tr><td><code>Restart</code></td><td>Stop and start the service (for refresh)</td></tr><tr><td><code>Enable</code></td><td>Configure service to start at boot</td></tr><tr><td><code>Disable</code></td><td>Configure service to not start at boot</td></tr></tbody></table><h3 id=status-response>Status Response<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>Status</code> method returns a <code>ServiceState</code> containing:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ServiceState</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonResourceState</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>ServiceMetadata</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ServiceMetadata</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>     <span style=color:#66d9ef>string</span>  <span style=color:#75715e>// Service name</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>string</span>  <span style=color:#75715e>// Provider name (e.g., &#34;systemd&#34;)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Enabled</span>  <span style=color:#66d9ef>bool</span>    <span style=color:#75715e>// Whether service starts at boot</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Running</span>  <span style=color:#66d9ef>bool</span>    <span style=color:#75715e>// Whether service is currently running</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The <code>Ensure</code> field in <code>CommonResourceState</code> is set to:</p><ul><li><code>running</code> if the service is active</li><li><code>stopped</code> if the service is inactive</li></ul><h2 id=available-providers>Available Providers<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Provider</th><th>Init System</th><th>Documentation</th></tr></thead><tbody><tr><td><code>systemd</code></td><td>systemd</td><td><a href=/design/service/systemd/index.html>Systemd</a></td></tr></tbody></table><h2 id=ensure-states>Ensure States<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>running</code></td><td>Service must be running (default)</td></tr><tr><td><code>stopped</code></td><td>Service must be stopped</td></tr></tbody></table><p>If <code>ensure</code> is not specified, it defaults to <code>running</code>.</p><h2 id=enable-property>Enable Property<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>enable</code> property is a boolean pointer (<code>*bool</code>) with three possible states:</p><table><thead><tr><th>Value</th><th>Behavior</th></tr></thead><tbody><tr><td><code>true</code></td><td>Enable service to start at boot</td></tr><tr><td><code>false</code></td><td>Disable service from starting at boot</td></tr><tr><td><code>nil</code> (not set)</td><td>Leave boot configuration unchanged</td></tr></tbody></table><p>This allows managing running state without affecting boot configuration:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Start service but don&#39;t change boot config</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Start and enable at boot</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Stop and disable at boot</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>stopped</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>false</span></span></span></code></pre></div><h2 id=apply-logic>Apply Logic<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The service type applies changes in two phases:</p><h3 id=phase-1-running-state>Phase 1: Running State<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check for subscribe refresh             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Subscribed resource       â”‚
    â”‚ changed?                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Yes â”‚         â”‚ No
                  â–¼         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚ ensure=running?     â”‚ â”‚
    â”‚ already running?    â”‚ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
          Yes+Yes â”‚         â”‚
                  â–¼         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚ Restart   â”‚     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Compare ensure vs state â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ensure=stopped        â”‚ ensure=running        â”‚
    â”‚ state=running         â”‚ state=stopped         â”‚
    â–¼                       â–¼                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚ Stop   â”‚            â”‚ Start  â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                                                    â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚ No change     â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h3 id=phase-2-enabled-state>Phase 2: Enabled State<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>After running state is handled, enabled state is processed:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ enable property set?                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          nil     â”‚     true/false
          â–¼       â”‚
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚ No change â”‚   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                  â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Compare enable vs enabled   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ enable=true â”‚ enable=falseâ”‚
    â”‚ !enabled    â”‚ enabled     â”‚
    â–¼             â–¼             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚ Enable â”‚  â”‚ Disable â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                                â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ No change     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h2 id=subscribe-behavior>Subscribe Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Services can subscribe to other resources and restart when they change:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>httpd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/httpd/conf/httpd.conf</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>package#httpd</span></span></span></code></pre></div><p><strong>Special Cases:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td><code>ensure: stopped</code></td><td>Subscribe ignored (no restart)</td></tr><tr><td>Service not running + <code>ensure: running</code></td><td>Start (not restart)</td></tr><tr><td>Service running + <code>ensure: running</code></td><td>Restart</td></tr></tbody></table><p>This prevents restarting stopped services and ensures a clean start when the service should be running but isn&rsquo;t.</p><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The service resource is idempotent through state comparison:</p><table><thead><tr><th>Desired</th><th>Current</th><th>Action</th></tr></thead><tbody><tr><td><code>ensure: running</code></td><td>running</td><td>None</td></tr><tr><td><code>ensure: running</code></td><td>stopped</td><td>Start</td></tr><tr><td><code>ensure: stopped</code></td><td>stopped</td><td>None</td></tr><tr><td><code>ensure: stopped</code></td><td>running</td><td>Stop</td></tr><tr><td><code>enable: true</code></td><td>enabled</td><td>None</td></tr><tr><td><code>enable: true</code></td><td>disabled</td><td>Enable</td></tr><tr><td><code>enable: false</code></td><td>enabled</td><td>Disable</td></tr><tr><td><code>enable: false</code></td><td>disabled</td><td>None</td></tr><tr><td><code>enable: nil</code></td><td>any</td><td>None</td></tr></tbody></table><h2 id=desired-state-validation>Desired State Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>After applying changes, the type verifies the service reached the desired state:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Type</span>) <span style=color:#a6e22e>isDesiredState</span>(<span style=color:#a6e22e>properties</span>, <span style=color:#a6e22e>state</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check running state</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Ensure</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>Ensure</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check enabled state (only if explicitly set)</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Enable</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Enable</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>state</span>.<span style=color:#a6e22e>Metadata</span>.<span style=color:#a6e22e>Enabled</span> {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>If the desired state is not reached, an <code>ErrDesiredStateFailed</code> error is returned.</p><h2 id=service-name-validation>Service Name Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Service names are validated to prevent injection attacks:</p><p><strong>Allowed Characters:</strong></p><ul><li>Alphanumeric (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>)</li><li>Period (<code>.</code>), underscore (<code>_</code>), plus (<code>+</code>)</li><li>Colon (<code>:</code>), tilde (<code>~</code>), hyphen (<code>-</code>)</li></ul><p><strong>Rejected:</strong></p><ul><li>Shell metacharacters (<code>;</code>, <code>|</code>, <code>&</code>, etc.)</li><li>Whitespace</li><li>Path separators</li></ul><h2 id=noop-mode>Noop Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>In noop mode, the service type:</p><ol><li>Queries current state normally</li><li>Logs what actions would be taken</li><li>Sets appropriate <code>NoopMessage</code> (e.g., &ldquo;Would have started&rdquo;, &ldquo;Would have enabled&rdquo;)</li><li>Reports <code>Changed: true</code> if changes would occur</li><li>Does not call provider Start/Stop/Restart/Enable/Disable methods</li></ol><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Service Type</h1><article class=default><header class=headline></header><h1 id=systemd-provider>Systemd Provider</h1><p>This document describes the implementation details of the Systemd service provider for managing system services via <code>systemctl</code>.</p><h2 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Systemd provider is selected when <code>systemctl</code> is found in the system PATH. The provider checks for the executable using <code>util.ExecutableInPath("systemctl")</code>.</p><p><strong>Availability Check:</strong></p><ul><li>Searches PATH for <code>systemctl</code></li><li>Returns priority 1 if found</li><li>Returns unavailable if not found</li></ul><h2 id=concurrency>Concurrency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A global service lock (<code>model.ServiceGlobalLock</code>) is held during all <code>systemctl</code> command executions to prevent concurrent systemd operations within the same process. This prevents race conditions when multiple service resources are managed simultaneously.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Provider</span>) <span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>cmd</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>args</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>string</span>) (<span style=color:#f92672>...</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ServiceGlobalLock</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ServiceGlobalLock</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>runner</span>.<span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>cmd</span>, <span style=color:#a6e22e>args</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=daemon-reload>Daemon Reload<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The provider performs a <code>systemctl daemon-reload</code> once per provider instance before any service operations. This ensures systemd picks up any unit file changes made by other resources (e.g., file resources managing unit files).</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>p</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Provider</span>) <span style=color:#a6e22e>maybeReload</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Lock</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>mu</span>.<span style=color:#a6e22e>Unlock</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>didReload</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>execute</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#e6db74>&#34;systemctl&#34;</span>, <span style=color:#e6db74>&#34;daemon-reload&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The reload is performed only once, tracked by the <code>didReload</code> flag.</p><h2 id=operations>Operations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=status>Status<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Commands:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl is-active --system &lt;service&gt;
systemctl is-enabled --system &lt;service&gt;</code></pre></div><p><strong>Active State Detection:</strong></p><table><thead><tr><th><code>is-active</code> Output</th><th>Interpreted As</th></tr></thead><tbody><tr><td><code>active</code></td><td>Running</td></tr><tr><td><code>inactive</code></td><td>Stopped</td></tr><tr><td><code>failed</code></td><td>Stopped</td></tr><tr><td><code>activating</code></td><td>Stopped</td></tr><tr><td>Other</td><td>Error</td></tr></tbody></table><p><strong>Enabled State Detection:</strong></p><table><thead><tr><th><code>is-enabled</code> Output</th><th>Interpreted As</th></tr></thead><tbody><tr><td><code>enabled</code></td><td>Enabled</td></tr><tr><td><code>enabled-runtime</code></td><td>Enabled</td></tr><tr><td><code>alias</code></td><td>Enabled</td></tr><tr><td><code>static</code></td><td>Enabled</td></tr><tr><td><code>indirect</code></td><td>Enabled</td></tr><tr><td><code>generated</code></td><td>Enabled</td></tr><tr><td><code>transient</code></td><td>Enabled</td></tr><tr><td><code>linked</code></td><td>Disabled</td></tr><tr><td><code>linked-runtime</code></td><td>Disabled</td></tr><tr><td><code>masked</code></td><td>Disabled</td></tr><tr><td><code>masked-runtime</code></td><td>Disabled</td></tr><tr><td><code>disabled</code></td><td>Disabled</td></tr><tr><td><code>not-found</code></td><td>Error: service not found</td></tr></tbody></table><p><strong>Returned State:</strong></p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td><code>Ensure</code></td><td><code>running</code> or <code>stopped</code> based on is-active</td></tr><tr><td><code>Metadata.Enabled</code></td><td>Boolean from is-enabled</td></tr><tr><td><code>Metadata.Running</code></td><td>Boolean from is-active</td></tr><tr><td><code>Metadata.Provider</code></td><td>&ldquo;systemd&rdquo;</td></tr></tbody></table><h3 id=start>Start<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Command:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl start --system &lt;service&gt;</code></pre></div><p>Called when <code>ensure: running</code> and service is currently stopped.</p><h3 id=stop>Stop<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Command:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl stop --system &lt;service&gt;</code></pre></div><p>Called when <code>ensure: stopped</code> and service is currently running.</p><h3 id=restart>Restart<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Command:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl restart --system &lt;service&gt;</code></pre></div><p>Called when a subscribed resource has changed and the service should be refreshed.</p><h3 id=enable>Enable<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Command:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl enable --system &lt;service&gt;</code></pre></div><p>Called when <code>enable: true</code> and service is currently disabled.</p><h3 id=disable>Disable<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Command:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>systemctl disable --system &lt;service&gt;</code></pre></div><p>Called when <code>enable: false</code> and service is currently enabled.</p><h2 id=command-flags>Command Flags<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>All commands use the <code>--system</code> flag to explicitly target system-level units (as opposed to user-level units managed with <code>--user</code>).</p><h2 id=decision-flow>Decision Flow<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=ensure-state-runningstopped>Ensure State (Running/Stopped)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subscribe triggered?                     â”‚
â”‚ (subscribed resource changed)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ Yes           â”‚ No
              â”‚               â”‚
              â”‚               â–¼
              â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚       â”‚ Ensure = stopped? â”‚
              â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚           Yes   â”‚   No
              â”‚           â–¼     â–¼
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   â”‚ Running?â”‚ â”‚ Ensure = running? â”‚
              â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚    Yes â”‚ No         Yes â”‚   No
              â”‚        â–¼               â–¼
              â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   â”‚ Stop   â”‚    â”‚ Running?â”‚
              â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
              â”‚                  No  â”‚ Yes
              â”‚                      â–¼
              â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                 â”‚ Start  â”‚
              â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Ensure = running?             â”‚
      â”‚ (only restart running services)â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  Yes â”‚   No
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Restart     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><p><strong>Subscribe Behavior Notes:</strong></p><ul><li>Restart only occurs if <code>ensure: running</code></li><li>If service is stopped and <code>ensure: running</code>, it starts instead of restarting</li><li>Subscribe is ignored if <code>ensure: stopped</code></li></ul><h3 id=enable-state>Enable State<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Enable/disable is processed independently after ensure state:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Enable property set?                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ Yes           â”‚ No (nil)
              â”‚               â”‚
              â”‚               â–¼
              â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚       â”‚ No change     â”‚
              â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Enable = true?                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  Yes â”‚   No
                      â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Currently enabled?             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  No  â”‚ Yes
                      â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Enable      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      (Similar flow for disable when enable=false)</code></pre></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The service resource checks current state before making changes:</p><table><thead><tr><th>Desired State</th><th>Current State</th><th>Action</th></tr></thead><tbody><tr><td><code>running</code></td><td><code>running</code></td><td>None</td></tr><tr><td><code>running</code></td><td><code>stopped</code></td><td>Start</td></tr><tr><td><code>stopped</code></td><td><code>stopped</code></td><td>None</td></tr><tr><td><code>stopped</code></td><td><code>running</code></td><td>Stop</td></tr><tr><td><code>enable: true</code></td><td>enabled</td><td>None</td></tr><tr><td><code>enable: true</code></td><td>disabled</td><td>Enable</td></tr><tr><td><code>enable: false</code></td><td>enabled</td><td>Disable</td></tr><tr><td><code>enable: false</code></td><td>disabled</td><td>None</td></tr><tr><td><code>enable: nil</code></td><td>any</td><td>None</td></tr></tbody></table><h2 id=service-name-validation>Service Name Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Service names are validated to prevent shell injection:</p><p><strong>Dangerous Characters Check:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>dangerousCharsRegex</span>.<span style=color:#a6e22e>MatchString</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;service name contains dangerous characters: %q&#34;</span>, <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p><strong>Allowed Characters:</strong></p><ul><li>Alphanumeric (<code>a-z</code>, <code>A-Z</code>, <code>0-9</code>)</li><li>Period (<code>.</code>)</li><li>Underscore (<code>_</code>)</li><li>Plus (<code>+</code>)</li><li>Colon (<code>:</code>)</li><li>Tilde (<code>~</code>)</li><li>Hyphen (<code>-</code>)</li></ul><p><strong>Examples:</strong></p><table><thead><tr><th>Name</th><th>Valid</th></tr></thead><tbody><tr><td><code>httpd</code></td><td>Yes</td></tr><tr><td><code>nginx.service</code></td><td>Yes</td></tr><tr><td><code>my-app_v2</code></td><td>Yes</td></tr><tr><td><code>app@instance</code></td><td>No (@ not allowed)</td></tr><tr><td><code>app; rm -rf /</code></td><td>No (shell metacharacters)</td></tr></tbody></table><h2 id=subscribe-and-refresh>Subscribe and Refresh<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Services can subscribe to other resources and restart when they change:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/myapp/config.yaml</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>content</span>: <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0644&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/myapp/config.yaml</span></span></span></code></pre></div><p><strong>Behavior:</strong></p><ul><li>When the file resource changes, the service is restarted</li><li>Restart only occurs if <code>ensure: running</code></li><li>If service was stopped and should be running, it starts (not restarts)</li></ul><h2 id=error-handling>Error Handling<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td><code>systemctl</code> not in PATH</td><td>Provider unavailable</td></tr><tr><td>Service not found</td><td>Error from <code>is-enabled</code>: &ldquo;service not found&rdquo;</td></tr><tr><td>Unknown <code>is-active</code> output</td><td>Error: &ldquo;invalid systemctl is-active output&rdquo;</td></tr><tr><td>Unknown <code>is-enabled</code> output</td><td>Error: &ldquo;invalid systemctl is-enabled output&rdquo;</td></tr><tr><td>Command execution failure</td><td>Error propagated from runner</td></tr></tbody></table><h2 id=platform-support>Platform Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Systemd provider requires:</p><ul><li>Linux with systemd as init system</li><li><code>systemctl</code> command available in PATH</li></ul><p>It does not support:</p><ul><li>Non-systemd init systems (SysVinit, Upstart, OpenRC)</li><li>User-level units (uses <code>--system</code> flag)</li><li>Windows, macOS, or BSD systems</li></ul><footer class=footline></footer></article></section></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770664564 defer></script><script src=/js/theme.min.js?1770664564 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>