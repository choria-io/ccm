<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="This document describes the design of the file resource type for managing files and directories.
Overview The file resource manages files and directories with three aspects:
Existence: Whether the file/directory exists or is absent Content: The contents of a file (from inline content or source file) Attributes: Owner, group, and permissions Provider Interface File providers must implement the FileProvider interface:"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="File Type :: Choria Configuration Manager"><meta name=twitter:description content="This document describes the design of the file resource type for managing files and directories.
Overview The file resource manages files and directories with three aspects:
Existence: Whether the file/directory exists or is absent Content: The contents of a file (from inline content or source file) Attributes: Owner, group, and permissions Provider Interface File providers must implement the FileProvider interface:"><meta property="og:url" content="https://choria-cm.dev/design/file/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="File Type :: Choria Configuration Manager"><meta property="og:description" content="This document describes the design of the file resource type for managing files and directories.
Overview The file resource manages files and directories with three aspects:
Existence: Whether the file/directory exists or is absent Content: The contents of a file (from inline content or source file) Attributes: Owner, group, and permissions Provider Interface File providers must implement the FileProvider interface:"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="File Type :: Choria Configuration Manager"><meta itemprop=description content="This document describes the design of the file resource type for managing files and directories.
Overview The file resource manages files and directories with three aspects:
Existence: Whether the file/directory exists or is absent Content: The contents of a file (from inline content or source file) Attributes: Owner, group, and permissions Provider Interface File providers must implement the FileProvider interface:"><meta itemprop=wordCount content="806"><title>File Type :: Choria Configuration Manager</title><link href=https://choria-cm.dev/design/file/index.html rel=canonical type=text/html title="File Type :: Choria Configuration Manager"><link href=/design/file/index.xml rel=alternate type=application/rss+xml title="File Type :: Choria Configuration Manager"><link href=/design/file/index.md rel=alternate type=text/markdown title="File Type :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770664564 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770664564 defer></script><script src=/js/search-lunr.min.js?1770664564 defer></script><script src=/js/search.min.js?1770664564 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770664564"</script><script src=/js/lunr/lunr.min.js?1770664564 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770664564 defer></script><script src=/js/lunr/lunr.multi.min.js?1770664564 defer></script><script src=/js/lunr/lunr.en.min.js?1770664564 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770664564 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770664564 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770664564 rel=stylesheet><link href=/css/theme.min.css?1770664564 rel=stylesheet><link href=/css/format-print.min.css?1770664564 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/design/file/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/design/file/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#provider-interface>Provider Interface</a><ul><li><a href=#method-responsibilities>Method Responsibilities</a></li><li><a href=#status-response>Status Response</a></li></ul></li><li><a href=#available-providers>Available Providers</a></li><li><a href=#ensure-states>Ensure States</a></li><li><a href=#content-sources>Content Sources</a></li><li><a href=#required-properties>Required Properties</a></li><li><a href=#apply-logic>Apply Logic</a></li><li><a href=#idempotency>Idempotency</a><ul><li><a href=#state-checks-in-order>State Checks (in order)</a></li><li><a href=#decision-table>Decision Table</a></li><li><a href=#content-comparison>Content Comparison</a></li></ul></li><li><a href=#mode-validation>Mode Validation</a></li><li><a href=#path-validation>Path Validation</a></li><li><a href=#working-directory>Working Directory</a></li><li><a href=#noop-mode>Noop Mode</a></li><li><a href=#desired-state-validation>Desired State Validation</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/index.html><span itemprop=name>Design Documents</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>File Type</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/file/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/file/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/shell/index.html title="Shell Provider (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/file/posix/index.html title="Posix Provider (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable design" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=file-type>File Type</h1><p>This document describes the design of the file resource type for managing files and directories.</p><h2 id=overview>Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The file resource manages files and directories with three aspects:</p><ul><li><strong>Existence</strong>: Whether the file/directory exists or is absent</li><li><strong>Content</strong>: The contents of a file (from inline content or source file)</li><li><strong>Attributes</strong>: Owner, group, and permissions</li></ul><h2 id=provider-interface>Provider Interface<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>File providers must implement the <code>FileProvider</code> interface:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FileProvider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CreateDirectory</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>dir</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>owner</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>group</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>mode</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Store</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>file</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>contents</span> []<span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>source</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>owner</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>group</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>mode</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>file</span> <span style=color:#66d9ef>string</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>FileState</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=method-responsibilities>Method Responsibilities<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Method</th><th>Responsibility</th></tr></thead><tbody><tr><td><code>Status</code></td><td>Query current file state (existence, type, content hash, attributes)</td></tr><tr><td><code>Store</code></td><td>Create or update a file with content and attributes</td></tr><tr><td><code>CreateDirectory</code></td><td>Create a directory with attributes</td></tr></tbody></table><h3 id=status-response>Status Response<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>Status</code> method returns a <code>FileState</code> containing:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FileState</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonResourceState</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Metadata</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>FileMetadata</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>FileMetadata</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span>     <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// File path</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Checksum</span> <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// SHA256 hash of contents (files only)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Owner</span>    <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// Owner username</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Group</span>    <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// Group name</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Mode</span>     <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// Permissions in octal (e.g., &#34;0644&#34;)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Provider</span> <span style=color:#66d9ef>string</span>         <span style=color:#75715e>// Provider name (e.g., &#34;posix&#34;)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MTime</span>    <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Time</span>      <span style=color:#75715e>// Modification time</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Size</span>     <span style=color:#66d9ef>int64</span>          <span style=color:#75715e>// File size in bytes</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Extended</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>any</span> <span style=color:#75715e>// Provider-specific metadata</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The <code>Ensure</code> field in <code>CommonResourceState</code> is set to:</p><ul><li><code>present</code> if a regular file exists</li><li><code>directory</code> if a directory exists</li><li><code>absent</code> if the path does not exist</li></ul><h2 id=available-providers>Available Providers<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Provider</th><th>Platform</th><th>Documentation</th></tr></thead><tbody><tr><td><code>posix</code></td><td>Unix/Linux</td><td><a href=/design/file/posix/index.html>Posix</a></td></tr></tbody></table><h2 id=ensure-states>Ensure States<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>Path must be a regular file with specified content</td></tr><tr><td><code>absent</code></td><td>Path must not exist</td></tr><tr><td><code>directory</code></td><td>Path must be a directory</td></tr></tbody></table><h2 id=content-sources>Content Sources<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Files can receive content from two mutually exclusive sources:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>contents</code></td><td>Inline string content (template-resolved)</td></tr><tr><td><code>source</code></td><td>Path to local file to copy from</td></tr></tbody></table><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Inline content with template</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/motd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>content</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          Welcome to {{ lookup(&#39;facts.hostname&#39;) }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          Managed by CCM</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0644&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Copy from source file</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/app/config.yaml</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>files/config.yaml</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0640&#34;</span></span></span></code></pre></div><p>When using <code>source</code>, the path is relative to the manifest&rsquo;s working directory if one is set.</p><h2 id=required-properties>Required Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Unlike some resources, file resources require explicit attributes:</p><table><thead><tr><th>Property</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>owner</code></td><td>Yes</td><td>Username that owns the file</td></tr><tr><td><code>group</code></td><td>Yes</td><td>Group that owns the file</td></tr><tr><td><code>mode</code></td><td>Yes</td><td>Permissions in octal notation</td></tr></tbody></table><p>This prevents accidental creation of files with default or inherited permissions.</p><h2 id=apply-logic>Apply Logic<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get current state via Status()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Is current state desired state?         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Yes â”‚         No
                  â–¼         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚ No change â”‚     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ What is desired ensure? â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ absent                â”‚ directory             â”‚ present
    â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remove     â”‚      â”‚ CreateDir     â”‚      â”‚ Store         â”‚
â”‚ (os.Remove)â”‚      â”‚               â”‚      â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The file resource checks multiple attributes for idempotency:</p><h3 id=state-checks-in-order>State Checks (in order)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><ol><li><strong>Ensure match</strong>: Current type matches desired (<code>present</code>/<code>absent</code>/<code>directory</code>)</li><li><strong>Content match</strong>: SHA256 checksum of contents matches (for <code>ensure: present</code>)</li><li><strong>Owner match</strong>: Current owner matches desired</li><li><strong>Group match</strong>: Current group matches desired</li><li><strong>Mode match</strong>: Current permissions match desired</li></ol><h3 id=decision-table>Decision Table<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Desired</th><th>Current State</th><th>Action</th></tr></thead><tbody><tr><td><code>absent</code></td><td>absent</td><td>None</td></tr><tr><td><code>absent</code></td><td>present/directory</td><td>Remove</td></tr><tr><td><code>directory</code></td><td>directory + matching attrs</td><td>None</td></tr><tr><td><code>directory</code></td><td>absent/present</td><td>CreateDirectory</td></tr><tr><td><code>directory</code></td><td>directory + wrong attrs</td><td>CreateDirectory (updates attrs)</td></tr><tr><td><code>present</code></td><td>present + matching all</td><td>None</td></tr><tr><td><code>present</code></td><td>absent</td><td>Store</td></tr><tr><td><code>present</code></td><td>present + wrong content</td><td>Store</td></tr><tr><td><code>present</code></td><td>present + wrong attrs</td><td>Store</td></tr></tbody></table><h3 id=content-comparison>Content Comparison<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Content is compared using SHA256 checksums:</p><table><thead><tr><th>Source</th><th>Checksum Method</th></tr></thead><tbody><tr><td><code>contents</code> property</td><td><code>Sha256HashBytes([]byte(contents))</code></td></tr><tr><td><code>source</code> property</td><td><code>Sha256HashFile(adjustedPath)</code></td></tr><tr><td>Existing file</td><td><code>Sha256HashFile(filePath)</code></td></tr></tbody></table><h2 id=mode-validation>Mode Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>File modes are validated during resource creation:</p><p><strong>Valid Formats:</strong></p><ul><li><code>"0644"</code> - Standard octal</li><li><code>"644"</code> - Without leading zero</li><li><code>"0o755"</code> - With <code>0o</code> prefix</li><li><code>"0O700"</code> - With <code>0O</code> prefix</li></ul><p><strong>Validation Rules:</strong></p><ul><li>Must be valid octal number (digits 0-7)</li><li>Must be â‰¤ <code>0777</code> (no setuid/setgid/sticky via mode)</li></ul><h2 id=path-validation>Path Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>File paths must be:</p><ul><li>Absolute (start with <code>/</code>)</li><li>Clean (no <code>.</code> or <code>..</code> components, <code>filepath.Clean(path) == path</code>)</li></ul><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Clean</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;file path must be absolute&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=working-directory>Working Directory<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When a manifest has a working directory (e.g., extracted from an archive), the <code>source</code> property is resolved relative to it:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Source</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>WorkingDirectory</span>() <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span> = <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>WorkingDirectory</span>(), <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Source</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>This allows manifests bundled with their source files to use relative paths.</p><h2 id=noop-mode>Noop Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>In noop mode, the file type:</p><ol><li>Queries current state normally</li><li>Computes content checksums</li><li>Logs what actions would be taken</li><li>Sets appropriate <code>NoopMessage</code>:<ul><li>&ldquo;Would have created the file&rdquo;</li><li>&ldquo;Would have created directory&rdquo;</li><li>&ldquo;Would have removed the file&rdquo;</li></ul></li><li>Reports <code>Changed: true</code> if changes would occur</li><li>Does not call provider Store/CreateDirectory methods</li><li>Does not remove files</li></ol><h2 id=desired-state-validation>Desired State Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>After applying changes (in non-noop mode), the type verifies the file reached the desired state by calling <code>Status()</code> again and checking all attributes match. If validation fails, <code>ErrDesiredStateFailed</code> is returned.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of File Type</h1><article class=default><header class=headline></header><h1 id=posix-provider>Posix Provider</h1><p>This document describes the implementation details of the Posix file provider for managing files and directories on Unix-like systems.</p><h2 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Posix provider is the default and only file provider. It is always available and returns priority 1 for all file resources.</p><h2 id=operations>Operations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=store-createupdate-file>Store (Create/Update File)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Verify parent directory exists</li><li>Parse file mode from octal string</li><li>Open source file if <code>source</code> property is set</li><li>Create temporary file in the same directory as target</li><li>Set file permissions on temp file</li><li>Write content (from <code>source</code> file or <code>contents</code> property)</li><li>Set ownership (chown) on temp file</li><li>Close temp file</li><li>Atomic rename temp file to target path</li></ol><p><strong>Atomic Write Pattern:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[parent dir]/&lt;basename&gt;.* (temp file)
    â†“ chmod (set permissions)
    â†“ write content
    â†“ chown (set owner/group)
    â†“ close
    â†“ rename
[parent dir]/&lt;basename&gt; (final file)</code></pre></div><p>The temp file is created in the same directory as the target to ensure <code>os.Rename()</code> is atomic (same filesystem).</p><p><strong>Content Sources:</strong></p><table><thead><tr><th>Property</th><th>Behavior</th></tr></thead><tbody><tr><td><code>contents</code></td><td>Write string directly to file (template-resolved)</td></tr><tr><td><code>source</code></td><td>Copy from local file path (adjusted for working directory)</td></tr></tbody></table><p>If both are empty, an empty file is created.</p><p><strong>Error Handling:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td>Parent directory doesn&rsquo;t exist</td><td>Return error: &ldquo;is not a directory&rdquo;</td></tr><tr><td>Invalid mode format</td><td>Return error from <code>strconv.ParseUint</code></td></tr><tr><td>Source file not found</td><td>Return error from <code>os.Open</code></td></tr><tr><td>Permission denied</td><td>Return error from underlying syscall</td></tr><tr><td>Rename failure</td><td>Return error: &ldquo;could not rename temporary file&rdquo;</td></tr></tbody></table><h3 id=createdirectory>CreateDirectory<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Parse file mode from octal string</li><li>Create directory and parents via <code>os.MkdirAll()</code></li><li>Lookup numeric UID/GID from owner/group names</li><li>Set permissions via <code>os.Chmod()</code> (ensures correct mode even if umask affected MkdirAll)</li><li>Set ownership via <code>os.Chown()</code></li></ol><p><strong>Command Sequence:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>MkdirAll</span>(<span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>parsedMode</span>)    <span style=color:#75715e>// Create directory tree</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Chmod</span>(<span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>parsedMode</span>)        <span style=color:#75715e>// Ensure correct permissions</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Chown</span>(<span style=color:#a6e22e>dir</span>, <span style=color:#a6e22e>uid</span>, <span style=color:#a6e22e>gid</span>)          <span style=color:#75715e>// Set ownership</span></span></span></code></pre></div><p>The explicit <code>Chmod</code> after <code>MkdirAll</code> is necessary because <code>MkdirAll</code> applies the process umask to the mode.</p><h3 id=status>Status<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Initialize state with default metadata</li><li>Call <code>os.Stat()</code> on file path</li><li>Based on result, populate state accordingly</li></ol><p><strong>State Detection:</strong></p><table><thead><tr><th><code>os.Stat()</code> Result</th><th>Ensure Value</th><th>Metadata</th></tr></thead><tbody><tr><td>File exists</td><td><code>present</code></td><td>Size, mtime, owner, group, mode, checksum</td></tr><tr><td>Directory exists</td><td><code>directory</code></td><td>Size, mtime, owner, group, mode</td></tr><tr><td><code>os.ErrNotExist</code></td><td><code>absent</code></td><td>None</td></tr><tr><td><code>os.ErrPermission</code></td><td><code>absent</code></td><td>None (logged as warning)</td></tr><tr><td>Other error</td><td>(unchanged)</td><td>None (logged as warning)</td></tr></tbody></table><p><strong>Metadata Collection:</strong></p><table><thead><tr><th>Field</th><th>Source</th></tr></thead><tbody><tr><td><code>Name</code></td><td>From properties</td></tr><tr><td><code>Provider</code></td><td>&ldquo;posix&rdquo;</td></tr><tr><td><code>Size</code></td><td><code>FileInfo.Size()</code></td></tr><tr><td><code>MTime</code></td><td><code>FileInfo.ModTime()</code></td></tr><tr><td><code>Owner</code></td><td><code>util.GetFileOwner()</code> - resolves UID to username</td></tr><tr><td><code>Group</code></td><td><code>util.GetFileOwner()</code> - resolves GID to group name</td></tr><tr><td><code>Mode</code></td><td><code>util.GetFileOwner()</code> - octal string (e.g., &ldquo;0644&rdquo;)</td></tr><tr><td><code>Checksum</code></td><td><code>util.Sha256HashFile()</code> - SHA256 hash (files only)</td></tr></tbody></table><p><strong>Note:</strong> Checksum is only calculated for regular files, not directories.</p><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The file resource achieves idempotency by comparing current state against desired state:</p><h3 id=state-checks>State Checks<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>isDesiredState()</code> function checks (in order):</p><ol><li><strong>Ensure value matches</strong> - <code>present</code>, <code>absent</code>, or <code>directory</code></li><li><strong>Content checksum matches</strong> - SHA256 of contents vs existing file (for files only)</li><li><strong>Owner matches</strong> - Username comparison</li><li><strong>Group matches</strong> - Group name comparison</li><li><strong>Mode matches</strong> - Octal permission string comparison</li></ol><h3 id=decision-flow>Decision Flow<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ What is the desired ensure state?       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ absent      â”‚ directory   â”‚ present     â”‚
    â–¼             â–¼             â–¼             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ File      â”‚ â”‚ Directory â”‚ â”‚ File exists?  â”‚ â”‚
â”‚ exists?   â”‚ â”‚ exists?   â”‚ â”‚ Content match?â”‚ â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ Owner match?  â”‚ â”‚
      â”‚             â”‚       â”‚ Group match?  â”‚ â”‚
  Yes â”‚ No      Yes â”‚ No    â”‚ Mode match?   â”‚ â”‚
      â–¼             â–¼       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚         â”‚
â”‚ Remove  â”‚ â”‚ Stable    â”‚     All Yesâ”‚    No   â”‚
â”‚ file    â”‚ â”‚           â”‚           â–¼         â–¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ Stable    â”‚ â”‚ Store     â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h3 id=content-comparison>Content Comparison<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>For files with <code>ensure: present</code>:</p><table><thead><tr><th>Content Source</th><th>Checksum Calculation</th></tr></thead><tbody><tr><td><code>contents</code> property</td><td><code>Sha256HashBytes([]byte(contents))</code></td></tr><tr><td><code>source</code> property</td><td><code>Sha256HashFile(adjustedSourcePath)</code></td></tr></tbody></table><p>The source path is adjusted based on the manager&rsquo;s working directory when set.</p><h2 id=mode-validation>Mode Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>File modes are validated during resource creation:</p><ol><li>Strip optional <code>0o</code> or <code>0O</code> prefix</li><li>Parse as octal number (base 8)</li><li>Validate range: must be â‰¤ <code>0777</code></li></ol><p><strong>Valid Mode Examples:</strong></p><table><thead><tr><th>Input</th><th>Parsed Value</th></tr></thead><tbody><tr><td><code>"0644"</code></td><td>0o644</td></tr><tr><td><code>"644"</code></td><td>0o644</td></tr><tr><td><code>"0o755"</code></td><td>0o755</td></tr><tr><td><code>"0O700"</code></td><td>0o700</td></tr></tbody></table><p><strong>Invalid Mode Examples:</strong></p><table><thead><tr><th>Input</th><th>Error</th></tr></thead><tbody><tr><td><code>"0888"</code></td><td>Invalid octal digit</td></tr><tr><td><code>"1777"</code></td><td>Exceeds maximum (setuid/setgid not supported via mode)</td></tr><tr><td><code>"rw-r--r--"</code></td><td>Not octal format</td></tr></tbody></table><h2 id=ownership-resolution>Ownership Resolution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Owner and group names are resolved to numeric UID/GID via:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>uid</span>, <span style=color:#a6e22e>gid</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>LookupOwnerGroup</span>(<span style=color:#a6e22e>owner</span>, <span style=color:#a6e22e>group</span>)</span></span></code></pre></div><p>This uses the system&rsquo;s user database (<code>/etc/passwd</code>, <code>/etc/group</code>, or equivalent):</p><ul><li><code>user.Lookup(owner)</code> â†’ UID</li><li><code>user.LookupGroup(group)</code> â†’ GID</li></ul><p><strong>Error Handling:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td>User not found</td><td>Return error: &ldquo;could not lookup user&rdquo;</td></tr><tr><td>Group not found</td><td>Return error: &ldquo;could not lookup group&rdquo;</td></tr><tr><td>Invalid UID/GID format</td><td>Return error from <code>strconv.Atoi</code></td></tr></tbody></table><h2 id=working-directory-support>Working Directory Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When a manager has a working directory set (e.g., from extracted manifest), the <code>source</code> property path is adjusted:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Type</span>) <span style=color:#a6e22e>adjustedSource</span>(<span style=color:#a6e22e>properties</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>FileResourceProperties</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Source</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Source</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>WorkingDirectory</span>() <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>source</span> = <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>mgr</span>.<span style=color:#a6e22e>WorkingDirectory</span>(), <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Source</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>source</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>This allows manifests to use relative paths for source files bundled with the manifest.</p><h2 id=platform-support>Platform Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Posix provider uses Unix-specific system calls:</p><table><thead><tr><th>Operation</th><th>System Call</th></tr></thead><tbody><tr><td>Get file owner/group</td><td><code>syscall.Stat_t</code> (UID/GID from stat)</td></tr><tr><td>Set ownership</td><td><code>os.Chown()</code> â†’ <code>chown(2)</code></td></tr><tr><td>Set permissions</td><td><code>os.Chmod()</code> â†’ <code>chmod(2)</code></td></tr></tbody></table><p>The provider has separate implementations for Unix and Windows (<code>file_unix.go</code>, <code>file_windows.go</code> in <code>internal/util</code>), with Windows returning errors for ownership operations.</p><h2 id=security-considerations>Security Considerations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=atomic-writes>Atomic Writes<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Files are written atomically via temp file + rename. This prevents:</p><ul><li>Partial file reads during write</li><li>Corruption if process is interrupted</li><li>Race conditions with concurrent readers</li></ul><h3 id=permission-ordering>Permission Ordering<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Permissions and ownership are set on the temp file before rename:</p><ol><li><code>Chmod</code> - Set permissions</li><li>Write content</li><li><code>Chown</code> - Set ownership</li><li>Rename to target</li></ol><p>This ensures the file never exists at the target path with incorrect permissions.</p><h3 id=path-validation>Path Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>File paths must be absolute and clean (no <code>.</code> or <code>..</code> components):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Clean</span>(<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Name</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;file path must be absolute&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=required-properties>Required Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Owner, group, and mode are required properties and cannot be empty, preventing accidental creation of files with default/inherited permissions.</p><footer class=footline></footer></article></section></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770664564 defer></script><script src=/js/theme.min.js?1770664564 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>