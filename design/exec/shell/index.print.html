<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 9.0.3"><meta name=description content="This document describes the implementation details of the Shell exec provider for executing commands via /bin/sh.
Provider Selection The Shell provider is selected when provider: shell is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.
Availability: The provider checks for the existence of /bin/sh via util.FileExists(). If /bin/sh does not exist, the provider is not available."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Shell Provider :: Choria Configuration Manager"><meta name=twitter:description content="This document describes the implementation details of the Shell exec provider for executing commands via /bin/sh.
Provider Selection The Shell provider is selected when provider: shell is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.
Availability: The provider checks for the existence of /bin/sh via util.FileExists(). If /bin/sh does not exist, the provider is not available."><meta property="og:url" content="https://choria-cm.dev/design/exec/shell/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Shell Provider :: Choria Configuration Manager"><meta property="og:description" content="This document describes the implementation details of the Shell exec provider for executing commands via /bin/sh.
Provider Selection The Shell provider is selected when provider: shell is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.
Availability: The provider checks for the existence of /bin/sh via util.FileExists(). If /bin/sh does not exist, the provider is not available."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Design Documents"><meta itemprop=name content="Shell Provider :: Choria Configuration Manager"><meta itemprop=description content="This document describes the implementation details of the Shell exec provider for executing commands via /bin/sh.
Provider Selection The Shell provider is selected when provider: shell is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.
Availability: The provider checks for the existence of /bin/sh via util.FileExists(). If /bin/sh does not exist, the provider is not available."><meta itemprop=wordCount content="908"><title>Shell Provider :: Choria Configuration Manager</title><link href=https://choria-cm.dev/design/exec/shell/index.html rel=canonical type=text/html title="Shell Provider :: Choria Configuration Manager"><link href=/design/exec/shell/index.md rel=alternate type=text/markdown title="Shell Provider :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770629494 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770629494 defer></script><script src=/js/search-lunr.min.js?1770629494 defer></script><script src=/js/search.min.js?1770629494 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770629494"</script><script src=/js/lunr/lunr.min.js?1770629494 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770629494 defer></script><script src=/js/lunr/lunr.multi.min.js?1770629494 defer></script><script src=/js/lunr/lunr.en.min.js?1770629494 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770629494 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770629494 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770629494 rel=stylesheet><link href=/css/theme.min.css?1770629494 rel=stylesheet><link href=/css/format-print.min.css?1770629494 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/design/exec/shell/index.html",window.relearn.relBasePath="../../..",window.relearn.relBaseUri="../../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/design/exec/shell/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#provider-selection>Provider Selection</a></li><li><a href=#comparison-with-posix-provider>Comparison with Posix Provider</a></li><li><a href=#operations>Operations</a><ul><li><a href=#execute>Execute</a></li><li><a href=#status>Status</a></li></ul></li><li><a href=#use-cases>Use Cases</a><ul><li><a href=#pipes-and-filters>Pipes and Filters</a></li><li><a href=#conditional-execution>Conditional Execution</a></li><li><a href=#complex-scripts>Complex Scripts</a></li><li><a href=#variable-expansion>Variable Expansion</a></li></ul></li><li><a href=#idempotency>Idempotency</a><ul><li><a href=#creates-file>Creates File</a></li><li><a href=#refreshonly-mode>RefreshOnly Mode</a></li><li><a href=#exit-code-validation>Exit Code Validation</a></li></ul></li><li><a href=#security-considerations>Security Considerations</a><ul><li><a href=#shell-injection-risk>Shell Injection Risk</a></li><li><a href=#environment-variable-exposure>Environment Variable Exposure</a></li><li><a href=#command-logging>Command Logging</a></li></ul></li><li><a href=#platform-support>Platform Support</a></li><li><a href=#shell-compatibility>Shell Compatibility</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/index.html><span itemprop=name>Design Documents</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/exec/index.html><span itemprop=name>Exec Type</span></a><meta itemprop=position content="3">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Shell Provider</span><meta itemprop=position content="4"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/shell/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/shell/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/posix/index.html title="Posix Provider (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/file/index.html title="File Type (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable design" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=shell-provider>Shell Provider</h1><p>This document describes the implementation details of the Shell exec provider for executing commands via <code>/bin/sh</code>.</p><h2 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Shell provider is selected when <code>provider: shell</code> is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.</p><p><strong>Availability:</strong> The provider checks for the existence of <code>/bin/sh</code> via <code>util.FileExists()</code>. If <code>/bin/sh</code> does not exist, the provider is not available.</p><h2 id=comparison-with-posix-provider>Comparison with Posix Provider<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Feature</th><th>Shell</th><th>Posix</th></tr></thead><tbody><tr><td>Shell invocation</td><td>Yes (<code>/bin/sh -c</code>)</td><td>No</td></tr><tr><td>Pipes (<code>|</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Redirections (<code>></code>, <code>&lt;</code>, <code>>></code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Shell builtins (<code>cd</code>, <code>export</code>, <code>source</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Glob expansion (<code>*.txt</code>, <code>?</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Command substitution (<code>$(...)</code>, <code>`...`</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Variable expansion (<code>$VAR</code>, <code>${VAR}</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Logical operators (<code>&&</code>, <code>||</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Argument parsing</td><td>Passed as single string</td><td><code>shellquote.Split()</code></td></tr><tr><td>Security</td><td>Shell injection possible</td><td>Lower attack surface</td></tr></tbody></table><p><strong>When to use Shell:</strong></p><ul><li>Commands with pipes: <code>cat file.txt | grep pattern | sort</code></li><li>Commands with redirections: <code>echo "data" > /tmp/file</code></li><li>Commands with shell builtins: <code>cd /tmp && pwd</code></li><li>Commands with variable expansion: <code>echo $HOME</code></li><li>Complex one-liners with logical operators</li></ul><p><strong>When to use Posix (default):</strong></p><ul><li>Simple commands with arguments</li><li>When shell features are not needed</li><li>For better security (no shell injection risk)</li></ul><h2 id=operations>Operations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=execute>Execute<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Determine command source (<code>Command</code> property or <code>Name</code> if <code>Command</code> is empty)</li><li>Validate command is not empty</li><li>Execute via <code>CommandRunner.ExecuteWithOptions()</code> with <code>/bin/sh -c "&lt;command>"</code></li><li>Optionally log output line-by-line if <code>LogOutput</code> is enabled</li></ol><p><strong>Execution Method:</strong></p><p>The entire command string is passed to the shell as a single argument:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/bin/sh -c &#34;&lt;entire command string&gt;&#34;</code></pre></div><p>This allows the shell to interpret all shell syntax, including:</p><ul><li>Pipes and redirections</li><li>Variable expansion</li><li>Glob patterns</li><li>Command substitution</li><li>Logical operators</li></ul><p><strong>Execution Options:</strong></p><table><thead><tr><th>Option</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>Command</code></td><td><code>/bin/sh</code></td><td>Shell executable path</td></tr><tr><td><code>Args</code></td><td><code>["-c", "&lt;command>"]</code></td><td>Shell flag and command string</td></tr><tr><td><code>Cwd</code></td><td><code>properties.Cwd</code></td><td>Working directory</td></tr><tr><td><code>Environment</code></td><td><code>properties.Environment</code></td><td>Additional env vars (<code>KEY=VALUE</code> format)</td></tr><tr><td><code>Path</code></td><td><code>properties.Path</code></td><td>Search path for executables</td></tr><tr><td><code>Timeout</code></td><td><code>properties.ParsedTimeout</code></td><td>Maximum execution time</td></tr></tbody></table><p><strong>Output Logging:</strong></p><p>When <code>LogOutput: true</code> is set and a user logger is provided:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>stdout</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>())
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Each line of stdout is logged as a separate <code>Info</code> message.</p><p><strong>Error Handling:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td>Empty command string</td><td>Return error: &ldquo;no command to execute&rdquo;</td></tr><tr><td>Runner not configured</td><td>Return error: &ldquo;no command runner configured&rdquo;</td></tr><tr><td>Shell not found</td><td>Provider not available (checked at selection time)</td></tr><tr><td>Command execution fails</td><td>Return error from runner</td></tr><tr><td>Non-zero exit code</td><td>Return exit code (not an error by itself)</td></tr></tbody></table><h3 id=status>Status<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Create state with <code>EnsurePresent</code> (exec resources are always &ldquo;present&rdquo;)</li><li>Check if <code>Creates</code> file exists via <code>util.FileExists()</code></li><li>Set <code>CreatesSatisfied</code> accordingly</li></ol><p><strong>State Fields:</strong></p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td><code>Protocol</code></td><td><code>io.choria.ccm.v1.resource.exec.state</code></td></tr><tr><td><code>ResourceType</code></td><td><code>exec</code></td></tr><tr><td><code>Name</code></td><td>Resource name</td></tr><tr><td><code>Ensure</code></td><td><code>present</code> (always)</td></tr><tr><td><code>CreatesSatisfied</code></td><td><code>true</code> if <code>Creates</code> file exists</td></tr></tbody></table><h2 id=use-cases>Use Cases<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=pipes-and-filters>Pipes and Filters<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>filter-logs</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cat /var/log/app.log | grep ERROR | tail -100 &gt; /tmp/errors.txt</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/tmp/errors.txt</span></span></span></code></pre></div><h3 id=conditional-execution>Conditional Execution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>ensure-running</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>pgrep myapp || /opt/myapp/bin/start</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><h3 id=complex-scripts>Complex Scripts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>deploy-app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          cd /opt/app &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git pull origin main &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          npm install &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          npm run build &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          systemctl restart app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5m</span></span></span></code></pre></div><h3 id=variable-expansion>Variable Expansion<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>backup-home</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>tar -czf /backup/home-$(date +%Y%m%d).tar.gz $HOME</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The shell provider uses the same idempotency mechanisms as the posix provider:</p><h3 id=creates-file>Creates File<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>If <code>creates</code> is specified and the file exists, the command does not run:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>extract-archive</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cd /opt &amp;&amp; tar -xzf /tmp/app.tar.gz</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/opt/app/bin/app</span></span></span></code></pre></div><h3 id=refreshonly-mode>RefreshOnly Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>When <code>refreshonly: true</code>, the command only runs when triggered by a subscribed resource:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>reload-nginx</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>nginx -t &amp;&amp; systemctl reload nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>refreshonly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/nginx/nginx.conf</span></span></span></code></pre></div><h3 id=exit-code-validation>Exit Code Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>returns</code> property specifies acceptable exit codes (default: <code>[0]</code>):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>check-service</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>systemctl is-active myapp || true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>returns</span>: [<span style=color:#ae81ff>0</span>]</span></span></code></pre></div><h2 id=security-considerations>Security Considerations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=shell-injection-risk>Shell Injection Risk<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The shell provider passes the command string directly to <code>/bin/sh</code>, making it vulnerable to shell injection if user input is incorporated:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># DANGEROUS if filename comes from untrusted input</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>process-file</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cat {{ user_provided_filename }} | process</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><p><strong>Mitigations:</strong></p><ul><li>Validate and sanitize any templated values</li><li>Use the posix provider when shell features aren&rsquo;t needed</li><li>Prefer explicit file paths over user-provided values</li></ul><h3 id=environment-variable-exposure>Environment Variable Exposure<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Shell commands can access environment variables, including sensitive ones:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># $SECRET_KEY will be expanded by the shell</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>use-secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>myapp --key=$SECRET_KEY</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><p>Consider using the <code>environment</code> property to explicitly pass required variables rather than relying on inherited environment.</p><h3 id=command-logging>Command Logging<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The full command string (including any expanded variables) may appear in logs. Avoid embedding secrets directly in commands:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># BAD - password visible in logs</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>bad-example</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>mysql -p&#39;secret123&#39; -e &#39;SELECT 1&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># BETTER - use environment variable</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>better-example</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>mysql -p&#34;$MYSQL_PWD&#34; -e &#39;SELECT 1&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>MYSQL_PWD={{ lookup(&#39;data.mysql_password&#39;) }}</span></span></span></code></pre></div><h2 id=platform-support>Platform Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The shell provider requires <code>/bin/sh</code> to be available. This is standard on:</p><ul><li>Linux distributions</li><li>macOS</li><li>BSD variants</li><li>Most Unix-like systems</li></ul><p>On Windows, the provider will not be available unless <code>/bin/sh</code> exists (e.g., via WSL or Cygwin).</p><h2 id=shell-compatibility>Shell Compatibility<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The provider uses <code>/bin/sh</code>, which is typically:</p><ul><li><strong>Linux:</strong> Often a symlink to <code>bash</code>, <code>dash</code>, or another POSIX-compliant shell</li><li><strong>macOS:</strong> <code>/bin/sh</code> is <code>bash</code> (older) or <code>zsh</code> (newer) in POSIX mode</li><li><strong>BSD:</strong> Usually <code>ash</code> or similar</li></ul><p>For maximum portability, use POSIX shell syntax and avoid bash-specific features like:</p><ul><li>Arrays (<code>arr=(1 2 3)</code>)</li><li><code>[[</code> conditionals (use <code>[</code> instead)</li><li><code>source</code> (use <code>.</code> instead)</li><li>Process substitution (<code>&lt;(command)</code>)</li></ul><footer class=footline></footer></article></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770629494 defer></script><script src=/js/theme.min.js?1770629494 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>