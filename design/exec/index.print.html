<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 9.0.3"><meta name=description content="This document describes the design of the exec resource type for executing commands.
Overview The exec resource executes commands with idempotency controls:
Creates: Skip execution if a file exists Refresh Only: Only execute when triggered by a subscribed resource Exit Codes: Validate success via configurable return codes Provider Interface Exec providers must implement the ExecProvider interface:"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Exec Type :: Choria Configuration Manager"><meta name=twitter:description content="This document describes the design of the exec resource type for executing commands.
Overview The exec resource executes commands with idempotency controls:
Creates: Skip execution if a file exists Refresh Only: Only execute when triggered by a subscribed resource Exit Codes: Validate success via configurable return codes Provider Interface Exec providers must implement the ExecProvider interface:"><meta property="og:url" content="https://choria-cm.dev/design/exec/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Exec Type :: Choria Configuration Manager"><meta property="og:description" content="This document describes the design of the exec resource type for executing commands.
Overview The exec resource executes commands with idempotency controls:
Creates: Skip execution if a file exists Refresh Only: Only execute when triggered by a subscribed resource Exit Codes: Validate success via configurable return codes Provider Interface Exec providers must implement the ExecProvider interface:"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Exec Type :: Choria Configuration Manager"><meta itemprop=description content="This document describes the design of the exec resource type for executing commands.
Overview The exec resource executes commands with idempotency controls:
Creates: Skip execution if a file exists Refresh Only: Only execute when triggered by a subscribed resource Exit Codes: Validate success via configurable return codes Provider Interface Exec providers must implement the ExecProvider interface:"><meta itemprop=wordCount content="829"><title>Exec Type :: Choria Configuration Manager</title><link href=https://choria-cm.dev/design/exec/index.html rel=canonical type=text/html title="Exec Type :: Choria Configuration Manager"><link href=/design/exec/index.xml rel=alternate type=application/rss+xml title="Exec Type :: Choria Configuration Manager"><link href=/design/exec/index.md rel=alternate type=text/markdown title="Exec Type :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770629494 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770629494 defer></script><script src=/js/search-lunr.min.js?1770629494 defer></script><script src=/js/search.min.js?1770629494 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770629494"</script><script src=/js/lunr/lunr.min.js?1770629494 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770629494 defer></script><script src=/js/lunr/lunr.multi.min.js?1770629494 defer></script><script src=/js/lunr/lunr.en.min.js?1770629494 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770629494 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770629494 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770629494 rel=stylesheet><link href=/css/theme.min.css?1770629494 rel=stylesheet><link href=/css/format-print.min.css?1770629494 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/design/exec/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/design/exec/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#provider-interface>Provider Interface</a><ul><li><a href=#method-responsibilities>Method Responsibilities</a></li><li><a href=#status-response>Status Response</a></li></ul></li><li><a href=#available-providers>Available Providers</a></li><li><a href=#properties>Properties</a></li><li><a href=#apply-logic>Apply Logic</a></li><li><a href=#idempotency>Idempotency</a><ul><li><a href=#creates-property>Creates Property</a></li><li><a href=#refresh-only-property>Refresh Only Property</a></li><li><a href=#decision-table>Decision Table</a></li></ul></li><li><a href=#subscribe-behavior>Subscribe Behavior</a></li><li><a href=#exit-code-validation>Exit Code Validation</a></li><li><a href=#noop-mode>Noop Mode</a></li><li><a href=#desired-state-validation>Desired State Validation</a></li><li><a href=#command-vs-name>Command vs Name</a></li><li><a href=#environment-and-path>Environment and Path</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/design/index.html><span itemprop=name>Design Documents</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Exec Type</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/archive/http/index.html title="HTTP Provider (ğŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/design/exec/posix/index.html title="Posix Provider (ğŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable design" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=exec-type>Exec Type</h1><p>This document describes the design of the exec resource type for executing commands.</p><h2 id=overview>Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The exec resource executes commands with idempotency controls:</p><ul><li><strong>Creates</strong>: Skip execution if a file exists</li><li><strong>Refresh Only</strong>: Only execute when triggered by a subscribed resource</li><li><strong>Exit Codes</strong>: Validate success via configurable return codes</li></ul><h2 id=provider-interface>Provider Interface<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Exec providers must implement the <code>ExecProvider</code> interface:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ExecProvider</span> <span style=color:#66d9ef>interface</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Provider</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Execute</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>properties</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ExecResourceProperties</span>, <span style=color:#a6e22e>log</span> <span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>Logger</span>) (<span style=color:#66d9ef>int</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Status</span>(<span style=color:#a6e22e>ctx</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Context</span>, <span style=color:#a6e22e>properties</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ExecResourceProperties</span>) (<span style=color:#f92672>*</span><span style=color:#a6e22e>model</span>.<span style=color:#a6e22e>ExecState</span>, <span style=color:#66d9ef>error</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=method-responsibilities>Method Responsibilities<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Method</th><th>Responsibility</th></tr></thead><tbody><tr><td><code>Status</code></td><td>Check if <code>creates</code> file exists, return current state</td></tr><tr><td><code>Execute</code></td><td>Run the command, return exit code</td></tr></tbody></table><h3 id=status-response>Status Response<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>Status</code> method returns an <code>ExecState</code> containing:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>ExecState</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CommonResourceState</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ExitCode</span>         <span style=color:#f92672>*</span><span style=color:#66d9ef>int</span> <span style=color:#75715e>// Exit code from last execution (nil if not run)</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>CreatesSatisfied</span> <span style=color:#66d9ef>bool</span> <span style=color:#75715e>// Whether creates file exists</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>The <code>Ensure</code> field in <code>CommonResourceState</code> is set to:</p><ul><li><code>present</code> if the <code>creates</code> file exists</li><li><code>absent</code> if the <code>creates</code> file does not exist (or not specified)</li></ul><h2 id=available-providers>Available Providers<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Provider</th><th>Execution Method</th><th>Documentation</th></tr></thead><tbody><tr><td><code>posix</code></td><td>Direct exec (no shell)</td><td><a href=/design/exec/posix/index.html>Posix</a></td></tr><tr><td><code>shell</code></td><td>Via <code>/bin/sh -c</code></td><td><a href=/design/exec/shell/index.html>Shell</a></td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>command</code></td><td>string</td><td>Command to run (defaults to <code>name</code> if not set)</td></tr><tr><td><code>cwd</code></td><td>string</td><td>Working directory for command execution</td></tr><tr><td><code>environment</code></td><td>[]string</td><td>Additional environment variables (<code>KEY=value</code>)</td></tr><tr><td><code>path</code></td><td>string</td><td>Search path for executables (colon-separated)</td></tr><tr><td><code>returns</code></td><td>[]int</td><td>Acceptable exit codes (default: <code>[0]</code>)</td></tr><tr><td><code>timeout</code></td><td>string</td><td>Maximum execution time (e.g., <code>30s</code>, <code>5m</code>)</td></tr><tr><td><code>creates</code></td><td>string</td><td>File path; skip execution if exists</td></tr><tr><td><code>refresh_only</code></td><td>bool</td><td>Only execute via subscribe refresh</td></tr><tr><td><code>subscribe</code></td><td>[]string</td><td>Resources to watch for changes (<code>type#name</code>)</td></tr><tr><td><code>logoutput</code></td><td>bool</td><td>Log command output</td></tr></tbody></table><h2 id=apply-logic>Apply Logic<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get current state via Status()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check for subscribe refresh             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Subscribed resource       â”‚
    â”‚ changed?                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              Yes â”‚         No
                  â–¼         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚ Execute   â”‚     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Is desired state met?   â”‚
              â”‚ (creates file exists OR â”‚
              â”‚  refresh_only is true)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        Yes â”‚         No
                            â–¼         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                    â”‚ Skip      â”‚     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Is refresh_only = true? â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  Yes â”‚         No
                                      â–¼         â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                              â”‚ Skip      â”‚     â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                                                â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚ Execute   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The exec resource provides idempotency through two mechanisms:</p><h3 id=creates-property>Creates Property<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>creates</code> property specifies a file that indicates successful prior execution:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>extract-archive</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>tar xzf /tmp/app.tar.gz -C /opt</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/opt/app/bin/app</span></span></span></code></pre></div><p><strong>Behavior:</strong></p><ul><li>If <code>/opt/app/bin/app</code> exists, skip execution</li><li>Useful for one-time setup commands</li><li>Provider checks file existence via <code>Status()</code></li></ul><h3 id=refresh-only-property>Refresh Only Property<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>refresh_only</code> property limits execution to subscribe refreshes:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>reload-nginx</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>systemctl reload nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>refresh_only</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/nginx/nginx.conf</span></span></span></code></pre></div><p><strong>Behavior:</strong></p><ul><li>Command only runs when subscribed resource changes</li><li>Without a subscribe trigger, command is skipped</li><li>Useful for reload/restart commands</li></ul><h3 id=decision-table>Decision Table<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Condition</th><th>Action</th></tr></thead><tbody><tr><td>Subscribe triggered</td><td>Execute</td></tr><tr><td><code>creates</code> file exists</td><td>Skip</td></tr><tr><td><code>refresh_only: true</code> + no trigger</td><td>Skip</td></tr><tr><td><code>refresh_only: false</code> + no <code>creates</code></td><td>Execute</td></tr></tbody></table><h2 id=subscribe-behavior>Subscribe Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Exec resources can subscribe to other resources and execute when they change:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/app/config.yaml</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>content</span>: <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>reload-app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>systemctl reload app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>refresh_only</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/app/config.yaml</span></span></span></code></pre></div><p>Subscribe takes precedence over other idempotency checks - if a subscribed resource changed, the command executes regardless of <code>creates</code> file existence.</p><h2 id=exit-code-validation>Exit Code Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>By default, exit code <code>0</code> indicates success. The <code>returns</code> property customizes acceptable codes:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>check-status</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>/usr/local/bin/check-health</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>returns</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>2</span></span></span></code></pre></div><p><strong>Behavior:</strong></p><ul><li>Command succeeds if exit code is in <code>returns</code> list</li><li>Command fails if exit code is not in <code>returns</code> list</li><li>Used for desired state validation after execution</li></ul><h2 id=noop-mode>Noop Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>In noop mode, the exec type:</p><ol><li>Queries current state normally (checks <code>creates</code> file)</li><li>Evaluates subscribe triggers</li><li>Logs what actions would be taken</li><li>Sets appropriate <code>NoopMessage</code>:<ul><li>&ldquo;Would have executed&rdquo;</li><li>&ldquo;Would have executed via subscribe&rdquo;</li></ul></li><li>Reports <code>Changed: true</code> if execution would occur</li><li>Does not call provider <code>Execute</code> method</li></ol><h2 id=desired-state-validation>Desired State Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>After execution (in non-noop mode), the type verifies success:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>Type</span>) <span style=color:#a6e22e>isDesiredState</span>(<span style=color:#a6e22e>properties</span>, <span style=color:#a6e22e>status</span>) <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Creates file check takes precedence</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Creates</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>CreatesSatisfied</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Refresh-only without execution is stable</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>ExitCode</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>RefreshOnly</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Check exit code against acceptable returns</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>returns</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>0</span>}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Returns</span>) &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>returns</span> = <span style=color:#a6e22e>properties</span>.<span style=color:#a6e22e>Returns</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>ExitCode</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>slices</span>.<span style=color:#a6e22e>Contains</span>(<span style=color:#a6e22e>returns</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>status</span>.<span style=color:#a6e22e>ExitCode</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>If the exit code is not in the acceptable <code>returns</code> list, an <code>ErrDesiredStateFailed</code> error is returned.</p><h2 id=command-vs-name>Command vs Name<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>command</code> property is optional. If not specified, the <code>name</code> is used as the command:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># These are equivalent:</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/usr/bin/myapp --config /etc/myapp.conf</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>run-myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>/usr/bin/myapp --config /etc/myapp.conf</span></span></span></code></pre></div><p>Using a descriptive <code>name</code> with explicit <code>command</code> is recommended for clarity.</p><h2 id=environment-and-path>Environment and Path<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Commands can be configured with custom environment:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>build-app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>make build</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cwd</span>: <span style=color:#ae81ff>/opt/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>CC=gcc</span>
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>CFLAGS=-O2</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/usr/local/bin:/usr/bin:/bin</span></span></span></code></pre></div><p><strong>Environment:</strong></p><ul><li>Added to the command&rsquo;s environment</li><li>Format: <code>KEY=value</code></li><li>Does not replace existing environment</li></ul><p><strong>Path:</strong></p><ul><li>Sets the <code>PATH</code> for executable lookup</li><li>Must be absolute directories</li><li>Colon-separated list</li></ul><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Exec Type</h1><article class=default><header class=headline></header><h1 id=posix-provider>Posix Provider</h1><p>This document describes the implementation details of the Posix exec provider for executing commands without a shell.</p><h2 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Posix provider is the default exec provider. It is always available and returns priority 1 for all exec resources unless a different provider is explicitly requested via the <code>provider</code> property.</p><p>To use the shell provider instead, specify <code>provider: shell</code> in the resource properties.</p><h2 id=comparison-with-shell-provider>Comparison with Shell Provider<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Feature</th><th>Posix</th><th>Shell</th></tr></thead><tbody><tr><td>Shell invocation</td><td>No</td><td>Yes (<code>/bin/sh -c</code>)</td></tr><tr><td>Pipes (<code>|</code>)</td><td>Not supported</td><td>Supported</td></tr><tr><td>Redirections (<code>></code>, <code>&lt;</code>)</td><td>Not supported</td><td>Supported</td></tr><tr><td>Shell builtins (<code>cd</code>, <code>export</code>)</td><td>Not supported</td><td>Supported</td></tr><tr><td>Glob expansion</td><td>Not supported</td><td>Supported</td></tr><tr><td>Command substitution (<code>$(...)</code>)</td><td>Not supported</td><td>Supported</td></tr><tr><td>Argument parsing</td><td><code>shellquote.Split()</code></td><td>Passed as single string</td></tr><tr><td>Security</td><td>Lower attack surface</td><td>Shell injection possible</td></tr></tbody></table><p><strong>When to use Posix (default):</strong></p><ul><li>Simple commands with arguments</li><li>When shell features are not needed</li><li>For better security (no shell injection risk)</li></ul><p><strong>When to use Shell:</strong></p><ul><li>Commands with pipes, redirections, or shell builtins</li><li>Complex command strings</li><li>When shell expansion is required</li></ul><h2 id=operations>Operations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=execute>Execute<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Determine command source (<code>Command</code> property or <code>Name</code> if <code>Command</code> is empty)</li><li>Parse command string into words using <code>shellquote.Split()</code></li><li>Extract command (first word) and arguments (remaining words)</li><li>Execute via <code>CommandRunner.ExecuteWithOptions()</code></li><li>Optionally log output line-by-line if <code>LogOutput</code> is enabled</li></ol><p><strong>Command Parsing:</strong></p><p>The command string is parsed using <code>github.com/kballard/go-shellquote</code>, which handles:</p><table><thead><tr><th>Syntax</th><th>Example</th><th>Result</th></tr></thead><tbody><tr><td>Simple words</td><td><code>echo hello world</code></td><td><code>["echo", "hello", "world"]</code></td></tr><tr><td>Single quotes</td><td><code>echo 'hello world'</code></td><td><code>["echo", "hello world"]</code></td></tr><tr><td>Double quotes</td><td><code>echo "hello world"</code></td><td><code>["echo", "hello world"]</code></td></tr><tr><td>Escaped spaces</td><td><code>echo hello\ world</code></td><td><code>["echo", "hello world"]</code></td></tr><tr><td>Mixed quoting</td><td><code>echo "it's a test"</code></td><td><code>["echo", "it's a test"]</code></td></tr></tbody></table><p><strong>Execution Options:</strong></p><table><thead><tr><th>Option</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td><code>Command</code></td><td>First word after parsing</td><td>Executable path or name</td></tr><tr><td><code>Args</code></td><td>Remaining words</td><td>Command arguments</td></tr><tr><td><code>Cwd</code></td><td><code>properties.Cwd</code></td><td>Working directory</td></tr><tr><td><code>Environment</code></td><td><code>properties.Environment</code></td><td>Additional env vars (<code>KEY=VALUE</code> format)</td></tr><tr><td><code>Path</code></td><td><code>properties.Path</code></td><td>Search path for executables</td></tr><tr><td><code>Timeout</code></td><td><code>properties.ParsedTimeout</code></td><td>Maximum execution time</td></tr></tbody></table><p><strong>Output Logging:</strong></p><p>When <code>LogOutput: true</code> is set and a user logger is provided:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>stdout</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>())
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Each line of stdout is logged as a separate <code>Info</code> message.</p><p><strong>Error Handling:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td>Empty command string</td><td>Return error: &ldquo;no command specified&rdquo;</td></tr><tr><td>Invalid shell quoting</td><td>Return parsing error (e.g., &ldquo;Unterminated single quote&rdquo;)</td></tr><tr><td>Runner not configured</td><td>Return error: &ldquo;no command runner configured&rdquo;</td></tr><tr><td>Command execution fails</td><td>Return error from runner</td></tr><tr><td>Non-zero exit code</td><td>Return exit code (not an error by itself)</td></tr></tbody></table><h3 id=status>Status<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Create state with <code>EnsurePresent</code> (exec resources are always &ldquo;present&rdquo;)</li><li>Check if <code>Creates</code> file exists via <code>util.FileExists()</code></li><li>Set <code>CreatesSatisfied</code> accordingly</li></ol><p><strong>State Fields:</strong></p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td><code>Protocol</code></td><td><code>io.choria.ccm.v1.resource.exec.state</code></td></tr><tr><td><code>ResourceType</code></td><td><code>exec</code></td></tr><tr><td><code>Name</code></td><td>Resource name</td></tr><tr><td><code>Ensure</code></td><td><code>present</code> (always)</td></tr><tr><td><code>CreatesSatisfied</code></td><td><code>true</code> if <code>Creates</code> file exists</td></tr></tbody></table><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The exec resource achieves idempotency through multiple mechanisms:</p><h3 id=creates-file>Creates File<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>If <code>creates</code> is specified and the file exists, the command does not run:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/usr/bin/tar -xzf app.tar.gz</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/opt/app/bin/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cwd</span>: <span style=color:#ae81ff>/opt</span></span></span></code></pre></div><h3 id=refreshonly-mode>RefreshOnly Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>When <code>refreshonly: true</code>, the command only runs when triggered by a subscribed resource:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>systemctl reload httpd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>refreshonly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/httpd/conf/httpd.conf</span></span></span></code></pre></div><h3 id=exit-code-validation>Exit Code Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>returns</code> property specifies acceptable exit codes (default: <code>[0]</code>):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/app/healthcheck</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>returns</span>: [<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>]  <span style=color:#75715e># 0=healthy, 1=degraded, 2=warning</span></span></span></code></pre></div><h2 id=decision-flow>Decision Flow<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Should resource be applied?             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Subscribe triggered?                     â”‚
â”‚ (subscribed resource changed)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ Yes           â”‚ No
              â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execute command â”‚   â”‚ Creates satisfied? â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Yes               â”‚ No
                      â–¼                   â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Skip (stable) â”‚   â”‚ RefreshOnly mode? â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                            â”‚
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ Yes               â”‚ No
                                  â–¼                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Skip (stable) â”‚   â”‚ Execute       â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre></div><h2 id=properties-validation>Properties Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The model validates exec properties before execution:</p><table><thead><tr><th>Property</th><th>Validation</th></tr></thead><tbody><tr><td><code>name</code></td><td>Must be parseable by shellquote (balanced quotes)</td></tr><tr><td><code>timeout</code></td><td>Must be valid duration format (e.g., <code>30s</code>, <code>5m</code>)</td></tr><tr><td><code>subscribe</code></td><td>Each entry must be <code>type#name</code> format</td></tr><tr><td><code>path</code></td><td>Each directory must be absolute (start with <code>/</code>)</td></tr><tr><td><code>environment</code></td><td>Each entry must be <code>KEY=VALUE</code> format with non-empty key and value</td></tr></tbody></table><h2 id=platform-support>Platform Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Posix provider works on all platforms supported by Go&rsquo;s <code>os/exec</code> package. It does not use any platform-specific system calls directly.</p><p>The command runner (<code>model.CommandRunner</code>) handles the actual process execution, which may have platform-specific implementations.</p><h2 id=security-considerations>Security Considerations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=no-shell-injection>No Shell Injection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Unlike the shell provider, the posix provider does not invoke a shell. Arguments are passed directly to the executable, preventing shell injection attacks:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Safe with posix provider - $USER is passed literally, not expanded</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/bin/echo $USER</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>posix </span> <span style=color:#75715e># Default</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Potentially dangerous with shell provider - $USER is expanded</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/bin/echo $USER</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><h3 id=path-validation>Path Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>path</code> property only accepts absolute directory paths, preventing path traversal via relative paths.</p><h3 id=environment-validation>Environment Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Environment variables must have non-empty keys and values, preventing injection of empty or malformed entries.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=shell-provider>Shell Provider</h1><p>This document describes the implementation details of the Shell exec provider for executing commands via <code>/bin/sh</code>.</p><h2 id=provider-selection>Provider Selection<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The Shell provider is selected when <code>provider: shell</code> is explicitly specified in the resource properties. It has a lower priority (99) than the Posix provider (1), so it is never automatically selected.</p><p><strong>Availability:</strong> The provider checks for the existence of <code>/bin/sh</code> via <code>util.FileExists()</code>. If <code>/bin/sh</code> does not exist, the provider is not available.</p><h2 id=comparison-with-posix-provider>Comparison with Posix Provider<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Feature</th><th>Shell</th><th>Posix</th></tr></thead><tbody><tr><td>Shell invocation</td><td>Yes (<code>/bin/sh -c</code>)</td><td>No</td></tr><tr><td>Pipes (<code>|</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Redirections (<code>></code>, <code>&lt;</code>, <code>>></code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Shell builtins (<code>cd</code>, <code>export</code>, <code>source</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Glob expansion (<code>*.txt</code>, <code>?</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Command substitution (<code>$(...)</code>, <code>`...`</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Variable expansion (<code>$VAR</code>, <code>${VAR}</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Logical operators (<code>&&</code>, <code>||</code>)</td><td>Supported</td><td>Not supported</td></tr><tr><td>Argument parsing</td><td>Passed as single string</td><td><code>shellquote.Split()</code></td></tr><tr><td>Security</td><td>Shell injection possible</td><td>Lower attack surface</td></tr></tbody></table><p><strong>When to use Shell:</strong></p><ul><li>Commands with pipes: <code>cat file.txt | grep pattern | sort</code></li><li>Commands with redirections: <code>echo "data" > /tmp/file</code></li><li>Commands with shell builtins: <code>cd /tmp && pwd</code></li><li>Commands with variable expansion: <code>echo $HOME</code></li><li>Complex one-liners with logical operators</li></ul><p><strong>When to use Posix (default):</strong></p><ul><li>Simple commands with arguments</li><li>When shell features are not needed</li><li>For better security (no shell injection risk)</li></ul><h2 id=operations>Operations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=execute>Execute<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Determine command source (<code>Command</code> property or <code>Name</code> if <code>Command</code> is empty)</li><li>Validate command is not empty</li><li>Execute via <code>CommandRunner.ExecuteWithOptions()</code> with <code>/bin/sh -c "&lt;command>"</code></li><li>Optionally log output line-by-line if <code>LogOutput</code> is enabled</li></ol><p><strong>Execution Method:</strong></p><p>The entire command string is passed to the shell as a single argument:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/bin/sh -c &#34;&lt;entire command string&gt;&#34;</code></pre></div><p>This allows the shell to interpret all shell syntax, including:</p><ul><li>Pipes and redirections</li><li>Variable expansion</li><li>Glob patterns</li><li>Command substitution</li><li>Logical operators</li></ul><p><strong>Execution Options:</strong></p><table><thead><tr><th>Option</th><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>Command</code></td><td><code>/bin/sh</code></td><td>Shell executable path</td></tr><tr><td><code>Args</code></td><td><code>["-c", "&lt;command>"]</code></td><td>Shell flag and command string</td></tr><tr><td><code>Cwd</code></td><td><code>properties.Cwd</code></td><td>Working directory</td></tr><tr><td><code>Environment</code></td><td><code>properties.Environment</code></td><td>Additional env vars (<code>KEY=VALUE</code> format)</td></tr><tr><td><code>Path</code></td><td><code>properties.Path</code></td><td>Search path for executables</td></tr><tr><td><code>Timeout</code></td><td><code>properties.ParsedTimeout</code></td><td>Maximum execution time</td></tr></tbody></table><p><strong>Output Logging:</strong></p><p>When <code>LogOutput: true</code> is set and a user logger is provided:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#a6e22e>scanner</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewScanner</span>(<span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>stdout</span>))
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> <span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Scan</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Info</span>(<span style=color:#a6e22e>scanner</span>.<span style=color:#a6e22e>Text</span>())
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>Each line of stdout is logged as a separate <code>Info</code> message.</p><p><strong>Error Handling:</strong></p><table><thead><tr><th>Condition</th><th>Behavior</th></tr></thead><tbody><tr><td>Empty command string</td><td>Return error: &ldquo;no command to execute&rdquo;</td></tr><tr><td>Runner not configured</td><td>Return error: &ldquo;no command runner configured&rdquo;</td></tr><tr><td>Shell not found</td><td>Provider not available (checked at selection time)</td></tr><tr><td>Command execution fails</td><td>Return error from runner</td></tr><tr><td>Non-zero exit code</td><td>Return exit code (not an error by itself)</td></tr></tbody></table><h3 id=status>Status<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p><strong>Process:</strong></p><ol><li>Create state with <code>EnsurePresent</code> (exec resources are always &ldquo;present&rdquo;)</li><li>Check if <code>Creates</code> file exists via <code>util.FileExists()</code></li><li>Set <code>CreatesSatisfied</code> accordingly</li></ol><p><strong>State Fields:</strong></p><table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td><code>Protocol</code></td><td><code>io.choria.ccm.v1.resource.exec.state</code></td></tr><tr><td><code>ResourceType</code></td><td><code>exec</code></td></tr><tr><td><code>Name</code></td><td>Resource name</td></tr><tr><td><code>Ensure</code></td><td><code>present</code> (always)</td></tr><tr><td><code>CreatesSatisfied</code></td><td><code>true</code> if <code>Creates</code> file exists</td></tr></tbody></table><h2 id=use-cases>Use Cases<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=pipes-and-filters>Pipes and Filters<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>filter-logs</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cat /var/log/app.log | grep ERROR | tail -100 &gt; /tmp/errors.txt</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/tmp/errors.txt</span></span></span></code></pre></div><h3 id=conditional-execution>Conditional Execution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>ensure-running</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>pgrep myapp || /opt/myapp/bin/start</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><h3 id=complex-scripts>Complex Scripts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>deploy-app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          cd /opt/app &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          git pull origin main &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          npm install &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          npm run build &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          systemctl restart app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>5m</span></span></span></code></pre></div><h3 id=variable-expansion>Variable Expansion<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>backup-home</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>tar -czf /backup/home-$(date +%Y%m%d).tar.gz $HOME</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The shell provider uses the same idempotency mechanisms as the posix provider:</p><h3 id=creates-file>Creates File<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>If <code>creates</code> is specified and the file exists, the command does not run:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>extract-archive</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cd /opt &amp;&amp; tar -xzf /tmp/app.tar.gz</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/opt/app/bin/app</span></span></span></code></pre></div><h3 id=refreshonly-mode>RefreshOnly Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>When <code>refreshonly: true</code>, the command only runs when triggered by a subscribed resource:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>reload-nginx</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>nginx -t &amp;&amp; systemctl reload nginx</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>refreshonly</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>file#/etc/nginx/nginx.conf</span></span></span></code></pre></div><h3 id=exit-code-validation>Exit Code Validation<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>returns</code> property specifies acceptable exit codes (default: <code>[0]</code>):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>check-service</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>systemctl is-active myapp || true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>returns</span>: [<span style=color:#ae81ff>0</span>]</span></span></code></pre></div><h2 id=security-considerations>Security Considerations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=shell-injection-risk>Shell Injection Risk<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The shell provider passes the command string directly to <code>/bin/sh</code>, making it vulnerable to shell injection if user input is incorporated:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># DANGEROUS if filename comes from untrusted input</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>process-file</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cat {{ user_provided_filename }} | process</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><p><strong>Mitigations:</strong></p><ul><li>Validate and sanitize any templated values</li><li>Use the posix provider when shell features aren&rsquo;t needed</li><li>Prefer explicit file paths over user-provided values</li></ul><h3 id=environment-variable-exposure>Environment Variable Exposure<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Shell commands can access environment variables, including sensitive ones:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># $SECRET_KEY will be expanded by the shell</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>use-secret</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>myapp --key=$SECRET_KEY</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><p>Consider using the <code>environment</code> property to explicitly pass required variables rather than relying on inherited environment.</p><h3 id=command-logging>Command Logging<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The full command string (including any expanded variables) may appear in logs. Avoid embedding secrets directly in commands:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># BAD - password visible in logs</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>bad-example</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>mysql -p&#39;secret123&#39; -e &#39;SELECT 1&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># BETTER - use environment variable</span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>better-example</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>mysql -p&#34;$MYSQL_PWD&#34; -e &#39;SELECT 1&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>MYSQL_PWD={{ lookup(&#39;data.mysql_password&#39;) }}</span></span></span></code></pre></div><h2 id=platform-support>Platform Support<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The shell provider requires <code>/bin/sh</code> to be available. This is standard on:</p><ul><li>Linux distributions</li><li>macOS</li><li>BSD variants</li><li>Most Unix-like systems</li></ul><p>On Windows, the provider will not be available unless <code>/bin/sh</code> exists (e.g., via WSL or Cygwin).</p><h2 id=shell-compatibility>Shell Compatibility<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The provider uses <code>/bin/sh</code>, which is typically:</p><ul><li><strong>Linux:</strong> Often a symlink to <code>bash</code>, <code>dash</code>, or another POSIX-compliant shell</li><li><strong>macOS:</strong> <code>/bin/sh</code> is <code>bash</code> (older) or <code>zsh</code> (newer) in POSIX mode</li><li><strong>BSD:</strong> Usually <code>ash</code> or similar</li></ul><p>For maximum portability, use POSIX shell syntax and avoid bash-specific features like:</p><ul><li>Arrays (<code>arr=(1 2 3)</code>)</li><li><code>[[</code> conditionals (use <code>[</code> instead)</li><li><code>source</code> (use <code>.</code> instead)</li><li>Process substitution (<code>&lt;(command)</code>)</li></ul><footer class=footline></footer></article></section></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770629494 defer></script><script src=/js/theme.min.js?1770629494 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>