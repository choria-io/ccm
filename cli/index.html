<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 8.3.0"><meta name=description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Shell Usage :: Choria Configuration Manager"><meta name=twitter:description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta property="og:url" content="https://choria-cm.dev/cli/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Shell Usage :: Choria Configuration Manager"><meta property="og:description" content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Shell Usage :: Choria Configuration Manager"><meta itemprop=description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta itemprop=wordCount content="420"><title>Shell Usage :: Choria Configuration Manager</title><link href=/cli/index.xml rel=alternate type=application/rss+xml title="Shell Usage :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1768842812 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1768842812 defer></script><script src=/js/search-lunr.min.js?1768842812 defer></script><script src=/js/search.min.js?1768842812 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1768842812"</script><script src=/js/lunr/lunr.min.js?1768842812 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1768842812 defer></script><script src=/js/lunr/lunr.multi.min.js?1768842812 defer></script><script src=/js/lunr/lunr.en.min.js?1768842812 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1768842812 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/fontawesome-all.min.css?1768842812 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1768842812 rel=stylesheet><link href=/css/theme.min.css?1768842812 rel=stylesheet><link href=/css/format-html.min.css?1768842812 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/cli/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support html" data-url=/cli/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#managing-a-single-resource>Managing a Single Resource</a></li><li><a href=#managing-multiple-resources>Managing Multiple Resources</a></li><li><a href=#data-in-the-cli>Data in the CLI</a></li><li><a href=#applying-manifests>Applying Manifests</a></li><li><a href=#viewing-system-facts>Viewing System Facts</a></li><li><a href=#resolving-hiera-data>Resolving Hiera Data</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Choria Configuration Manager</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Shell Usage</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/data/index.html title="Data (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/cli/plugins/index.html title="CLI Plugins (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable cli" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=shell-usage>Shell Usage</h1><p>CCM is designed as a CLI-first tool. Each resource type has its own subcommand under <code>ccm ensure</code>, with required inputs as arguments and optional settings as flags.</p><p>The <code>ccm ensure</code> commands are idempotent, making them safe to run multiple times in shell scripts.</p><p>Use <code>ccm --help</code> and <code>ccm &lt;command> --help</code> to explore available commands and options.</p><h2 id=managing-a-single-resource>Managing a Single Resource<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Managing a single resource is straightforward.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm ensure package zsh 5.8</span></span></code></pre></div><p>This ensures the package <code>zsh</code> is installed at version <code>5.8</code>.</p><p>To view the current state of a resource:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm status package zsh</span></span></code></pre></div><h2 id=managing-multiple-resources>Managing Multiple Resources<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When managing multiple resources in a script, create a session first. The session records the outcome of each resource, enabling features like refreshing a service when a file changes.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>eval <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>ccm session new<span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>trap <span style=color:#e6db74>&#39;rm -rf -- &#34;$CCM_SESSION_STORE&#34;&#39;</span> EXIT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ccm ensure package httpd
</span></span><span style=display:flex><span>ccm ensure file /etc/httpd/conf/httpd.conf .... --require package#httpd
</span></span><span style=display:flex><span>ccm ensure service httpd --subscribe file#/etc/httpd/conf/httpd.conf
</span></span><span style=display:flex><span>ccm session report</span></span></code></pre></div><p>This creates a temporary directory for session state. If the file resource changes, the service restarts automatically.</p><p>If you prefer not to eval command output, use: <code>export CCM_SESSION_STORE=$(mktemp -d)</code></p><h2 id=data-in-the-cli>Data in the CLI<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>As covered in the <a href=/data/index.html>data section</a>, commands automatically read <code>./.env</code> and <code>./.hiera</code> files, merging that data into the session.</p><p>Use the <code>--hiera</code> flag or <code>CCM_HIERA_DATA</code> environment variable to specify a different data file.</p><p>With data loaded, you can access:</p><ul><li><code>{{ lookup("data.my_data_key") }}</code> for Hiera data</li><li><code>{{ lookup("env.MY_ENV_VAR") }}</code> for environment variables</li><li><code>{{ lookup("facts.host.info.platformFamily") }}</code> for system facts</li></ul><p>Example using Hiera data:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm ensure package <span style=color:#e6db74>&#39;{{ lookup(&#34;data.package&#34;) }}&#39;</span> <span style=color:#e6db74>&#39;{{ lookup(&#34;data.version&#34;) }}&#39;</span></span></span></code></pre></div><p>Expressions use the <a href=https://expr-lang.org/docs/language-definition rel=external>Expr Language</a>, enabling complex logic:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm ensure package <span style=color:#e6db74>&#39;{{ lookup(&#34;facts.host.info.platformFamily&#34;) == &#34;rhel&#34; ? &#34;httpd&#34; : &#34;apache2&#34; }}&#39;</span>
</span></span><span style=display:flex><span>WARN  package#httpd changed ensure<span style=color:#f92672>=</span>present runtime<span style=color:#f92672>=</span>14.509s provider<span style=color:#f92672>=</span>dnf</span></span></code></pre></div><p>For complex conditional logic, we recommend using Hiera data with hierarchy overrides instead.</p><h2 id=applying-manifests>Applying Manifests<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>For non-shell script usage use YAML manifests with <code>ccm apply</code>:</p><p>See <a href=/yamlmanifests/index.html>YAML Manifests</a> for manifest format details.</p><h2 id=viewing-system-facts>Viewing System Facts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>CCM gathers system facts that can be used in templates and conditions:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Show all facts as JSON</span>
</span></span><span style=display:flex><span>$ ccm facts
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Show facts as YAML</span>
</span></span><span style=display:flex><span>$ ccm facts --yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Query specific facts using gjson syntax</span>
</span></span><span style=display:flex><span>$ ccm facts host.info.platformFamily</span></span></code></pre></div><h2 id=resolving-hiera-data>Resolving Hiera Data<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>ccm hiera</code> command helps debug and test Hiera data resolution:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Resolve a Hiera file with system facts</span>
</span></span><span style=display:flex><span>$ ccm hiera parse data.yaml -S
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Resolve with custom facts</span>
</span></span><span style=display:flex><span>$ ccm hiera parse data.yaml os<span style=color:#f92672>=</span>linux env<span style=color:#f92672>=</span>production
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Query a specific key from the result</span>
</span></span><span style=display:flex><span>$ ccm hiera parse data.yaml --query packages</span></span></code></pre></div><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><img src=/logo.png></div><search><form action=/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-url=/index.html><a class=padding href=/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-url=/resources/index.html><a class=padding href=/resources/index.html><b>1. </b>Resources</a></li><li data-nav-url=/hiera/index.html><a class=padding href=/hiera/index.html><b>2. </b>Hierarchical Data</a></li><li data-nav-url=/data/index.html><a class=padding href=/data/index.html><b>3. </b>Data</a></li><li class="active parent alwaysopen" data-nav-url=/cli/index.html><input type=checkbox id=R-section-4fd2725e492e69224fa1e9952b51cf04 aria-controls=R-subsections-4fd2725e492e69224fa1e9952b51cf04 checked><label for=R-section-4fd2725e492e69224fa1e9952b51cf04><i class="fa-fw fas fa-chevron-right"></i><span class=a11y-only>Submenu Shell Usage</span></label><a class=padding href=/cli/index.html><b>4. </b>Shell Usage</a><ul id=R-subsections-4fd2725e492e69224fa1e9952b51cf04 class=collapsible-menu><li data-nav-url=/cli/plugins/index.html><a class=padding href=/cli/plugins/index.html>CLI Plugins</a></li></ul></li><li data-nav-url=/yamlmanifests/index.html><a class=padding href=/yamlmanifests/index.html><b>5. </b>YAML Manifests</a></li><li data-nav-url=/agent/index.html><a class=padding href=/agent/index.html><b>6. </b>Agent</a></li><li data-nav-url=/monitoring/index.html><a class=padding href=/monitoring/index.html><b>7. </b>Monitoring</a></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><div class="nav-title padding">More</div><ul class="space collapsible-menu"><li data-nav-url=https://github.com/choria-io/ccm><a class=padding href=https://github.com/choria-io/ccm rel=external><i class='fab fa-fw fa-github'></i> GitHub</a></li><li data-nav-url=https://github.com/choria-io/ccm/releases><a class=padding href=https://github.com/choria-io/ccm/releases rel=external><i class='far fa-save'></i> Download</a></li><li data-nav-url=https://github.com/choria-io/ccm/discussions><a class=padding href=https://github.com/choria-io/ccm/discussions rel=external><i class='far fa-comments'></i> Discussions</a></li><li data-nav-url=https://github.com/choria-io/ccm/issues><a class=padding href=https://github.com/choria-io/ccm/issues rel=external><i class='far fa-life-ring'></i> Issues</a></li><li data-nav-url=https://short.voxpupu.li/puppetcommunity_slack_signup><a class=padding href=https://short.voxpupu.li/puppetcommunity_slack_signup rel=external><i class='fab fa-slack'></i> #choria</a></li></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul><li class=R-variantswitcher><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant><option id=R-select-variant-zen-auto value=zen-auto selected>Auto Theme</option><option id=R-select-variant-zen-light value=zen-light>Light</option><option id=R-select-variant-ccm value=ccm>Dark</option></select></div><div class=clear></div></div><script>window.relearn.markVariant()</script></li></ul></div><div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1768842812 defer></script><script src=/js/theme.min.js?1768842812 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>