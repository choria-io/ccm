<!doctype html><html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=html><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 8.3.0"><meta name=description content="We are designing CCM to be used as a CLI tool as its first class method of interaction.
Each resource type has its own subcommand under ccm ensure that maps to the resource type, with required inputs being arguments and optionals being flags.
The CLI commands are designed to be idempotent; this means that they can be used to write shell scripts that can safely be run multiple times.
Managing a single resource Managing a single resource is really easy, however, some features will not function without preparing a session."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="CLI Usage :: Choria Configuration Manager"><meta name=twitter:description content="We are designing CCM to be used as a CLI tool as its first class method of interaction.
Each resource type has its own subcommand under ccm ensure that maps to the resource type, with required inputs being arguments and optionals being flags.
The CLI commands are designed to be idempotent; this means that they can be used to write shell scripts that can safely be run multiple times.
Managing a single resource Managing a single resource is really easy, however, some features will not function without preparing a session."><meta property="og:url" content="https://choria-io.github.io/ccm/cli/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="CLI Usage :: Choria Configuration Manager"><meta property="og:description" content="We are designing CCM to be used as a CLI tool as its first class method of interaction.
Each resource type has its own subcommand under ccm ensure that maps to the resource type, with required inputs being arguments and optionals being flags.
The CLI commands are designed to be idempotent; this means that they can be used to write shell scripts that can safely be run multiple times.
Managing a single resource Managing a single resource is really easy, however, some features will not function without preparing a session."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="CLI Usage :: Choria Configuration Manager"><meta itemprop=description content="We are designing CCM to be used as a CLI tool as its first class method of interaction.
Each resource type has its own subcommand under ccm ensure that maps to the resource type, with required inputs being arguments and optionals being flags.
The CLI commands are designed to be idempotent; this means that they can be used to write shell scripts that can safely be run multiple times.
Managing a single resource Managing a single resource is really easy, however, some features will not function without preparing a session."><meta itemprop=wordCount content="403"><title>CLI Usage :: Choria Configuration Manager</title><link href=https://choria-io.github.io/ccm/cli/index.xml rel=alternate type=application/rss+xml title="CLI Usage :: Choria Configuration Manager"><link href=https://choria-io.github.io/ccm/css/auto-complete/auto-complete.min.css?1767884677 rel=stylesheet><script src=https://choria-io.github.io/ccm/js/auto-complete/auto-complete.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/search-lunr.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/search.min.js?1767884677 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="https://choria-io.github.io/ccm/searchindex.en.js?1767884677"</script><script src=https://choria-io.github.io/ccm/js/lunr/lunr.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/lunr/lunr.stemmer.support.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/lunr/lunr.multi.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/lunr/lunr.en.min.js?1767884677 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=https://choria-io.github.io/ccm/fonts/fontawesome/css/fontawesome-all.min.css?1767884677 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=https://choria-io.github.io/ccm/fonts/fontawesome/css/fontawesome-all.min.css?1767884677 rel=stylesheet></noscript><link href=https://choria-io.github.io/ccm/css/perfect-scrollbar/perfect-scrollbar.min.css?1767884677 rel=stylesheet><link href=https://choria-io.github.io/ccm/css/theme.min.css?1767884677 rel=stylesheet><link href=https://choria-io.github.io/ccm/css/format-html.min.css?1767884677 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/cli/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-io.github.io/ccm",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.relearn.getItem=(e,t)=>e.getItem(t),window.relearn.setItem=(e,t,n)=>e.setItem(t,n),window.relearn.removeItem=(e,t)=>e.removeItem(t),window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantname="my-custom-variant",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.relearn.getItem(window.localStorage,window.relearn.absBaseUri+"/variant")??"";e==window.relearn.customvariantname||(!e||!window.relearn.themevariants.includes(e))&&(e=window.relearn.themevariants[0],window.relearn.setItem(window.localStorage,window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support html" data-url=https://choria-io.github.io/ccm/cli/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar><div class=topbar-wrapper><div class=topbar-sidebar-divider></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-list-alt"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#managing-a-single-resource>Managing a single resource</a></li><li><a href=#managing-multiple-resources>Managing multiple resources</a></li><li><a href=#data-in-the-cli>Data in the CLI</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=https://choria-io.github.io/ccm/index.html><span itemprop=name>Choria Configuration Manager</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>CLI Usage</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-prev" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=https://choria-io.github.io/ccm/data/index.html title="Data (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=https://choria-io.github.io/ccm/yamlmanifests/index.html title="YAML Manifests (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable cli" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=cli-usage>CLI Usage</h1><p>We are designing CCM to be used as a CLI tool as its first class method of interaction.</p><p>Each resource type has its own subcommand under <code>ccm ensure</code> that maps to the resource type, with required inputs being
arguments and optionals being flags.</p><p>The CLI commands are designed to be idempotent; this means that they can be used to write shell scripts that can safely be run multiple times.</p><h2 id=managing-a-single-resource>Managing a single resource<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Managing a single resource is really easy, however, some features will not function without preparing a session.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>$ ccm ensure package zsh 5.8</code></pre></div><p>Here we create a resource that ensures the package <code>zsh</code> is installed with version <code>5.8</code>.</p><p>We can also get the current state of a resource using the <code>status</code> subcommand.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>$ ccm status package zsh</code></pre></div><h2 id=managing-multiple-resources>Managing multiple resources<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When managing multiple resources, in a script it is worth creating a session and then running the commands. The purpose of the session is to record the outcome of earlier resource so that features like refreshing a Service when a File is updated will function correctly.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>eval <span style=color:#66d9ef>$(</span>ccm session new<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>ccm ensure package httpd
</span></span><span style=display:flex><span>ccm ensure file /etc/httpd/conf/httpd.conf ....
</span></span><span style=display:flex><span>ccm ensure service httpd --subscribe file#/etc/httpd/conf/httpd.conf
</span></span><span style=display:flex><span>ccm session report</span></span></code></pre></div><p>When this script is run it will create a temporary directory where session progress is stored, run the commands and should the file change the service will be restarted.</p><p>If evaluating random output from commands does not appeal then you can do this instead <code>export CCM_SESSION_STORE=$(mktemp -d)</code></p><h2 id=data-in-the-cli>Data in the CLI<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>As covered in the <a href=https://choria-io.github.io/ccm/data/index.html>data section of the documentation</a> the commands will read <code>./.env</code> and <code>./.hiera</code> files and merge that data into the session.</p><p>This behavior can be configured using the <code>--hiera</code> flag or <code>CCM_HIERA_DATA</code> environment variable to point to a specific file.</p><p>With this enabled you can access <code>{{ lookup("data.my_data_key") }}</code> for Hiera data in your templates, <code>{{ lookup("env.MY_ENV_VAR") }}</code> for environment variables and <code>{{ lookup("facts.host.info.platformFamily") }}</code> for fact data.</p><p>Below we load the package name and version from Hiera and use them in a template to ensure the package is installed.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm ensure package <span style=color:#e6db74>&#39;{{ lookup(&#34;data.package&#34;) }}&#39;</span> <span style=color:#e6db74>&#39;{{ lookup(&#34;data.version&#34;) }}&#39;</span></span></span></code></pre></div><p>As pointed out these expressions are <a href=https://expr-lang.org/docs/language-definition rel=external>Expr Language</a> so these expressions can be quite complex for example:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ccm ensure package <span style=color:#e6db74>&#39;{{ lookup(&#34;facts.host.info.platformFamily&#34;) == &#34;rhel&#34; ? &#34;httpd&#34; : &#34;apache2&#34; }}&#39;</span>
</span></span><span style=display:flex><span>WARN  package#httpd changed ensure<span style=color:#f92672>=</span>present runtime<span style=color:#f92672>=</span>14.509s provider<span style=color:#f92672>=</span>dnf</span></span></code></pre></div><p>Though of course we would recommend using Hiera data for this.</p><footer class=footline></footer></article></div></main></div><aside id=R-sidebar class=default-animation><div id=R-header-topbar class=default-animation></div><div id=R-header-wrapper class=default-animation><div id=R-header class=default-animation><img src=https://choria-io.github.io/ccm/logo.png></div><search><form action=https://choria-io.github.io/ccm/search/index.html method=get><div class="searchbox default-animation"><button class=search-detail type=submit title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
<label class=a11y-only for=R-search-by>Search</label>
<input data-search-input id=R-search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div></form></search></div><div id=R-homelinks class="default-animation homelinks"><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-homelinks"><ul class="space collapsible-menu"><li data-nav-url=https://choria-io.github.io/ccm/index.html><a class=padding href=https://choria-io.github.io/ccm/index.html><i class="fa-fw fas fa-home"></i> Home</a></li></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-headercontrols"><ul></ul></div><div class="R-menu-divider default-animation"><hr class=padding></div></div><div id=R-content-wrapper class=highlightable><div class="R-sidebarmenu R-shortcutmenu-main"><ul class="enlarge morespace collapsible-menu"><li data-nav-url=https://choria-io.github.io/ccm/resources/index.html><a class=padding href=https://choria-io.github.io/ccm/resources/index.html><b>1. </b>Resources</a></li><li data-nav-url=https://choria-io.github.io/ccm/hiera/index.html><a class=padding href=https://choria-io.github.io/ccm/hiera/index.html><b>2. </b>Hierarchical Data</a></li><li data-nav-url=https://choria-io.github.io/ccm/data/index.html><a class=padding href=https://choria-io.github.io/ccm/data/index.html><b>3. </b>Data</a></li><li class=active data-nav-url=https://choria-io.github.io/ccm/cli/index.html><a class=padding href=https://choria-io.github.io/ccm/cli/index.html><b>4. </b>CLI Usage</a></li><li data-nav-url=https://choria-io.github.io/ccm/yamlmanifests/index.html><a class=padding href=https://choria-io.github.io/ccm/yamlmanifests/index.html><b>5. </b>YAML Manifests</a></li><li data-nav-url=https://choria-io.github.io/ccm/monitoring/index.html><a class=padding href=https://choria-io.github.io/ccm/monitoring/index.html><b>6. </b>Monitoring</a></li></ul></div><div class="R-sidebarmenu R-shortcutmenu-shortcuts"><div class="nav-title padding">More</div><ul class="space collapsible-menu"><li data-nav-url=https://github.com/choria-io/ccm><a class=padding href=https://github.com/choria-io/ccm rel=external><i class='fab fa-fw fa-github'></i> GitHub</a></li><li data-nav-url=https://github.com/choria-io/ccm/releases><a class=padding href=https://github.com/choria-io/ccm/releases rel=external><i class='far fa-save'></i> Download</a></li><li data-nav-url=https://github.com/choria-io/ccm/discussions><a class=padding href=https://github.com/choria-io/ccm/discussions rel=external><i class='far fa-comments'></i> Discussions</a></li><li data-nav-url=https://github.com/choria-io/ccm/issues><a class=padding href=https://github.com/choria-io/ccm/issues rel=external><i class='far fa-life-ring'></i> Issues</a></li><li data-nav-url=https://short.voxpupu.li/puppetcommunity_slack_signup><a class=padding href=https://short.voxpupu.li/puppetcommunity_slack_signup rel=external><i class='fab fa-slack'></i> #choria</a></li></ul></div><div id=R-footer-margin></div><div class="R-menu-divider default-animation"><hr class=padding></div><div class="R-sidebarmenu R-shortcutmenu-footercontrols"><ul><li class=R-variantswitcher><div class="padding menu-control"><i class="fa-fw fas fa-paint-brush"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=R-select-variant>Theme</label>
<select id=R-select-variant><option id=R-select-variant-zen-auto value=zen-auto selected>Auto Theme</option><option id=R-select-variant-zen-light value=zen-light>Light</option><option id=R-select-variant-ccm value=ccm>Dark</option></select></div><div class=clear></div></div><script>window.relearn.markVariant()</script></li></ul></div><div id=R-footer><p>Built with <a href=https://github.com/McShelby/hugo-theme-relearn title=love><i class="fas fa-heart"></i></a> by <a href=https://gohugo.io/>Hugo</a></p></div></div></aside><script src=https://choria-io.github.io/ccm/js/perfect-scrollbar/perfect-scrollbar.min.js?1767884677 defer></script><script src=https://choria-io.github.io/ccm/js/theme.min.js?1767884677 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>