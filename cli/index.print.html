<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.152.2"><meta name=generator content="Relearn 9.0.3"><meta name=description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Shell Usage :: Choria Configuration Manager"><meta name=twitter:description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta property="og:url" content="https://choria-cm.dev/cli/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Shell Usage :: Choria Configuration Manager"><meta property="og:description" content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Shell Usage :: Choria Configuration Manager"><meta itemprop=description content="CCM is designed as a CLI-first tool. Each resource type has its own subcommand under ccm ensure, with required inputs as arguments and optional settings as flags.
The ccm ensure commands are idempotent, making them safe to run multiple times in shell scripts.
Use ccm --help and ccm <command> --help to explore available commands and options.
Managing a Single Resource Managing a single resource is straightforward."><meta itemprop=wordCount content="412"><title>Shell Usage :: Choria Configuration Manager</title><link href=https://choria-cm.dev/cli/index.html rel=canonical type=text/html title="Shell Usage :: Choria Configuration Manager"><link href=/cli/index.xml rel=alternate type=application/rss+xml title="Shell Usage :: Choria Configuration Manager"><link href=/cli/index.md rel=alternate type=text/markdown title="Shell Usage :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1770243757 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1770243757 defer></script><script src=/js/search-lunr.min.js?1770243757 defer></script><script src=/js/search.min.js?1770243757 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1770243757"</script><script src=/js/lunr/lunr.min.js?1770243757 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1770243757 defer></script><script src=/js/lunr/lunr.multi.min.js?1770243757 defer></script><script src=/js/lunr/lunr.en.min.js?1770243757 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1770243757 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1770243757 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1770243757 rel=stylesheet><link href=/css/theme.min.css?1770243757 rel=stylesheet><link href=/css/format-print.min.css?1770243757 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/cli/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/cli/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#managing-a-single-resource>Managing a Single Resource</a></li><li><a href=#managing-multiple-resources>Managing Multiple Resources</a></li><li><a href=#data-in-the-cli>Data in the CLI</a></li><li><a href=#applying-manifests>Applying Manifests</a></li><li><a href=#viewing-system-facts>Viewing System Facts</a></li><li><a href=#resolving-hiera-data>Resolving Hiera Data</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Shell Usage</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/cli/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/cli/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/data/index.html title="Data (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/cli/api/index.html title="JSON API (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable cli" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=shell-usage>Shell Usage</h1><p>CCM is designed as a CLI-first tool. Each resource type has its own subcommand under <code>ccm ensure</code>, with required inputs as arguments and optional settings as flags.</p><p>The <code>ccm ensure</code> commands are idempotent, making them safe to run multiple times in shell scripts.</p><p>Use <code>ccm --help</code> and <code>ccm &lt;command> --help</code> to explore available commands and options.</p><h2 id=managing-a-single-resource>Managing a Single Resource<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Managing a single resource is straightforward.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure package zsh 5.8</code></pre></div><p>This ensures the package <code>zsh</code> is installed at version <code>5.8</code>.</p><p>To view the current state of a resource:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm status package zsh</code></pre></div><h2 id=managing-multiple-resources>Managing Multiple Resources<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When managing multiple resources in a script, create a session first. The session records the outcome of each resource, enabling features like refreshing a service when a file changes.</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>#!/bin/bash

eval &#34;$(ccm session new)&#34;

ccm ensure package httpd
ccm ensure file /etc/httpd/conf/httpd.conf .... --require package#httpd
ccm ensure service httpd --subscribe file#/etc/httpd/conf/httpd.conf
ccm session report --remove</code></pre></div><p>This creates a temporary directory for session state. If the file resource changes, the service restarts automatically.</p><p>If you prefer not to eval command output, use: <code>export CCM_SESSION_STORE=$(mktemp -d)</code></p><h2 id=data-in-the-cli>Data in the CLI<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>As covered in the <a href=/data/index.html>data section</a>, commands automatically read <code>./.env</code> and <code>./.hiera</code> files, merging that data into the session.</p><p>Use the <code>--hiera</code> flag or <code>CCM_HIERA_DATA</code> environment variable to specify a different data file.</p><p>With data loaded, you can access:</p><ul><li><code>{{ lookup("data.my_data_key") }}</code> for Hiera data</li><li><code>{{ lookup("env.MY_ENV_VAR") }}</code> for environment variables</li><li><code>{{ lookup("facts.host.info.platformFamily") }}</code> for system facts</li></ul><p>Example using Hiera data:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure package &#39;{{ lookup(&#34;data.package&#34;) }}&#39; &#39;{{ lookup(&#34;data.version&#34;) }}&#39;</code></pre></div><p>Expressions use the <a href=https://expr-lang.org/docs/language-definition rel=external>Expr Language</a>, enabling complex logic:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>$ ccm ensure package &#39;{{ lookup(&#34;facts.host.info.platformFamily&#34;) == &#34;rhel&#34; ? &#34;httpd&#34; : &#34;apache2&#34; }}&#39;
WARN  package#httpd changed ensure=present runtime=14.509s provider=dnf</code></pre></div><p>For complex conditional logic, we recommend using Hiera data with hierarchy overrides instead.</p><h2 id=applying-manifests>Applying Manifests<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>For non-shell script usage use YAML manifests with <code>ccm apply</code>:</p><p>See <a href=/yamlmanifests/index.html>YAML Manifests</a> for manifest format details.</p><h2 id=viewing-system-facts>Viewing System Facts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>CCM gathers system facts that can be used in templates and conditions:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight># Show all facts as JSON
$ ccm facts

# Show facts as YAML
$ ccm facts --yaml

# Query specific facts using gjson syntax
$ ccm facts host.info.platformFamily</code></pre></div><h2 id=resolving-hiera-data>Resolving Hiera Data<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>ccm hiera</code> command helps debug and test Hiera data resolution:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight># Resolve a Hiera file with system facts
$ ccm hiera parse data.yaml -S

# Resolve with custom facts
$ ccm hiera parse data.yaml os=linux env=production

# Query a specific key from the result
$ ccm hiera parse data.yaml --query packages</code></pre></div><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Shell Usage</h1><article class=default><header class=headline></header><h1 id=json-api>JSON API</h1><p>CCM provides a STDIN/STDOUT API for managing resources programmatically. This enables integration with external languages, allowing you to build DSLs in Ruby, Perl, Python, or any language that can execute processes and handle JSON or YAML.</p><h2 id=overview>Overview<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The API uses a simple request/response pattern:</p><ol><li>Send a request to <code>ccm ensure api pipe</code> via STDIN</li><li>Receive a response on STDOUT</li></ol><p>Both JSON and YAML formats are supported for requests. The response format is always JSON, but can be explicitly set to YAML using <code>--yaml</code>.</p><h2 id=command>Command<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure api pipe [--yaml] [--noop] [--facts &lt;file&gt;] [--data &lt;file&gt;]</code></pre></div><table><thead><tr><th>Flag</th><th>Description</th></tr></thead><tbody><tr><td><code>--yaml</code></td><td>Output response in YAML format instead of JSON</td></tr><tr><td><code>--noop</code></td><td>Dry-run mode; report what would change without making changes</td></tr><tr><td><code>--facts &lt;file></code></td><td>Load additional facts from a YAML file</td></tr><tr><td><code>--data &lt;file></code></td><td>Load Hiera-style data from a YAML file</td></tr></tbody></table><h2 id=request-format>Request Format<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Requests must include a protocol identifier, resource type, and properties.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>JSON Schemas for these requests and responses are available at <a href=https://choria.io/schemas/ccm/v1/resource_ensure_request.json rel=external>resource_ensure_request.json</a> and <a href=https://choria.io/schemas/ccm/v1/resource_ensure_response.json rel=external>resource_ensure_response.json</a>.</p></div></details><h3 id=json-request>JSON Request<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;package&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;nginx&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=yaml-request>YAML Request<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>io.choria.ccm.v1.resource.ensure.request</span>
</span></span><span style=display:flex><span><span style=color:#f92672>type</span>: <span style=color:#ae81ff>package</span>
</span></span><span style=display:flex><span><span style=color:#f92672>properties</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nginx</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span></span></span></code></pre></div><h3 id=request-fields>Request Fields<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Field</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td><code>protocol</code></td><td>Yes</td><td>Must be <code>io.choria.ccm.v1.resource.ensure.request</code></td></tr><tr><td><code>type</code></td><td>Yes</td><td>Resource type example <code>package</code></td></tr><tr><td><code>properties</code></td><td>Yes</td><td>Resource properties (varies by type)</td></tr></tbody></table><h2 id=response-format>Response Format<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Responses include a protocol identifier and either a state object (on success) or an error message.</p><p>For the full response structure, see <a href=https://pkg.go.dev/github.com/choria-io/ccm@main/model#ResourceEnsureApiResponse rel=external>ResourceEnsureApiResponse</a> in the Go documentation. The <code>state</code> field contains a <a href=https://pkg.go.dev/github.com/choria-io/ccm@main/model#TransactionEvent rel=external>TransactionEvent</a>.</p><h3 id=successful-response>Successful Response<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.response&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;state&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.transaction.event&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;event_id&#34;</span>: <span style=color:#e6db74>&#34;2abc123def456&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;timestamp&#34;</span>: <span style=color:#e6db74>&#34;2026-01-28T10:30:00Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;package&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;provider&#34;</span>: <span style=color:#e6db74>&#34;dnf&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;nginx&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;requested_ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;final_ensure&#34;</span>: <span style=color:#e6db74>&#34;1.24.0-1.el9&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;duration&#34;</span>: <span style=color:#ae81ff>1500000000</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;changed&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;failed&#34;</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h3 id=error-response>Error Response<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.response&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;error&#34;</span>: <span style=color:#e6db74>&#34;invalid protocol \&#34;wrong.protocol\&#34;&#34;</span>
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=examples>Examples<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=install-a-package>Install a Package<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>echo &#39;{
  &#34;protocol&#34;: &#34;io.choria.ccm.v1.resource.ensure.request&#34;,
  &#34;type&#34;: &#34;package&#34;,
  &#34;properties&#34;: {
    &#34;name&#34;: &#34;htop&#34;,
    &#34;ensure&#34;: &#34;present&#34;
  }
}&#39; | ccm ensure api pipe</code></pre></div><h3 id=manage-a-service>Manage a Service<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>cat &lt;&lt;EOF | ccm ensure api pipe
protocol: io.choria.ccm.v1.resource.ensure.request
type: service
properties:
  name: nginx
  ensure: running
EOF</code></pre></div><h3 id=create-a-file>Create a File<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>echo &#39;{
  &#34;protocol&#34;: &#34;io.choria.ccm.v1.resource.ensure.request&#34;,
  &#34;type&#34;: &#34;file&#34;,
  &#34;properties&#34;: {
    &#34;name&#34;: &#34;/etc/motd&#34;,
    &#34;ensure&#34;: &#34;present&#34;,
    &#34;content&#34;: &#34;Welcome to this server\n&#34;,
    &#34;owner&#34;: &#34;root&#34;,
    &#34;group&#34;: &#34;root&#34;,
    &#34;mode&#34;: &#34;0644&#34;
  }
}&#39; | ccm ensure api pipe</code></pre></div><h3 id=dry-run-mode>Dry-Run Mode<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>echo &#39;{
  &#34;protocol&#34;: &#34;io.choria.ccm.v1.resource.ensure.request&#34;,
  &#34;type&#34;: &#34;package&#34;,
  &#34;properties&#34;: {
    &#34;name&#34;: &#34;vim&#34;,
    &#34;ensure&#34;: &#34;absent&#34;
  }
}&#39; | ccm ensure api pipe --noop</code></pre></div><h2 id=resource-types>Resource Types<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>For detailed information about each resource type and its properties, see the <a href=/resources/index.html>Resource Documentation</a></p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=cli-plugins>CLI Plugins</h1><p>CCM supports extending the CLI with custom commands using <a href=https://choria-io.github.io/appbuilder/index.html rel=external>App Builder</a>. This allows you to create organization-specific workflows that integrate with the <code>ccm</code> command.</p><h2 id=plugin-locations>Plugin Locations<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>CCM searches for plugins in two directories:</p><table><thead><tr><th>Location</th><th>Purpose</th></tr></thead><tbody><tr><td><code>/etc/choria/ccm/plugins/</code></td><td>System-wide plugins</td></tr><tr><td><code>$XDG_CONFIG_HOME/choria/ccm/plugins/</code></td><td>User plugins (typically <code>~/.config/choria/ccm/plugins/</code>)</td></tr></tbody></table><p>Plugins in the user directory override system plugins with the same name.</p><h2 id=plugin-file-format>Plugin File Format<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Plugin files must be named <code>&lt;command>-plugin.yaml</code>. The filename determines the command name:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>deploy-plugin.yaml    â†’ ccm deploy
backup-plugin.yaml    â†’ ccm backup
myapp-plugin.yaml     â†’ ccm myapp</code></pre></div><h2 id=basic-plugin-structure>Basic Plugin Structure<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Plugins use App Builder&rsquo;s YAML definition format. Here&rsquo;s a minimal example:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># deploy-plugin.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy application configuration</span>
</span></span><span style=display:flex><span><span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy web server configuration</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>exec</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ccm apply /etc/ccm/manifests/webserver.yaml</span></span></span></code></pre></div><p>This creates <code>ccm deploy web</code> which applies a manifest.</p><h2 id=passing-data-to-manifests>Passing Data to Manifests<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Plugins can pass data to manifests through environment variables or facts. Both are accessible in manifest templates.</p><h3 id=using-environment-variables>Using Environment Variables<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Environment variables set in the plugin are available in manifests via <code>{{ lookup("env.VAR_NAME") }}</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># deploy-plugin.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy with environment</span>
</span></span><span style=display:flex><span><span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy to production</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>exec</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;DEPLOY_ENV=production&#34;</span>
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#34;LOG_LEVEL=warn&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ccm apply /etc/ccm/manifests/app.yaml</span></span></span></code></pre></div><p>In the manifest:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>file</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>/etc/app/config.yaml</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>content</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      environment: {{ lookup(&#34;env.DEPLOY_ENV&#34;) }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      log_level: {{ lookup(&#34;env.LOG_LEVEL&#34;) }}</span></span></span></code></pre></div><h3 id=using-facts>Using Facts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Pass additional facts using the <code>--fact</code> flag. Facts are available via <code>{{ lookup("facts.KEY") }}</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># deploy-plugin.yaml</span>
</span></span><span style=display:flex><span><span style=color:#f92672>name</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span><span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy with custom facts</span>
</span></span><span style=display:flex><span><span style=color:#f92672>commands</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Deploy application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>type</span>: <span style=color:#ae81ff>exec</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>arguments</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>version</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#ae81ff>Application version to deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>required</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      ccm apply /etc/ccm/manifests/app.yaml --fact app_version={{ .Arguments.version }}</span></span></span></code></pre></div><p>In the manifest:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>package</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>myapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;{{ lookup(&#39;facts.app_version&#39;) }}&#34;</span></span></span></code></pre></div><h2 id=further-reading>Further Reading<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>For complete App Builder documentation including all command types, templating features, and advanced options, see the <a href=https://choria-io.github.io/appbuilder/index.html rel=external>App Builder documentation</a>.</p><p>Since version <code>0.13.0</code> of App Builder it has a transform and a command that can invoke CCM Manifests, this combines well with flags, arguments and form wizards to create custom UI&rsquo;s that manage your infrastructure.</p><footer class=footline></footer></article></section></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1770243757 defer></script><script src=/js/theme.min.js?1770243757 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>