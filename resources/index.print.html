<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="Introduction to resources and common properties"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Resources :: Choria Configuration Manager"><meta name=twitter:description content="Introduction to resources and common properties"><meta property="og:url" content="https://choria-cm.dev/resources/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Resources :: Choria Configuration Manager"><meta property="og:description" content="Introduction to resources and common properties"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Resources :: Choria Configuration Manager"><meta itemprop=description content="Introduction to resources and common properties"><meta itemprop=wordCount content="333"><title>Resources :: Choria Configuration Manager</title><link href=https://choria-cm.dev/resources/index.html rel=canonical type=text/html title="Resources :: Choria Configuration Manager"><link href=/resources/index.xml rel=alternate type=application/rss+xml title="Resources :: Choria Configuration Manager"><link href=/resources/index.md rel=alternate type=text/markdown title="Resources :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1771940928 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1771940928 defer></script><script src=/js/search-lunr.min.js?1771940928 defer></script><script src=/js/search.min.js?1771940928 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1771940928"</script><script src=/js/lunr/lunr.min.js?1771940928 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1771940928 defer></script><script src=/js/lunr/lunr.multi.min.js?1771940928 defer></script><script src=/js/lunr/lunr.en.min.js?1771940928 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1771940928 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1771940928 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1771940928 rel=stylesheet><link href=/css/theme.min.css?1771940928 rel=stylesheet><link href=/css/format-print.min.css?1771940928 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/resources/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/resources/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#resource-types>Resource Types</a></li><li><a href=#common-properties>Common Properties</a></li><li><a href=#conditional-resource-execution>Conditional Resource Execution</a></li><li><a href=#about-names>About Names</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Resources</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/index.html title="Introduction (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/archive/index.html title="Archive (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable resources" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=resources>Resources</h1><p>Resources describe the desired state of your infrastructure. Each resource represents something to manage and is backed by a provider that implements platform-specific management logic.</p><p>Every resource has a type, a unique name, and resource-specific properties.</p><h2 id=resource-types>Resource Types<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><ul><li><a href=/resources/archive/>Archive</a> - Download, extract and copy files from tar.gz and zip archives</li><li><a href=/resources/exec/>Exec</a> - Idempotent command execution</li><li><a href=/resources/file/>File</a> - Manage files content, ownership and more</li><li><a href=/resources/package/>Package</a> - Install, upgrade, downgrade and remove packages using OS Native packagers</li><li><a href=/resources/scaffold/>Scaffold</a> - Render template directories into target directories with synchronization and purge support</li><li><a href=/resources/service/>Service</a> - Enable, disable, start, stop and restart services using OS Native service managers</li></ul><h2 id=common-properties>Common Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>All resources support the following common properties:</p><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Unique identifier for the resource</td></tr><tr><td><code>ensure</code></td><td>Desired state (values vary by resource type)</td></tr><tr><td><code>alias</code></td><td>Alternative name for use in <code>subscribe</code>, <code>require</code>, and logging</td></tr><tr><td><code>provider</code></td><td>Force a specific provider</td></tr><tr><td><code>require</code></td><td>List of resources (<code>type#name</code> or <code>type#alias</code>) that must succeed first</td></tr><tr><td><code>health_checks</code></td><td>Health checks to run after applying (see <a href=/monitoring/index.html>Monitoring</a>)</td></tr><tr><td><code>control</code></td><td>Conditional execution rules (see below)</td></tr></tbody></table><h2 id=conditional-resource-execution>Conditional Resource Execution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Resources can be conditionally executed using a <code>control</code> section and expressions that should resolve to boolean values.</p><div class=tab-panel data-tab-group=R-tabs-036c382b17b9d2483e35fd1ce47c104e><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-4b13a39c0902c81280c4c0593d1a9a3a aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-036c382b17b9d2483e35fd1ce47c104e","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-fc8a8f5a42bc8d40d6839d2d723743bc aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-036c382b17b9d2483e35fd1ce47c104e","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-962a2248b788000c2fb9c379c7ae0a5f aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-036c382b17b9d2483e35fd1ce47c104e","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-4b13a39c0902c81280c4c0593d1a9a3a data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>package</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>zsh</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>5.9</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>control</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>if</span>: <span style=color:#ae81ff>lookup(&#34;facts.host.info.os&#34;) == &#34;linux&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>unless</span>: <span style=color:#ae81ff>lookup(&#34;facts.host.info.virtualizationSystem&#34;) == &#34;docker&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-fc8a8f5a42bc8d40d6839d2d723743bc data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure package zsh 5.9 \
    --if &#34;lookup(&#39;facts.host.info.os&#39;) == &#39;linux&#39;&#34;
    --unless &#34;lookup(&#39;facts.host.info.virtualizationSystem&#39;) == &#39;docker&#39;&#34;</code></pre></div></div></div><div id=R-tab-id-962a2248b788000c2fb9c379c7ae0a5f data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;package&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;zsh&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;5.9&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;control&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;if&#34;</span>: <span style=color:#e6db74>&#34;lookup(\&#34;facts.host.info.os\&#34;) == \&#34;linux\&#34;&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;unless&#34;</span>: <span style=color:#e6db74>&#34;lookup(\&#34;facts.host.info.virtualizationSystem\&#34;) == \&#34;docker\&#34;&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Here we install <code>zsh</code> on all <code>linux</code> machines unless they are running inside a <code>docker</code> container.</p><p>The following table shows how the two conditions interact:</p><table><thead><tr><th><code>if</code></th><th><code>unless</code></th><th>Resource Managed?</th></tr></thead><tbody><tr><td>(not set)</td><td>(not set)</td><td>Yes</td></tr><tr><td><code>true</code></td><td>(not set)</td><td>Yes</td></tr><tr><td><code>false</code></td><td>(not set)</td><td>No</td></tr><tr><td>(not set)</td><td><code>true</code></td><td>No</td></tr><tr><td>(not set)</td><td><code>false</code></td><td>Yes</td></tr><tr><td><code>true</code></td><td><code>true</code></td><td>No</td></tr><tr><td><code>true</code></td><td><code>false</code></td><td>Yes</td></tr><tr><td><code>false</code></td><td><code>true</code></td><td>No</td></tr><tr><td><code>false</code></td><td><code>false</code></td><td>No</td></tr></tbody></table><h2 id=about-names>About Names<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Resources can be specified like:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>/etc/motd</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span></span></span></code></pre></div><p>This sets <code>name</code> to <code>/etc/motd</code>, in the following paragraphs we will refer to this as <code>name</code>.</p><footer class=footline></footer></article><section><h1 class=a11y-only>Subsections of Resources</h1><article class=default><header class=headline></header><h1 id=archive>Archive</h1><p>The archive resource downloads and extracts archives from HTTP/HTTPS URLs. It supports tar.gz, tgz, tar, and zip formats.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>The archive file path (<code>name</code>) must have the same archive type extension as the URL. For example, if the URL ends in <code>.tar.gz</code>, the name must also end in <code>.tar.gz</code>.</p></div></details><div class=tab-panel data-tab-group=R-tabs-3ee6b0820b7e2b4d7ed93a135fe588d2><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-232fef95d6f7f70854fca6f7fc2f3c02 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-3ee6b0820b7e2b4d7ed93a135fe588d2","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-fe2724882764e74e002fea0207675d29 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-3ee6b0820b7e2b4d7ed93a135fe588d2","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-73807785556167b850f090c999f3d1db aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-3ee6b0820b7e2b4d7ed93a135fe588d2","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-232fef95d6f7f70854fca6f7fc2f3c02 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>archive</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/downloads/app-v1.2.3.tar.gz</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://releases.example.com/app/v1.2.3/app-v1.2.3.tar.gz</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>checksum</span>: <span style=color:#e6db74>&#34;a1b2c3d4e5f6...&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>extract_parent</span>: <span style=color:#ae81ff>/opt/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/opt/app/bin/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cleanup</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div><div id=R-tab-id-fe2724882764e74e002fea0207675d29 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure archive /opt/downloads/app.tar.gz \
    --url https://releases.example.com/app.tar.gz \
    --extract-parent /opt/app \
    --creates /opt/app/bin/app \
    --owner root --group root</code></pre></div></div></div><div id=R-tab-id-73807785556167b850f090c999f3d1db data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;archive&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/opt/downloads/app-v1.2.3.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://releases.example.com/app/v1.2.3/app-v1.2.3.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;checksum&#34;</span>: <span style=color:#e6db74>&#34;a1b2c3d4e5f6...&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;extract_parent&#34;</span>: <span style=color:#e6db74>&#34;/opt/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;creates&#34;</span>: <span style=color:#e6db74>&#34;/opt/app/bin/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;group&#34;</span>: <span style=color:#e6db74>&#34;app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;cleanup&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This downloads the archive, extracts it to <code>/opt/app</code>, and removes the archive file after extraction. Future runs skip the download if <code>/opt/app/bin/app</code> exists.</p><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>The archive must be downloaded</td></tr><tr><td><code>absent</code></td><td>The archive file must not exist</td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Absolute path where the archive will be saved</td></tr><tr><td><code>url</code></td><td>HTTP/HTTPS URL to download the archive from</td></tr><tr><td><code>checksum</code></td><td>Expected SHA256 checksum of the downloaded file</td></tr><tr><td><code>extract_parent</code></td><td>Directory to extract the archive contents into</td></tr><tr><td><code>creates</code></td><td>File path; if this file exists, the archive is not downloaded or extracted</td></tr><tr><td><code>cleanup</code></td><td>Remove the archive file after successful extraction (requires <code>extract_parent</code> and <code>creates</code>)</td></tr><tr><td><code>owner</code></td><td>Owner of the downloaded archive file (username)</td></tr><tr><td><code>group</code></td><td>Group of the downloaded archive file (group name)</td></tr><tr><td><code>username</code></td><td>Username for HTTP Basic Authentication</td></tr><tr><td><code>password</code></td><td>Password for HTTP Basic Authentication</td></tr><tr><td><code>headers</code></td><td>Additional HTTP headers to send with the request (map of header name to value)</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>http</code> only)</td></tr></tbody></table><h2 id=authentication>Authentication<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The archive resource supports two authentication methods:</p><p><strong>Basic Authentication:</strong></p><div class=tab-panel data-tab-group=R-tabs-14f24849b38bf087401977e6bfd0fc3d><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e0654e0f167e70a5b4e9084a38adc01b aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-14f24849b38bf087401977e6bfd0fc3d","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-58f5afdc3b4e2906a5a304719b6e7768 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-14f24849b38bf087401977e6bfd0fc3d","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-c1844f165e3cd13bc8328e4175931934 aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-14f24849b38bf087401977e6bfd0fc3d","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-e0654e0f167e70a5b4e9084a38adc01b data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>archive</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/downloads/private-app.tar.gz</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://private.example.com/app.tar.gz</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>username</span>: <span style=color:#ae81ff>deploy</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>password</span>: <span style=color:#e6db74>&#34;{{ lookup(&#39;data.deploy_password&#39;) }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>extract_parent</span>: <span style=color:#ae81ff>/opt/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span></span></span></code></pre></div></div></div><div id=R-tab-id-58f5afdc3b4e2906a5a304719b6e7768 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure archive /opt/downloads/private-app.tar.gz \
    --url https://private.example.com/app.tar.gz \
    --username deploy \
    --password &#34;{{ lookup(&#39;data.deploy_password&#39;) }}&#34;</code></pre></div></div></div><div id=R-tab-id-c1844f165e3cd13bc8328e4175931934 data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;archive&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/opt/downloads/private-app.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://private.example.com/app.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;username&#34;</span>: <span style=color:#e6db74>&#34;deploy&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;password&#34;</span>: <span style=color:#e6db74>&#34;secret&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;extract_parent&#34;</span>: <span style=color:#e6db74>&#34;/opt/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;group&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p><strong>Custom Headers:</strong></p><div class=tab-panel data-tab-group=R-tabs-2411b64760908ab225a3c03b84d79874><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-2e836264370fd5fd48d14dd810a99b7a aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-2411b64760908ab225a3c03b84d79874","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-9e9968f4c965d2e1d3fe8f837768f184 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2411b64760908ab225a3c03b84d79874","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-5c4f7f4c3986620ef02d6c417e30bc2d aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-2411b64760908ab225a3c03b84d79874","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-2e836264370fd5fd48d14dd810a99b7a data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>archive</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/downloads/app.tar.gz</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://api.example.com/releases/app.tar.gz</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>headers</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>Authorization</span>: <span style=color:#e6db74>&#34;Bearer {{ lookup(&#39;data.api_token&#39;) }}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>X-Custom-Header</span>: <span style=color:#ae81ff>custom-value</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>extract_parent</span>: <span style=color:#ae81ff>/opt/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span></span></span></code></pre></div></div></div><div id=R-tab-id-9e9968f4c965d2e1d3fe8f837768f184 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure archive /opt/downloads/app.tar.gz \
    --url https://api.example.com/releases/app.tar.gz \
    --headers &#34;Authorization:{{ lookup(&#39;data.api_token&#39;) }}&#34;</code></pre></div></div></div><div id=R-tab-id-5c4f7f4c3986620ef02d6c417e30bc2d data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;archive&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/opt/downloads/app.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;https://api.example.com/releases/app.tar.gz&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;headers&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Authorization&#34;</span>: <span style=color:#e6db74>&#34;Bearer mytoken&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;X-Custom-Header&#34;</span>: <span style=color:#e6db74>&#34;custom-value&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;extract_parent&#34;</span>: <span style=color:#e6db74>&#34;/opt/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;group&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The archive resource is idempotent through multiple mechanisms:</p><ol><li><strong>Checksum verification</strong>: If a <code>checksum</code> is provided and the existing file matches, no download occurs.</li><li><strong>Creates file</strong>: If <code>creates</code> is specified and that file exists, neither download nor extraction occurs.</li><li><strong>File existence</strong>: If the archive file exists with matching checksum and owner/group, no changes are made.</li></ol><p>For best idempotency, always specify either <code>checksum</code> or <code>creates</code> (or both).</p><h2 id=cleanup-behavior>Cleanup Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When <code>cleanup: true</code> is set:</p><ul><li>The archive file is deleted after successful extraction</li><li>The <code>extract_parent</code> property is required</li><li>The <code>creates</code> property is required to track extraction state across runs</li></ul><h2 id=supported-archive-formats>Supported Archive Formats<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Extension</th><th>Extraction Tool</th></tr></thead><tbody><tr><td><code>.tar.gz</code>, <code>.tgz</code></td><td><code>tar -xzf</code></td></tr><tr><td><code>.tar</code></td><td><code>tar -xf</code></td></tr><tr><td><code>.zip</code></td><td><code>unzip</code></td></tr></tbody></table><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>The extraction tools (<code>tar</code>, <code>unzip</code>) must be available in the system PATH.</p></div></details><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=exec>Exec</h1><p>The exec resource executes commands to bring the system into the desired state. It is idempotent when used with the <code>creates</code> property or <code>refreshonly</code> mode.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Specify commands with their full path, or use the <code>path</code> property to set the search path.</p></div></details><div class=tab-panel data-tab-group=R-tabs-c998986001ff1269609c4ac45cc77ecf><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-817356aec4373612f16a59b84790df10 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-c998986001ff1269609c4ac45cc77ecf","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-26f9d775e1fa13f5d695bf0e72ef711f aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c998986001ff1269609c4ac45cc77ecf","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-aa975feb95d62450ce67a5e1cce7580c aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-c998986001ff1269609c4ac45cc77ecf","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-817356aec4373612f16a59b84790df10 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/usr/bin/touch /tmp/hello</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/tmp/hello</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cwd</span>: <span style=color:#ae81ff>/tmp</span></span></span></code></pre></div><p>Alternatively for long commands or to improve UX for referencing execs in <code>require</code> or <code>subscribe</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>touch_hello</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>/usr/bin/touch /tmp/hello</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>creates</span>: <span style=color:#ae81ff>/tmp/hello</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>timeout</span>: <span style=color:#ae81ff>30s</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cwd</span>: <span style=color:#ae81ff>/tmp</span></span></span></code></pre></div></div></div><div id=R-tab-id-26f9d775e1fa13f5d695bf0e72ef711f data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure exec &#34;/usr/bin/touch /tmp/hello&#34; --creates /tmp/hello --timeout 30s</code></pre></div></div></div><div id=R-tab-id-aa975feb95d62450ce67a5e1cce7580c data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;exec&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/touch /tmp/hello&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;creates&#34;</span>: <span style=color:#e6db74>&#34;/tmp/hello&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;timeout&#34;</span>: <span style=color:#e6db74>&#34;30s&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;cwd&#34;</span>: <span style=color:#e6db74>&#34;/tmp&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>The command runs only if <code>/tmp/hello</code> does not exist.</p><h2 id=providers>Providers<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The exec resource supports two providers:</p><table><thead><tr><th>Provider</th><th>Description</th></tr></thead><tbody><tr><td><code>posix</code></td><td>Default. Executes commands directly without a shell. Arguments are parsed and passed to the executable.</td></tr><tr><td><code>shell</code></td><td>Executes commands via <code>/bin/sh -c "..."</code>. Use this for shell features like pipes, redirections, and builtins.</td></tr></tbody></table><p>The <code>posix</code> provider is the default and is suitable for most commands. Use the <code>shell</code> provider when you need shell features:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>exec</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>cleanup-logs</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>find /var/log -name &#39;*.log&#39; -mtime +30 -delete &amp;&amp; echo &#34;Done&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>check-service</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>systemctl is-active httpd || systemctl start httpd</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>process-data</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>command</span>: <span style=color:#ae81ff>cat /tmp/input.txt | grep -v &#39;^#&#39; | sort | uniq &gt; /tmp/output.txt</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>provider</span>: <span style=color:#ae81ff>shell</span></span></span></code></pre></div><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>The <code>shell</code> provider passes the entire command string to <code>/bin/sh -c</code>, so shell quoting rules apply. The <code>posix</code> provider parses arguments using shell-like quoting but does not invoke a shell.</p></div></details><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>The command to execute (used as the resource identifier)</td></tr><tr><td><code>command</code></td><td>Alternative command to run instead of <code>name</code></td></tr><tr><td><code>cwd</code></td><td>Working directory for command execution</td></tr><tr><td><code>environment</code> (array)</td><td>Environment variables in <code>KEY=VALUE</code> format</td></tr><tr><td><code>path</code></td><td>Search path for executables as a colon-separated list (e.g., <code>/usr/bin:/bin</code>)</td></tr><tr><td><code>returns</code> (array)</td><td>Exit codes indicating success (default: <code>[0]</code>)</td></tr><tr><td><code>timeout</code></td><td>Maximum execution time (e.g., <code>30s</code>, <code>5m</code>); command is killed if exceeded</td></tr><tr><td><code>creates</code></td><td>File path; if this file exists, the command does not run</td></tr><tr><td><code>refreshonly</code> (boolean)</td><td>Only run when notified by a subscribed resource</td></tr><tr><td><code>subscribe</code> (array)</td><td>Resources to subscribe to for refresh notifications (<code>type#name</code> or <code>type#alias</code>)</td></tr><tr><td><code>logoutput</code> (boolean)</td><td>Log the command output</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>posix</code> or <code>shell</code>)</td></tr></tbody></table><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=file>File</h1><p>The file resource manages files and directories, including their content, ownership, and permissions.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Use absolute file paths and primary group names.</p></div></details><div class=tab-panel data-tab-group=R-tabs-4e73a234c27681042f493843c4431206><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-b6e680216bc930b88ab8924e6bda32a8 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-4e73a234c27681042f493843c4431206","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-9e424cbac2700fc59ca00c2aa00b5997 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4e73a234c27681042f493843c4431206","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-36c1d4235b777cb919815f75ccfa9e0a aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-4e73a234c27681042f493843c4431206","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-b6e680216bc930b88ab8924e6bda32a8 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>file</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/motd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>content</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          Managed by CCM {{ now() }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>owner</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>group</span>: <span style=color:#ae81ff>root</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mode</span>: <span style=color:#e6db74>&#34;0644&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-9e424cbac2700fc59ca00c2aa00b5997 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure file /etc/motd --source /tmp/ccm/motd --owner root --group root --mode 0644</code></pre></div></div></div><div id=R-tab-id-36c1d4235b777cb919815f75ccfa9e0a data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;file&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/etc/motd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;Managed by CCM\n&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;owner&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;group&#34;</span>: <span style=color:#e6db74>&#34;root&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;mode&#34;</span>: <span style=color:#e6db74>&#34;0644&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This copies the contents of <code>/tmp/ccm/motd</code> to <code>/etc/motd</code> verbatim and sets ownership.</p><p>Use <code>--content</code> or <code>--content-file</code> to parse content through the template engine before writing.</p><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>The file must exist</td></tr><tr><td><code>absent</code></td><td>The file must not exist</td></tr><tr><td><code>directory</code></td><td>The path must be a directory</td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Absolute path to the file</td></tr><tr><td><code>ensure</code></td><td>Desired state (<code>present</code>, <code>absent</code>, <code>directory</code>)</td></tr><tr><td><code>content</code></td><td>File contents, parsed through the template engine</td></tr><tr><td><code>source</code></td><td>Copy contents from another local file</td></tr><tr><td><code>owner</code></td><td>File owner (username)</td></tr><tr><td><code>group</code></td><td>File group (group name)</td></tr><tr><td><code>mode</code></td><td>File permissions in octal notation (e.g., <code>"0644"</code>)</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>posix</code> only)</td></tr></tbody></table><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=package>Package</h1><p>The package resource manages system packages. Specify whether the package should be present, absent, at the latest version, or at a specific version.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Use real package names, not virtual names, aliases, or group names.</p></div></details><div class=tab-panel data-tab-group=R-tabs-9d36b9863a8cc5a0724325be18669302><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ce2edb6278dba91d6e46e2561e1c3be9 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-9d36b9863a8cc5a0724325be18669302","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-e04acc94b3df12db3e2767c40ae4ebed aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9d36b9863a8cc5a0724325be18669302","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-224e3a95a618602a9e3f64ede1f2f9f3 aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-9d36b9863a8cc5a0724325be18669302","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-ce2edb6278dba91d6e46e2561e1c3be9 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>package</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>zsh</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#e6db74>&#34;5.9&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-e04acc94b3df12db3e2767c40ae4ebed data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure package zsh 5.9</code></pre></div></div></div><div id=R-tab-id-224e3a95a618602a9e3f64ede1f2f9f3 data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;package&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;zsh&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;5.9&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>The package must be installed</td></tr><tr><td><code>latest</code></td><td>The package must be installed at latest version</td></tr><tr><td><code>absent</code></td><td>The package must not be installed</td></tr><tr><td><code>&lt;version></code></td><td>The package must be installed at this version</td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Package name</td></tr><tr><td><code>ensure</code></td><td>Desired state or version</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>dnf</code>, <code>apt</code>)</td></tr></tbody></table><h2 id=provider-notes>Provider Notes<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><h3 id=apt-debianubuntu>APT (Debian/Ubuntu)<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The APT provider preserves existing configuration files during package installation and upgrades. When a package is upgraded and the maintainer has provided a new version of a configuration file, the existing file is kept (<code>--force-confold</code> behavior).</p><p>Packages in a partially installed or <code>config-files</code> state (removed but configuration remains) are treated as absent. Reinstalling such packages will preserve the existing configuration files.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>The provider will not run <code>apt update</code> before installing a package. Use an <code>exec</code> resource to update the package index if necessary.</p></div></details><p>The provider runs non-interactively and suppresses prompts from <code>apt-listbugs</code> and <code>apt-listchanges</code>.</p><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=scaffold>Scaffold</h1><p>The scaffold resource renders files from a source template directory to a target directory. Templates have access to facts and Hiera data, enabling dynamic configuration generation from directory structures.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Target paths must be absolute and canonical (no <code>.</code> or <code>..</code> components).</p></div></details><div class=tab-panel data-tab-group=R-tabs-0f2e247ce01b83a544c29c5af797d6c9><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-aa18aa107e23f14203a111c630eb25d0 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-0f2e247ce01b83a544c29c5af797d6c9","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-be975702559ece78a329379a5b2a49d9 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0f2e247ce01b83a544c29c5af797d6c9","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-1b17c69aecb054fbafa2abcc456640cc aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-0f2e247ce01b83a544c29c5af797d6c9","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-aa18aa107e23f14203a111c630eb25d0 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>engine</span>: <span style=color:#ae81ff>jet</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>purge</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div><div id=R-tab-id-be975702559ece78a329379a5b2a49d9 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /etc/app templates/app --engine jet --purge</code></pre></div></div></div><div id=R-tab-id-1b17c69aecb054fbafa2abcc456640cc data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/etc/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;engine&#34;</span>: <span style=color:#e6db74>&#34;jet&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;purge&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This renders templates from the <code>templates/app</code> directory into <code>/etc/app</code> using the Jet template engine, removing any files in the target not present in the source.</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>This is implemented using the <a href=https://github.com/choria-io/scaffold rel=external>github.com/choria-io/scaffold</a> Go library, you can use this in your own projects or use the included <code>scaffold</code> CLI tool.</p></div></details><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>Target directory must exist with rendered template files</td></tr><tr><td><code>absent</code></td><td>Managed files must be removed; target directory removed if empty</td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Absolute path to the target directory</td></tr><tr><td><code>source</code></td><td>Source template directory path (relative to working directory or absolute)</td></tr><tr><td><code>engine</code></td><td>Template engine: <code>go</code> or <code>jet</code> (default: <code>jet</code>)</td></tr><tr><td><code>skip_empty</code></td><td>Do not create empty files in rendered output</td></tr><tr><td><code>left_delimiter</code></td><td>Custom left template delimiter</td></tr><tr><td><code>right_delimiter</code></td><td>Custom right template delimiter</td></tr><tr><td><code>purge</code></td><td>Remove files in target not present in source</td></tr><tr><td><code>post</code></td><td>Post-processing commands: glob pattern to command mapping</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>choria</code> only)</td></tr></tbody></table><h2 id=template-engines>Template Engines<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Two template engines are supported:</p><table><thead><tr><th>Engine</th><th>Library</th><th>Default Delimiters</th><th>Description</th></tr></thead><tbody><tr><td><code>go</code></td><td>Go <code>text/template</code></td><td><code>{{</code> / <code>}}</code></td><td>Standard Go templates</td></tr><tr><td><code>jet</code></td><td>Jet templating</td><td><code>[[</code> / <code>]]</code></td><td>Jet template language</td></tr></tbody></table><p>The engine defaults to <code>jet</code> if not specified. Delimiters can be customized via <code>left_delimiter</code> and <code>right_delimiter</code>.</p><h2 id=custom-delimiters>Custom Delimiters<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class=tab-panel data-tab-group=R-tabs-a07c3da279a543fd6fe269230e1c1014><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-e5ca72fcc04ca17eed13a8765f16c549 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a07c3da279a543fd6fe269230e1c1014","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-5bc5bfdf4c8c9ec0271863b55d399e23 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a07c3da279a543fd6fe269230e1c1014","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-c863a633108d50e8ab2a421e7e6a735d aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a07c3da279a543fd6fe269230e1c1014","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-e5ca72fcc04ca17eed13a8765f16c549 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/myservice</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/myservice</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>engine</span>: <span style=color:#ae81ff>go</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>left_delimiter</span>: <span style=color:#e6db74>&#34;&lt;&lt;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>right_delimiter</span>: <span style=color:#e6db74>&#34;&gt;&gt;&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-5bc5bfdf4c8c9ec0271863b55d399e23 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /etc/myservice templates/myservice \
    --engine go --left-delimiter &#34;&lt;&lt;&#34; --right-delimiter &#34;&gt;&gt;&#34;</code></pre></div></div></div><div id=R-tab-id-c863a633108d50e8ab2a421e7e6a735d data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/etc/myservice&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/myservice&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;engine&#34;</span>: <span style=color:#e6db74>&#34;go&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;left_delimiter&#34;</span>: <span style=color:#e6db74>&#34;&lt;&lt;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;right_delimiter&#34;</span>: <span style=color:#e6db74>&#34;&gt;&gt;&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><h2 id=post-processing>Post-Processing<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>post</code> property defines commands to run on rendered files. Each entry is a map where the key is a <strong>glob pattern</strong> matched against the file&rsquo;s basename and the value is a <strong>command</strong> to execute. Use <code>{}</code> in the command as a placeholder for the file&rsquo;s full path; if omitted, the path is appended as the last argument.</p><div class=tab-panel data-tab-group=R-tabs-306eb42a0afe9d7282674734e254fbe7><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-ca811b847d5975d9ed4132bfce9a1331 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-306eb42a0afe9d7282674734e254fbe7","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-737271bbf41c6ba6717a918379fa455a aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-306eb42a0afe9d7282674734e254fbe7","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-1e842e12e8c57b4e00837caee404f808 aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-306eb42a0afe9d7282674734e254fbe7","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-ca811b847d5975d9ed4132bfce9a1331 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>post</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.go&#34;: </span><span style=color:#e6db74>&#34;go fmt {}&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.sh&#34;: </span><span style=color:#e6db74>&#34;chmod +x {}&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-737271bbf41c6ba6717a918379fa455a data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /opt/app templates/app \
    --post &#34;*.go&#34;=&#34;go fmt {}&#34; --post &#34;*.sh&#34;=&#34;chmod +x {}&#34;</code></pre></div></div></div><div id=R-tab-id-1e842e12e8c57b4e00837caee404f808 data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/opt/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;post&#34;</span>: [
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;*.go&#34;</span>: <span style=color:#e6db74>&#34;go fmt {}&#34;</span>},
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;*.sh&#34;</span>: <span style=color:#e6db74>&#34;chmod +x {}&#34;</span>}
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Post-processing runs immediately after each file is rendered. Files skipped due to <code>skip_empty</code> are not post-processed.</p><h2 id=purge-behavior>Purge Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When <code>purge: true</code> is set, files in the target directory that are not present in the source template directory are deleted during rendering. In noop mode, these deletions are logged but not performed.</p><p>When <code>purge</code> is disabled (the default), files not present in the source are tracked but not removed. They do not affect idempotency checks for <code>ensure: present</code>, meaning the resource is considered stable even if extra files exist in the target.</p><h2 id=removal-behavior>Removal Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When <code>ensure: absent</code>, only managed files (changed and stable) are removed. Files not belonging to the scaffold (purged files) are left untouched. After removing managed files and empty subdirectories, the target directory itself is removed on a best-effort basis â€” it is only deleted if empty. If unrelated files remain, the directory is preserved and no error is raised.</p><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The scaffold resource determines idempotency by rendering templates in noop mode and comparing results against the target directory.</p><p>For <code>ensure: present</code>:</p><ul><li><strong>Changed files</strong>: Files that would be created or modified. Any changed files make the resource unstable.</li><li><strong>Stable files</strong>: Files whose content matches the rendered output. At least one stable file must exist for the resource to be considered stable.</li><li><strong>Purged files</strong>: Files in the target not present in the source. These only affect stability when <code>purge</code> is enabled.</li></ul><p>For <code>ensure: absent</code>, the status check filters <code>Changed</code> and <code>Stable</code> lists to only include files that actually exist on disk. This means after a successful removal, the scaffold is considered absent even if the target directory still exists with unrelated files. Purged files never affect the absent stability check.</p><h2 id=source-resolution>Source Resolution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>source</code> property is resolved relative to the manager&rsquo;s working directory when it is a relative path. URL sources (with a scheme) are passed through unchanged. This allows manifests bundled with template directories to use relative paths.</p><h2 id=template-environment>Template Environment<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Templates receive the full template environment, which provides access to:</p><ul><li><code>facts</code> - System facts for the managed node</li><li><code>data</code> - Hiera-resolved configuration data</li><li>Template helper functions</li></ul><h2 id=creating-scaffolds>Creating Scaffolds<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A scaffold source is a directory tree where every file is a template. The directory structure is mirrored directly into the target, so the source layout becomes the output layout.</p><h3 id=source-directory-structure>Source Directory Structure<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>templates/app/
â”œâ”€â”€ _partials/
â”‚   â””â”€â”€ header.conf
â”œâ”€â”€ config.yaml
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh
â””â”€â”€ README.md</code></pre></div><p>This renders into:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/etc/app/
â”œâ”€â”€ config.yaml
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh
â””â”€â”€ README.md</code></pre></div><p>The <code>_partials</code> directory is special â€” its contents are available to templates but are never copied to the target.</p><h3 id=template-syntax>Template Syntax<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Every file in the source directory is processed as a template. The syntax depends on the engine selected.</p><p><strong>Jet engine</strong> (default, <code>[[</code> / <code>]]</code> delimiters):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># config.yaml
hostname: [[ facts.hostname ]]
environment: [[ data.environment ]]
workers: [[ data.worker_count ]]</code></pre></div><p><strong>Go engine</strong> (<code>{{</code> / <code>}}</code> delimiters):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># config.yaml
hostname: {{ .facts.hostname }}
environment: {{ .data.environment }}
workers: {{ .data.worker_count }}</code></pre></div><p>The Jet engine is the default because its <code>[[</code> / <code>]]</code> delimiters avoid conflicts with configuration files that use curly braces (YAML, JSON, systemd units). Use the Go engine when you need access to <a href=https://masterminds.github.io/sprig/ rel=external>Sprig functions</a>.</p><h3 id=partials>Partials<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Files inside a <code>_partials</code> directory are reusable template fragments. They are rendered on demand using the <code>render</code> function but are excluded from the output.</p><p>This is useful for shared headers, repeated configuration blocks, or any content used across multiple files.</p><p><strong>Jet:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/header.conf&#34;, .) ]]

server {
    listen [[ data.port ]];
}</code></pre></div><p><strong>Go:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ render &#34;_partials/header.conf&#34; . }}

server {
    listen {{ .data.port }};
}</code></pre></div><h3 id=built-in-functions>Built-in Functions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Two functions are available in both template engines:</p><p><strong><code>render</code></strong> evaluates another template file from the source directory and returns its output as a string. The partial is rendered using the same engine and data as the calling template.</p><div class=tab-panel data-tab-group=R-tabs-f9e2c4044b1830c5cda6871b793bb39a><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5c847ebd87d990537fde2d5ae758d01e aria-expanded=true data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f9e2c4044b1830c5cda6871b793bb39a","R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b")'>
<span class=tab-nav-text>Jet</span>
</button>
<button aria-controls=R-tab-id-e828029e624a3878fd5cf216d5a909b9 aria-expanded=false data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f9e2c4044b1830c5cda6871b793bb39a","R-tab-5f075ae3e1f9d0382bb8c4632991f96f")'>
<span class=tab-nav-text>Go</span></button></div><div class=tab-content-container><div id=R-tab-id-5c847ebd87d990537fde2d5ae758d01e data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/database.conf&#34;, .) ]]</code></pre></div></div></div><div id=R-tab-id-e828029e624a3878fd5cf216d5a909b9 data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ render &#34;_partials/database.conf&#34; . }}</code></pre></div></div></div></div></div><p><strong><code>write</code></strong> creates an additional file in the target directory from within a template. This is useful for dynamically generating files based on data â€” for example, creating one configuration file per service.</p><div class=tab-panel data-tab-group=R-tabs-02a8855bf93f172800000c09707d8298><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-dc0befbb0eaa9a374f4ca335af8a16a4 aria-expanded=true data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-02a8855bf93f172800000c09707d8298","R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b")'>
<span class=tab-nav-text>Jet</span>
</button>
<button aria-controls=R-tab-id-f911c67ca26d2f22c4a937991c41192f aria-expanded=false data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-02a8855bf93f172800000c09707d8298","R-tab-5f075ae3e1f9d0382bb8c4632991f96f")'>
<span class=tab-nav-text>Go</span></button></div><div class=tab-content-container><div id=R-tab-id-dc0befbb0eaa9a374f4ca335af8a16a4 data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ write(&#34;extra.conf&#34;, &#34;generated content&#34;) ]]</code></pre></div></div></div><div id=R-tab-id-f911c67ca26d2f22c4a937991c41192f data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ write &#34;extra.conf&#34; &#34;generated content&#34; }}</code></pre></div></div></div></div></div><h3 id=sprig-functions>Sprig Functions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>When using the Go template engine, all <a href=https://masterminds.github.io/sprig/ rel=external>Sprig</a> template functions are available. These provide string manipulation, math, date formatting, list operations, and more:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># Go engine example with Sprig functions
hostname: {{ .facts.hostname | upper }}
packages: {{ join &#34;, &#34; .data.packages }}
generated: {{ now | date &#34;2006-01-02&#34; }}</code></pre></div><h3 id=example-scaffold>Example Scaffold<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>A complete scaffold for an application configuration:</p><p><strong>Source structure:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>templates/myapp/
â”œâ”€â”€ _partials/
â”‚   â””â”€â”€ logging.conf
â”œâ”€â”€ myapp.conf
â””â”€â”€ scripts/
    â””â”€â”€ healthcheck.sh</code></pre></div><p><strong><code>_partials/logging.conf</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>log_level = [[ data.log_level ]]
log_file = /var/log/myapp/[[ facts.hostname ]].log</code></pre></div><p><strong><code>myapp.conf</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/logging.conf&#34;, .) ]]

[server]
bind = 0.0.0.0
port = [[ data.port ]]
workers = [[ data.workers ]]</code></pre></div><p><strong><code>scripts/healthcheck.sh</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>#!/bin/bash
curl -sf http://localhost:[[ data.port ]]/health || exit 1</code></pre></div><p><strong>Manifest using this scaffold:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/myapp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>purge</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>post</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.sh&#34;: </span><span style=color:#e6db74>&#34;chmod +x {}&#34;</span></span></span></code></pre></div><p>With facts <code>{"hostname": "web01"}</code> and data <code>{"port": 8080, "workers": 4, "log_level": "info"}</code>, this renders:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/etc/myapp/
â”œâ”€â”€ myapp.conf
â””â”€â”€ scripts/
    â””â”€â”€ healthcheck.sh</code></pre></div><p>Where <code>myapp.conf</code> contains:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>log_level = info
log_file = /var/log/myapp/web01.log

[server]
bind = 0.0.0.0
port = 8080
workers = 4</code></pre></div><footer class=footline></footer></article><article class=default><header class=headline></header><h1 id=service>Service</h1><p>The service resource manages system services. Services have two independent properties: whether they are running and whether they are enabled to start at boot.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Use real service names, not virtual names or aliases.</p></div></details><p>Services can subscribe to other resources and restart when those resources change.</p><div class=tab-panel data-tab-group=R-tabs-d3df912bf6613172f26c9ee325484711><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-fa5954986dafc1dbead6aea14a992b0b aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-d3df912bf6613172f26c9ee325484711","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-adf09876b155d84d5722c84eab2836b3 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-d3df912bf6613172f26c9ee325484711","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-a4880cf47bad03e2406410e228d97a96 aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-d3df912bf6613172f26c9ee325484711","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-fa5954986dafc1dbead6aea14a992b0b data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>httpd</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>running</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>enable</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>subscribe</span>:
</span></span><span style=display:flex><span>          - <span style=color:#ae81ff>package#httpd</span></span></span></code></pre></div></div></div><div id=R-tab-id-adf09876b155d84d5722c84eab2836b3 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure service httpd running --enable --subscribe package#httpd</code></pre></div></div></div><div id=R-tab-id-a4880cf47bad03e2406410e228d97a96 data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;service&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;httpd&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;running&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;enable&#34;</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;subscribe&#34;</span>: [<span style=color:#e6db74>&#34;package#httpd&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>running</code></td><td>The service must be running</td></tr><tr><td><code>stopped</code></td><td>The service must be stopped</td></tr></tbody></table><p>If <code>ensure</code> is not specified, it defaults to <code>running</code>.</p><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Service name</td></tr><tr><td><code>ensure</code></td><td>Desired state (<code>running</code> or <code>stopped</code>; default: <code>running</code>)</td></tr><tr><td><code>enable</code> (boolean)</td><td>Enable the service to start at boot</td></tr><tr><td><code>subscribe</code> (array)</td><td>Resources to watch; restart the service when they change (<code>type#name</code> or <code>type#alias</code>)</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>systemd</code> only)</td></tr></tbody></table><footer class=footline></footer></article></section></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1771940928 defer></script><script src=/js/theme.min.js?1771940928 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>