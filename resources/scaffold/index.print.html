<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="Render template directories into target directories with synchronization and purge support"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Scaffold :: Choria Configuration Manager"><meta name=twitter:description content="Render template directories into target directories with synchronization and purge support"><meta property="og:url" content="https://choria-cm.dev/resources/scaffold/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Scaffold :: Choria Configuration Manager"><meta property="og:description" content="Render template directories into target directories with synchronization and purge support"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="Resources"><meta itemprop=name content="Scaffold :: Choria Configuration Manager"><meta itemprop=description content="Render template directories into target directories with synchronization and purge support"><meta itemprop=wordCount content="1323"><title>Scaffold :: Choria Configuration Manager</title><link href=https://choria-cm.dev/resources/scaffold/index.html rel=canonical type=text/html title="Scaffold :: Choria Configuration Manager"><link href=/resources/scaffold/index.md rel=alternate type=text/markdown title="Scaffold :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1771951388 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1771951388 defer></script><script src=/js/search-lunr.min.js?1771951388 defer></script><script src=/js/search.min.js?1771951388 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1771951388"</script><script src=/js/lunr/lunr.min.js?1771951388 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1771951388 defer></script><script src=/js/lunr/lunr.multi.min.js?1771951388 defer></script><script src=/js/lunr/lunr.en.min.js?1771951388 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1771951388 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1771951388 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1771951388 rel=stylesheet><link href=/css/theme.min.css?1771951388 rel=stylesheet><link href=/css/format-print.min.css?1771951388 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/resources/scaffold/index.html",window.relearn.relBasePath="../..",window.relearn.relBaseUri="../..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/resources/scaffold/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#ensure-values>Ensure Values</a></li><li><a href=#properties>Properties</a></li><li><a href=#template-engines>Template Engines</a></li><li><a href=#custom-delimiters>Custom Delimiters</a></li><li><a href=#post-processing>Post-Processing</a></li><li><a href=#purge-behavior>Purge Behavior</a></li><li><a href=#removal-behavior>Removal Behavior</a></li><li><a href=#idempotency>Idempotency</a></li><li><a href=#source-resolution>Source Resolution</a></li><li><a href=#template-environment>Template Environment</a></li><li><a href=#creating-scaffolds>Creating Scaffolds</a><ul><li><a href=#source-directory-structure>Source Directory Structure</a></li><li><a href=#template-syntax>Template Syntax</a></li><li><a href=#partials>Partials</a></li><li><a href=#built-in-functions>Built-in Functions</a></li><li><a href=#sprig-functions>Sprig Functions</a></li><li><a href=#example-scaffold>Example Scaffold</a></li></ul></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/resources/index.html><span itemprop=name>Resources</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Scaffold</span><meta itemprop=position content="3"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/scaffold/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/scaffold/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/package/index.html title="Package (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/resources/service/index.html title="Service (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable resources" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=scaffold>Scaffold</h1><p>The scaffold resource renders files from a source template directory to a target directory. Templates have access to facts and Hiera data, enabling dynamic configuration generation from directory structures.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Warning</summary><div class=box-content><p>Target paths must be absolute and canonical (no <code>.</code> or <code>..</code> components).</p></div></details><div class=tab-panel data-tab-group=R-tabs-a81810d453565df51ae70a788cb6657c><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-359018151db5b11c03e9bc7eb69b3509 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-a81810d453565df51ae70a788cb6657c","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-bb6e0a408f412ded0c60d1271934c5fe aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a81810d453565df51ae70a788cb6657c","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-630a61fe16c93503cc5ad1bddb88cf4a aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-a81810d453565df51ae70a788cb6657c","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-359018151db5b11c03e9bc7eb69b3509 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>engine</span>: <span style=color:#ae81ff>jet</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>purge</span>: <span style=color:#66d9ef>true</span></span></span></code></pre></div></div></div><div id=R-tab-id-bb6e0a408f412ded0c60d1271934c5fe data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /etc/app templates/app --engine jet --purge</code></pre></div></div></div><div id=R-tab-id-630a61fe16c93503cc5ad1bddb88cf4a data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/etc/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;engine&#34;</span>: <span style=color:#e6db74>&#34;jet&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;purge&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>This renders templates from the <code>templates/app</code> directory into <code>/etc/app</code> using the Jet template engine, removing any files in the target not present in the source.</p><details open class="box cstyle notices tip"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-lightbulb"></i>
Tip</summary><div class=box-content><p>This is implemented using the <a href=https://github.com/choria-io/scaffold rel=external>github.com/choria-io/scaffold</a> Go library, you can use this in your own projects or use the included <code>scaffold</code> CLI tool.</p></div></details><h2 id=ensure-values>Ensure Values<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>present</code></td><td>Target directory must exist with rendered template files</td></tr><tr><td><code>absent</code></td><td>Managed files must be removed; target directory removed if empty</td></tr></tbody></table><h2 id=properties>Properties<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code>name</code></td><td>Absolute path to the target directory</td></tr><tr><td><code>source</code></td><td>Source template directory path (relative to working directory or absolute)</td></tr><tr><td><code>engine</code></td><td>Template engine: <code>go</code> or <code>jet</code> (default: <code>jet</code>)</td></tr><tr><td><code>skip_empty</code></td><td>Do not create empty files in rendered output</td></tr><tr><td><code>left_delimiter</code></td><td>Custom left template delimiter</td></tr><tr><td><code>right_delimiter</code></td><td>Custom right template delimiter</td></tr><tr><td><code>purge</code></td><td>Remove files in target not present in source</td></tr><tr><td><code>post</code></td><td>Post-processing commands: glob pattern to command mapping</td></tr><tr><td><code>provider</code></td><td>Force a specific provider (<code>choria</code> only)</td></tr></tbody></table><h2 id=template-engines>Template Engines<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Two template engines are supported:</p><table><thead><tr><th>Engine</th><th>Library</th><th>Default Delimiters</th><th>Description</th></tr></thead><tbody><tr><td><code>go</code></td><td>Go <code>text/template</code></td><td><code>{{</code> / <code>}}</code></td><td>Standard Go templates</td></tr><tr><td><code>jet</code></td><td>Jet templating</td><td><code>[[</code> / <code>]]</code></td><td>Jet template language</td></tr></tbody></table><p>The engine defaults to <code>jet</code> if not specified. Delimiters can be customized via <code>left_delimiter</code> and <code>right_delimiter</code>.</p><h2 id=custom-delimiters>Custom Delimiters<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><div class=tab-panel data-tab-group=R-tabs-b63b8ab90724e25181f350228078afba><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-533421c723e3ab250acab93ff783be06 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-b63b8ab90724e25181f350228078afba","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-cfd37f397debd394beef045a96744288 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b63b8ab90724e25181f350228078afba","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-64ac10a06320ffab9c5428647244f32d aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-b63b8ab90724e25181f350228078afba","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-533421c723e3ab250acab93ff783be06 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/myservice</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/myservice</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>engine</span>: <span style=color:#ae81ff>go</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>left_delimiter</span>: <span style=color:#e6db74>&#34;&lt;&lt;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>right_delimiter</span>: <span style=color:#e6db74>&#34;&gt;&gt;&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-cfd37f397debd394beef045a96744288 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /etc/myservice templates/myservice \
    --engine go --left-delimiter &#34;&lt;&lt;&#34; --right-delimiter &#34;&gt;&gt;&#34;</code></pre></div></div></div><div id=R-tab-id-64ac10a06320ffab9c5428647244f32d data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/etc/myservice&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/myservice&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;engine&#34;</span>: <span style=color:#e6db74>&#34;go&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;left_delimiter&#34;</span>: <span style=color:#e6db74>&#34;&lt;&lt;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;right_delimiter&#34;</span>: <span style=color:#e6db74>&#34;&gt;&gt;&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><h2 id=post-processing>Post-Processing<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>post</code> property defines commands to run on rendered files. Each entry is a map where the key is a <strong>glob pattern</strong> matched against the file&rsquo;s basename and the value is a <strong>command</strong> to execute. Use <code>{}</code> in the command as a placeholder for the file&rsquo;s full path; if omitted, the path is appended as the last argument.</p><div class=tab-panel data-tab-group=R-tabs-f1b20739839a3caf15661d6f72d09014><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-8055158c06c23f9baef1298ad5b9b4e6 aria-expanded=true data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f1b20739839a3caf15661d6f72d09014","R-tab-76c3e002d3c052bd6a909366a8dc3845")'>
<span class=tab-nav-text>Manifest</span>
</button>
<button aria-controls=R-tab-id-9f819ac4118198a71305dcacf6f0f5b0 aria-expanded=false data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f1b20739839a3caf15661d6f72d09014","R-tab-91af5705f16502125e8b2187e64202c0")'>
<span class=tab-nav-text>CLI</span>
</button>
<button aria-controls=R-tab-id-6c918fdc4d350db1ea5417e888601469 aria-expanded=false data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f1b20739839a3caf15661d6f72d09014","R-tab-7d9faab09c1d85e60360dfca30ab77cc")'>
<span class=tab-nav-text>API Request</span></button></div><div class=tab-content-container><div id=R-tab-id-8055158c06c23f9baef1298ad5b9b4e6 data-tab-item=R-tab-76c3e002d3c052bd6a909366a8dc3845 class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/opt/app</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/app</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>post</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.go&#34;: </span><span style=color:#e6db74>&#34;go fmt {}&#34;</span>
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.sh&#34;: </span><span style=color:#e6db74>&#34;chmod +x {}&#34;</span></span></span></code></pre></div></div></div><div id=R-tab-id-9f819ac4118198a71305dcacf6f0f5b0 data-tab-item=R-tab-91af5705f16502125e8b2187e64202c0 class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>ccm ensure scaffold /opt/app templates/app \
    --post &#34;*.go&#34;=&#34;go fmt {}&#34; --post &#34;*.sh&#34;=&#34;chmod +x {}&#34;</code></pre></div></div></div><div id=R-tab-id-6c918fdc4d350db1ea5417e888601469 data-tab-item=R-tab-7d9faab09c1d85e60360dfca30ab77cc class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;io.choria.ccm.v1.resource.ensure.request&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;scaffold&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;properties&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;/opt/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;ensure&#34;</span>: <span style=color:#e6db74>&#34;present&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;source&#34;</span>: <span style=color:#e6db74>&#34;templates/app&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;post&#34;</span>: [
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;*.go&#34;</span>: <span style=color:#e6db74>&#34;go fmt {}&#34;</span>},
</span></span><span style=display:flex><span>      {<span style=color:#f92672>&#34;*.sh&#34;</span>: <span style=color:#e6db74>&#34;chmod +x {}&#34;</span>}
</span></span><span style=display:flex><span>    ]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div></div></div></div><p>Post-processing runs immediately after each file is rendered. Files skipped due to <code>skip_empty</code> are not post-processed.</p><h2 id=purge-behavior>Purge Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When <code>purge: true</code> is set, files in the target directory that are not present in the source template directory are deleted during rendering. In noop mode, these deletions are logged but not performed.</p><p>When <code>purge</code> is disabled (the default), files not present in the source are tracked but not removed. They do not affect idempotency checks for <code>ensure: present</code>, meaning the resource is considered stable even if extra files exist in the target.</p><h2 id=removal-behavior>Removal Behavior<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>When <code>ensure: absent</code>, only managed files (changed and stable) are removed. Files not belonging to the scaffold (purged files) are left untouched. After removing managed files and empty subdirectories, the target directory itself is removed on a best-effort basis â€” it is only deleted if empty. If unrelated files remain, the directory is preserved and no error is raised.</p><h2 id=idempotency>Idempotency<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The scaffold resource determines idempotency by rendering templates in noop mode and comparing results against the target directory.</p><p>For <code>ensure: present</code>:</p><ul><li><strong>Changed files</strong>: Files that would be created or modified. Any changed files make the resource unstable.</li><li><strong>Stable files</strong>: Files whose content matches the rendered output. At least one stable file must exist for the resource to be considered stable.</li><li><strong>Purged files</strong>: Files in the target not present in the source. These only affect stability when <code>purge</code> is enabled.</li></ul><p>For <code>ensure: absent</code>, the status check filters <code>Changed</code> and <code>Stable</code> lists to only include files that actually exist on disk. This means after a successful removal, the scaffold is considered absent even if the target directory still exists with unrelated files. Purged files never affect the absent stability check.</p><h2 id=source-resolution>Source Resolution<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The <code>source</code> property is resolved relative to the manager&rsquo;s working directory when it is a relative path. URL sources (with a scheme) are passed through unchanged. This allows manifests bundled with template directories to use relative paths.</p><h2 id=template-environment>Template Environment<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Templates receive the full template environment, which provides access to:</p><ul><li><code>facts</code> - System facts for the managed node</li><li><code>data</code> - Hiera-resolved configuration data</li><li>Template helper functions</li></ul><h2 id=creating-scaffolds>Creating Scaffolds<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>A scaffold source is a directory tree where every file is a template. The directory structure is mirrored directly into the target, so the source layout becomes the output layout.</p><h3 id=source-directory-structure>Source Directory Structure<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>templates/app/
â”œâ”€â”€ _partials/
â”‚   â””â”€â”€ header.conf
â”œâ”€â”€ config.yaml
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh
â””â”€â”€ README.md</code></pre></div><p>This renders into:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/etc/app/
â”œâ”€â”€ config.yaml
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh
â””â”€â”€ README.md</code></pre></div><p>The <code>_partials</code> directory is special â€” its contents are available to templates but are never copied to the target.</p><h3 id=template-syntax>Template Syntax<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Every file in the source directory is processed as a template. The syntax depends on the engine selected.</p><p><strong>Jet engine</strong> (default, <code>[[</code> / <code>]]</code> delimiters):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># config.yaml
hostname: [[ facts.hostname ]]
environment: [[ data.environment ]]
workers: [[ data.worker_count ]]</code></pre></div><p><strong>Go engine</strong> (<code>{{</code> / <code>}}</code> delimiters):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># config.yaml
hostname: {{ .facts.hostname }}
environment: {{ .data.environment }}
workers: {{ .data.worker_count }}</code></pre></div><p>The Jet engine is the default because its <code>[[</code> / <code>]]</code> delimiters avoid conflicts with configuration files that use curly braces (YAML, JSON, systemd units). Use the Go engine when you need access to <a href=https://masterminds.github.io/sprig/ rel=external>Sprig functions</a>.</p><h3 id=partials>Partials<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Files inside a <code>_partials</code> directory are reusable template fragments. They are rendered on demand using the <code>render</code> function but are excluded from the output.</p><p>This is useful for shared headers, repeated configuration blocks, or any content used across multiple files.</p><p><strong>Jet:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/header.conf&#34;, .) ]]

server {
    listen [[ data.port ]];
}</code></pre></div><p><strong>Go:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ render &#34;_partials/header.conf&#34; . }}

server {
    listen {{ .data.port }};
}</code></pre></div><h3 id=built-in-functions>Built-in Functions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Two functions are available in both template engines:</p><p><strong><code>render</code></strong> evaluates another template file from the source directory and returns its output as a string. The partial is rendered using the same engine and data as the calling template.</p><div class=tab-panel data-tab-group=R-tabs-ae1de79b78c198aea515031308967fec><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-5fdc664546c79bffdd9ad69ec7564eb5 aria-expanded=true data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-ae1de79b78c198aea515031308967fec","R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b")'>
<span class=tab-nav-text>Jet</span>
</button>
<button aria-controls=R-tab-id-52ebafc020572f871dc67bef43a9d9af aria-expanded=false data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-ae1de79b78c198aea515031308967fec","R-tab-5f075ae3e1f9d0382bb8c4632991f96f")'>
<span class=tab-nav-text>Go</span></button></div><div class=tab-content-container><div id=R-tab-id-5fdc664546c79bffdd9ad69ec7564eb5 data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/database.conf&#34;, .) ]]</code></pre></div></div></div><div id=R-tab-id-52ebafc020572f871dc67bef43a9d9af data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ render &#34;_partials/database.conf&#34; . }}</code></pre></div></div></div></div></div><p><strong><code>write</code></strong> creates an additional file in the target directory from within a template. This is useful for dynamically generating files based on data â€” for example, creating one configuration file per service.</p><div class=tab-panel data-tab-group=R-tabs-f8d3e57c0b20578c2431c1c6de3a9a6b><div class=tab-nav><div class=tab-nav-title>&#8203;</div><button aria-controls=R-tab-id-cfa75e4690e50a987b6c1e3f8e1380da aria-expanded=true data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-nav-button tab-panel-style cstyle initial active" tabindex=-1 onclick='switchTab("R-tabs-f8d3e57c0b20578c2431c1c6de3a9a6b","R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b")'>
<span class=tab-nav-text>Jet</span>
</button>
<button aria-controls=R-tab-id-4cc5d1f7032e54ce6f3c7b5051eb8d10 aria-expanded=false data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-nav-button tab-panel-style cstyle initial" onclick='switchTab("R-tabs-f8d3e57c0b20578c2431c1c6de3a9a6b","R-tab-5f075ae3e1f9d0382bb8c4632991f96f")'>
<span class=tab-nav-text>Go</span></button></div><div class=tab-content-container><div id=R-tab-id-cfa75e4690e50a987b6c1e3f8e1380da data-tab-item=R-tab-252ce7e80c1ffd8c2558ad9b13d4ca2b class="tab-content tab-panel-style cstyle initial active"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ write(&#34;extra.conf&#34;, &#34;generated content&#34;) ]]</code></pre></div></div></div><div id=R-tab-id-4cc5d1f7032e54ce6f3c7b5051eb8d10 data-tab-item=R-tab-5f075ae3e1f9d0382bb8c4632991f96f class="tab-content tab-panel-style cstyle initial"><div class=tab-content-text><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>{{ write &#34;extra.conf&#34; &#34;generated content&#34; }}</code></pre></div></div></div></div></div><h3 id=sprig-functions>Sprig Functions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>When using the Go template engine, all <a href=https://masterminds.github.io/sprig/ rel=external>Sprig</a> template functions are available. These provide string manipulation, math, date formatting, list operations, and more:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code># Go engine example with Sprig functions
hostname: {{ .facts.hostname | upper }}
packages: {{ join &#34;, &#34; .data.packages }}
generated: {{ now | date &#34;2006-01-02&#34; }}</code></pre></div><h3 id=example-scaffold>Example Scaffold<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>A complete scaffold for an application configuration:</p><p><strong>Source structure:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>templates/myapp/
â”œâ”€â”€ _partials/
â”‚   â””â”€â”€ logging.conf
â”œâ”€â”€ myapp.conf
â””â”€â”€ scripts/
    â””â”€â”€ healthcheck.sh</code></pre></div><p><strong><code>_partials/logging.conf</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>log_level = [[ data.log_level ]]
log_file = /var/log/myapp/[[ facts.hostname ]].log</code></pre></div><p><strong><code>myapp.conf</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>[[ render(&#34;_partials/logging.conf&#34;, .) ]]

[server]
bind = 0.0.0.0
port = [[ data.port ]]
workers = [[ data.workers ]]</code></pre></div><p><strong><code>scripts/healthcheck.sh</code></strong> (Jet):</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>#!/bin/bash
curl -sf http://localhost:[[ data.port ]]/health || exit 1</code></pre></div><p><strong>Manifest using this scaffold:</strong></p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>scaffold</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>/etc/myapp</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>ensure</span>: <span style=color:#ae81ff>present</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>source</span>: <span style=color:#ae81ff>templates/myapp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>purge</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>post</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>&#34;*.sh&#34;: </span><span style=color:#e6db74>&#34;chmod +x {}&#34;</span></span></span></code></pre></div><p>With facts <code>{"hostname": "web01"}</code> and data <code>{"port": 8080, "workers": 4, "log_level": "info"}</code>, this renders:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>/etc/myapp/
â”œâ”€â”€ myapp.conf
â””â”€â”€ scripts/
    â””â”€â”€ healthcheck.sh</code></pre></div><p>Where <code>myapp.conf</code> contains:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>log_level = info
log_file = /var/log/myapp/web01.log

[server]
bind = 0.0.0.0
port = 8080
workers = 4</code></pre></div><footer class=footline></footer></article></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1771951388 defer></script><script src=/js/theme.min.js?1771951388 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>