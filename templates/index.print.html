<!doctype html><html id=R-html lang=en-us dir=ltr itemscope itemtype=http://schema.org/Article data-r-output-format=print><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.154.5"><meta name=generator content="Relearn 9.0.3"><meta name=description content="How to use templates in CCM Manifests and CLI"><meta name=author content><meta name=twitter:card content="summary"><meta name=twitter:title content="Data :: Choria Configuration Manager"><meta name=twitter:description content="How to use templates in CCM Manifests and CLI"><meta property="og:url" content="https://choria-cm.dev/templates/index.html"><meta property="og:site_name" content="Choria Configuration Manager"><meta property="og:title" content="Data :: Choria Configuration Manager"><meta property="og:description" content="How to use templates in CCM Manifests and CLI"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="Data :: Choria Configuration Manager"><meta itemprop=description content="How to use templates in CCM Manifests and CLI"><meta itemprop=wordCount content="549"><title>Data :: Choria Configuration Manager</title><link href=https://choria-cm.dev/templates/index.html rel=canonical type=text/html title="Data :: Choria Configuration Manager"><link href=/templates/index.xml rel=alternate type=application/rss+xml title="Data :: Choria Configuration Manager"><link href=/templates/index.md rel=alternate type=text/markdown title="Data :: Choria Configuration Manager"><link href=/css/auto-complete/auto-complete.min.css?1771951388 rel=stylesheet><script src=/js/auto-complete/auto-complete.min.js?1771951388 defer></script><script src=/js/search-lunr.min.js?1771951388 defer></script><script src=/js/search.min.js?1771951388 defer></script><script>window.relearn=window.relearn||{},window.relearn.index_js_url="/searchindex.en.js?1771951388"</script><script src=/js/lunr/lunr.min.js?1771951388 defer></script><script src=/js/lunr/lunr.stemmer.support.min.js?1771951388 defer></script><script src=/js/lunr/lunr.multi.min.js?1771951388 defer></script><script src=/js/lunr/lunr.en.min.js?1771951388 defer></script><script>window.relearn=window.relearn||{},window.relearn.contentLangs=["en"]</script><link href=/fonts/fontawesome/css/all.min.css?1771951388 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/fonts/fontawesome/css/all.min.css?1771951388 rel=stylesheet></noscript><link href=/css/perfect-scrollbar/perfect-scrollbar.min.css?1771951388 rel=stylesheet><link href=/css/theme.min.css?1771951388 rel=stylesheet><link href=/css/format-print.min.css?1771951388 rel=stylesheet id=R-format-style><script>window.relearn=window.relearn||{},window.relearn.min=`.min`,window.relearn.path="/templates/index.html",window.relearn.relBasePath="..",window.relearn.relBaseUri="..",window.relearn.absBaseUri="https://choria-cm.dev",window.relearn.disableInlineCopyToClipboard=!0,window.relearn.enableBlockCodeWrap=!0,window.T_Copy_to_clipboard=`Copy text to clipboard`,window.T_Copied_to_clipboard=`Text copied to clipboard!`,window.T_Link_copied_to_clipboard=`Link copied to clipboard!`,window.T_Reset_view=`Reset view`,window.T_View_reset=`View reset!`,window.T_No_results_found=`No results found for "{0}"`,window.T_N_results_found=`{1} results found for "{0}"`,window.T_Browser_unsupported_feature=`This browser doesn't support this feature`,window.relearn.themevariants=["zen-auto","zen-light","ccm"],window.relearn.customvariantprefix="my-custom-",window.relearn.changeVariant=function(e){var t=document.documentElement.dataset.rThemeVariant;window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e),document.documentElement.dataset.rThemeVariant=e,t!=e&&(document.dispatchEvent(new CustomEvent("themeVariantLoaded",{detail:{variant:e,oldVariant:t}})),window.relearn.markVariant())},window.relearn.markVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant");document.querySelectorAll(".R-variantswitcher select").forEach(t=>{t.value=e})},window.relearn.initVariant=function(){var e=window.localStorage.getItem(window.relearn.absBaseUri+"/variant")??"";(!e||!e.startsWith(window.relearn.customvariantprefix)&&!window.relearn.themevariants.includes(e)||e.startsWith(window.relearn.customvariantprefix)&&!window.localStorage.getItem(window.relearn.absBaseUri+"/variantstylesheet-"+e))&&(e=window.relearn.themevariants[0],window.localStorage.setItem(window.relearn.absBaseUri+"/variant",e)),document.documentElement.dataset.rThemeVariant=e},window.relearn.initVariant(),window.relearn.markVariant()</script><script src=https://cdn.counter.dev/script.js data-id=a4622abe-f6fa-4cac-a337-a4437915e4b3></script></head><body class="mobile-support print" data-origin=/templates/index.html><div id=R-body class=default-animation><div id=R-body-overlay></div><nav id=R-topbar class=default-animation><div class="topbar-wrapper default-animation"><div class="topbar-sidebar-divider default-animation"></div><div class="topbar-area topbar-area-start" data-area=start><div class="topbar-button topbar-button-sidebar default-animation" data-content-empty=disable data-width-s=show data-width-m=hide data-width-l=hide><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleNav() type=button title="Menu (CTRL+ALT+n)"><i class="fa-fw fas fa-bars"></i></button></span></div><div class="topbar-button topbar-button-toc default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title="Table of Contents (CTRL+ALT+t)"><i class="fa-fw fas fa-table-list"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><nav class=TableOfContents><ul><li><a href=#accessing-data>Accessing Data</a><ul><li><a href=#available-variables>Available Variables</a></li><li><a href=#available-functions>Available Functions</a></li><li><a href=#gjson-path-examples>GJSON Path Examples</a></li><li><a href=#cli-usage>CLI Usage</a></li></ul></li><li><a href=#facts>Facts</a></li><li><a href=#hiera-data-for-cli>Hiera Data for CLI</a><ul><li><a href=#hiera-data-sources>Hiera Data Sources</a></li><li><a href=#merge-strategies>Merge Strategies</a></li><li><a href=#example>Example</a></li></ul></li><li><a href=#environment>Environment</a></li></ul></nav></div></div></div></div><ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>Introduction</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>Data</span><meta itemprop=position content="2"></li></ol><div class="topbar-area topbar-area-end" data-area=end><div class="topbar-button topbar-button-markdown default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/templates/index.md title="Show Markdown"><i class="fa-fw fab fa-markdown"></i></a></span></div><div class="topbar-button topbar-button-print default-animation" data-content-empty=disable data-width-s=area-more data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/templates/index.print.html title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a></span></div><div class="topbar-button topbar-button-prev default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/hiera/index.html title="Hierarchical Data (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a></span></div><div class="topbar-button topbar-button-next default-animation" data-content-empty=disable data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><a href=/cli/index.html title="Shell Usage (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a></span></div><div class="topbar-button topbar-button-more default-animation" data-content-empty=hide data-width-s=show data-width-m=show data-width-l=show><span class="btn cstyle button link noborder notitle interactive"><button onclick=toggleTopbarFlyout(this) type=button title=More><i class="fa-fw fas fa-ellipsis-v"></i></button></span><div class=topbar-content><div class=topbar-content-wrapper><div class="topbar-area topbar-area-more" data-area=more></div></div></div></div></div></div></nav><div id=R-main-overlay></div><main id=R-body-inner class="highlightable templates" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=data>Data</h1><p>Just like applications need data to vary their behavior and configure their environments, so do Configuration Management tools.</p><p>For this reason, I wrote <code>extlookup</code> and <code>hiera</code> years ago for the Puppet community. Despite CCM&rsquo;s minimal focus, we still need data to vary behavior.</p><p>Data can be used for:</p><ul><li>Configuring resource names that differ between operating systems (e.g., <code>httpd</code> vs <code>apache2</code>)</li><li>Setting different configuration values depending on environment, role, or other dimensions</li><li>Deciding whether environments should have something installed (e.g., development vs production)</li></ul><p>CCM supports various data sources:</p><ul><li><strong>System Facts</strong> - Operating system, networking, and disk configuration</li><li><strong>Custom Facts</strong> - From <code>/etc/choria/ccm/facts.{yaml,json}</code> and <code>~/.config/choria/ccm/facts.{yaml,json}</code></li><li><strong>Environment</strong> - Variables from the shell environment and <code>./.env</code> files</li><li><strong>Hiera Data</strong> - Hierarchical data with overrides based on facts</li></ul><h2 id=accessing-data>Accessing Data<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Expressions like <code>{{ lookup('facts.host.info.platformFamily') }}</code> use the <a href=https://expr-lang.org/docs/language-definition rel=external>Expr Language</a>.</p><h3 id=available-variables>Available Variables<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>In templates, you have direct access to:</p><table><thead><tr><th>Variable</th><th>Description</th></tr></thead><tbody><tr><td><code>Facts</code></td><td>System facts (e.g., <code>Facts.host.info.platformFamily</code>)</td></tr><tr><td><code>Data</code></td><td>Resolved Hiera data (e.g., <code>Data.package_name</code>)</td></tr><tr><td><code>Environ</code></td><td>Environment variables (e.g., <code>Environ.HOME</code>)</td></tr></tbody></table><h3 id=available-functions>Available Functions<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><table><thead><tr><th>Function</th><th>Description</th></tr></thead><tbody><tr><td><code>lookup(key, default)</code></td><td>Lookup data using <a href=https://github.com/tidwall/gjson/blob/master/SYNTAX.md rel=external>GJSON Path Syntax</a>. Example: <code>lookup("facts.host.info.os", "linux")</code></td></tr><tr><td><code>readFile(path)</code>, <code>file(path)</code></td><td>Read a file into a string (files must be in the working directory)</td></tr><tr><td><code>template(f)</code></td><td>Parse <code>f</code> using templates. If <code>f</code> ends in <code>.templ</code>, reads the file first, if it ends in <code>.jet</code> calls the <code>jet()</code> function</td></tr><tr><td><code>jet(f)</code>, <code>jet(f, "[[", "]]")</code></td><td>Parse <code>f</code> using <a href=https://github.com/CloudyKit/jet/blob/master/docs/syntax.md rel=external>Jet templates</a> with optional custom delimiters. If <code>f</code> ends in <code>.jet</code>, reads the file first</td></tr></tbody></table><h3 id=gjson-path-examples>GJSON Path Examples<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>lookup()</code> function uses GJSON path syntax for nested access:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code>lookup(&#34;facts.host.info.platformFamily&#34;)     # Simple nested path
lookup(&#34;facts.network.interfaces.0.name&#34;)    # Array index
lookup(&#34;data.packages.#&#34;)                    # Array length</code></pre></div><h3 id=cli-usage>CLI Usage<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>These expressions work on the CLI:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>$ ccm ensure package &#39;{{ lookup(&#34;data.package_name&#34;, &#34;httpd&#34;) }}&#39;</code></pre></div><p>This fetches <code>package_name</code> from the data and defaults to <code>httpd</code> if not found.</p><h2 id=facts>Facts<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>CCM includes a built-in fact resolver that gathers system information. To see available facts:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0><code class=language-nohighlight data-lang=nohighlight>$ ccm facts                              # All facts as JSON
$ ccm facts host                         # Query specific path
$ ccm facts --yaml                       # Output as YAML</code></pre></div><p>Access facts in expressions using <code>{{ Facts.host.info.platformFamily }}</code> or <code>{{ lookup('facts.host.info.platformFamily') }}</code>.</p><h2 id=hiera-data-for-cli>Hiera Data for CLI<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>Hiera data is resolved using the Choria Hierarchical Data Resolver. By default, data is read from <code>./.hiera</code>, or you can specify a file with <code>--hiera</code>.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>This applies to <code>ccm ensure</code> commands. The <code>ccm apply</code> command uses manifests that contain their own Hiera data.</p></div></details><h3 id=hiera-data-sources>Hiera Data Sources<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Hiera data can be loaded from:</p><ul><li><strong>Local file</strong>: <code>./.hiera</code> or path specified with <code>--hiera</code></li><li><strong>Key-Value store</strong>: <code>--hiera kv://BUCKET/key</code> (requires <code>--context</code> for NATS)</li><li><strong>HTTP(S)</strong>: <code>--hiera https://example.com/data.yaml</code> (supports Basic Auth via URL credentials)</li></ul><h3 id=merge-strategies>Merge Strategies<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>The <code>hierarchy.merge</code> setting controls how overrides are applied:</p><ul><li><strong><code>first</code></strong> (default): Stops at the first matching override</li><li><strong><code>deep</code></strong>: Deep merges all matching overrides in order</li></ul><h3 id=example>Example<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h3><p>Given this file stored in <code>./.hiera</code>:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>hierarchy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>order</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>os:{{ lookup(&#39;facts.host.info.platformFamily&#39;) }}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>merge</span>: <span style=color:#ae81ff>first</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>package_name</span>: <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>overrides</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>os:debian</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>package_name</span>: <span style=color:#ae81ff>apache2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>os:rhel</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>package_name</span>: <span style=color:#ae81ff>httpd</span></span></span></code></pre></div><p>Running <code>ccm ensure package '{{ lookup("data.package_name") }}'</code> installs <code>httpd</code> on RHEL-based systems and <code>apache2</code> on Debian-based systems.</p><details open class="box cstyle notices info"><summary class=box-label tabindex=-1><i class="fa-fw fas fa-info-circle"></i>
Note</summary><div class=box-content><p>See the <a href=/hiera/index.html>Hiera</a> section for details on configuring Hiera data in NATS.</p></div></details><h2 id=environment>Environment<span class="btn cstyle anchor copyanchor scrollanchor link noborder notitle interactive"><button type=button title="Copy link to clipboard"><i class="fa-fw fas fa-link fa-lg"></i></button></span></h2><p>The shell environment and variables defined in <code>./.env</code> can be accessed in two ways:</p><div class="highlight actionbar-wrapper wrap-code" dir=auto><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#75715e># Direct access</span>
</span></span><span style=display:flex><span><span style=color:#f92672>home_dir</span>: <span style=color:#e6db74>&#34;{{ Environ.HOME }}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Via lookup (with default value)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>my_var</span>: <span style=color:#e6db74>&#34;{{ lookup(&#39;environ.MY_VAR&#39;, &#39;default&#39;) }}&#34;</span></span></span></code></pre></div><p>The <code>.env</code> file uses standard <code>KEY=value</code> format, one variable per line.</p><footer class=footline></footer></article></div></main></div><script src=/js/perfect-scrollbar/perfect-scrollbar.min.js?1771951388 defer></script><script src=/js/theme.min.js?1771951388 defer></script><div id=toast-container role=status aria-live=polite aria-atomic=false></div></body></html>